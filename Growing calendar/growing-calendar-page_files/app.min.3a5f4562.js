!function(){"use strict";function ConfigureAnchorScroll($rootScope,$injector,$timeout){return function(){$timeout(function(){var $anchorScroll=$injector.get("$anchorScroll");$anchorScroll.yOffset="mobile"===$rootScope.screenSize?68:50},0)}}function ConfigureAnchorScrollRun(configureAnchorScroll){configureAnchorScroll()}function httpAuthenticationService(session){return{request:function(config){var token=session.getInfo().token;return token&&(config.headers.Authorization=token),config}}}function AuthenticationInterceptor($httpProvider){$httpProvider.interceptors.push("httpAuthentication")}function GoogleMapsConfig(uiGmapGoogleMapApiProvider){uiGmapGoogleMapApiProvider.configure()}function AjaxWithCookies($httpProvider){$httpProvider.defaults.withCredentials=!0}function httpPatchService(){return{request:function(config){return"PATCH"===config.method&&(config.method="PUT"),config}}}function PatchInterceptor($httpProvider){$httpProvider.interceptors.push("httpPatch")}function BetterAsyncAjax($httpProvider){$httpProvider.useApplyAsync(!0)}function CementPreviewModeService(browserStorage){var sessionId=browserStorage.temporary.getItem("preview_session_id");return{request:function(config){return sessionId&&(config.headers["X-Preview"]=sessionId),config}}}function CementPreviewModeInterceptor($httpProvider){function noSessionStorage(){}var sessionId,sessionInUrl=window.location.search.match(/[&?]preview_session_id=([^&]+)/);if(sessionInUrl){sessionId=sessionInUrl[1];try{sessionStorage.setItem("preview_session_id",JSON.stringify(sessionId))}catch(error){noSessionStorage(error)}}else try{sessionId=sessionStorage.getItem("preview_session_id")}catch(error){noSessionStorage(error)}sessionId&&$httpProvider.interceptors.push("cementPreviewMode")}function PreviewModeRunner($rootScope,browserStorage){browserStorage.temporary.getItem("preview_session_id")&&($rootScope.previewMode=!0)}function RequestTimingService($log){var timers={};return{request:function(config){return timers[config.method+"|"+config.url]=new Date,config},response:function(response){var now=new Date,then=timers[response.config.method+"|"+response.config.url],time=(now-then)/100;return $log.debug(response.config.method+": "+response.config.url+" - "+time+"s"),response}}}function RequestTimingInterceptor($httpProvider){$httpProvider.interceptors.push("requestTiming")}function RoutesConfig($stateProvider,$urlRouterProvider,$locationProvider,$uiViewScrollProvider){$locationProvider.html5Mode(!0),$stateProvider.state("homepage",{url:"/",templateUrl:"/views/homepage.html",page_type:"homepage"}).state("ocp-content",{url:"/cms/{url:.*}/",controller:CmsContentController,resolve:CmsContentController.resolve,templateUrl:"/views/cms-content.html",page_type:"ocp-content"}).state("static-content",{url:"/content/{url:.*}",templateUrl:"/views/static-content.html",controller:"StaticContentController",page_type:"content"}).state("plant-finder",{url:"/shop/plant-finder/",controller:"PlantFinderController as vm",templateUrl:"/views/plant-finder.html",resolve:PlantFinderController.resolve,page_type:"plant-finder"}).state("ensemble",{url:"/shop/ensemble-{name:[A-Za-z0-9\\-]*}-{id:[A-Za-z]*[0-9]+}/",controller:"EnsembleDetailController as vm",templateUrl:"/views/ensemble-detail.html",resolve:EnsembleDetailController.resolve,page_type:"ensemble"}).state("product",{url:"/shop/{name:[A-Za-z0-9\\-]*}-{id:[A-Za-z]*[0-9]+}/",controller:"PDPController as vm",templateUrl:"/views/product-detail.html",resolve:PDPController.resolve,page_type:"product"}).state("category",{url:"/shop/{categories:[^/]+}/",controller:"LandingPageController as vm",templateUrl:"/views/landing-page.html",resolve:LandingPageController.resolve,page_type:"category"}).state("sub-category",{url:"/shop/{categories:.*}/",controller:"SubcategoryController as vm",templateUrl:"/assets/partials/product-list.html",resolve:SubcategoryController.resolve,page_type:"category"}).state("search",{url:"/search/?query&page",page_type:"search",controller:"SearchResultsController as vm",resolve:SearchResultsController.resolve,templateUrl:"/views/search-results.html"}).state("sign-in",{url:"/sign-in/?return_url&required",controller:"SignInController as vm",resolve:SignInController.resolve,templateUrl:"/views/sign-in.html",noBreadCrumb:!0}).state("forgotten-password",{url:"/sign-in/forgotten-password/",controller:"ForgottenPasswordController as vm",templateUrl:"/views/forgotten-password.html"}).state("reset-password",{url:"/sign-in/reset-password/?email&uid",controller:"ResetPasswordController as vm",templateUrl:"/views/reset-password.html"}).state("my-account-summary",{url:"/my-account/",templateUrl:"/views/my-account/index.html",controller:"AccountSummaryController as vm",resolve:AccountSummaryController.resolve,authenticate:!0,noBreadCrumb:!0,noRecentlyViewed:!0}).state("preferences",{url:"/my-account/account-preferences/",templateUrl:"/views/my-account/preferences.html",controller:"AccountPreferencesController as vm",resolve:AccountPreferencesController.resolve,authenticate:!0,noRecentlyViewed:!0}).state("address-book",{url:"/my-account/address-book/",templateUrl:"/views/my-account/address-book.html",controller:"AddressBookController as vm",resolve:AddressBookController.resolve,authenticate:!0,noRecentlyViewed:!0}).state("clippings",{url:"/my-account/clippings/",templateUrl:"/views/my-account/clippings.html",controller:"ClippingsController as vm",resolve:ClippingsController.resolve,authenticate:!0,noRecentlyViewed:!0}).state("order-history",{url:"/my-account/order-history/",templateUrl:"/views/my-account/order-history.html",controller:"OrderHistoryController as vm",resolve:OrderHistoryController.resolve,authenticate:!0,noRecentlyViewed:!0}).state("order",{url:"/my-account/order-history/{type:order|sale}-{id:[0-9]+}/",templateUrl:"/views/my-account/order-details.html",controller:"OrderDetailsController as vm",resolve:OrderDetailsController.resolve,authenticate:!0,noRecentlyViewed:!0}).state("vouchers",{url:"/my-account/vouchers/",templateUrl:"/views/my-account/vouchers.html",controller:"VouchersController as vm",resolve:VouchersController.resolve,authenticate:!0,noRecentlyViewed:!0}).state("join-club",{url:"/my-account/join-club/",templateUrl:"/views/my-account/join-club.html",controller:"MembershipController as vm",resolve:MembershipController.resolve,noRecentlyViewed:!0}).state("link-club",{url:"/my-account/link-club/",templateUrl:"/views/my-account/link-club.html",controller:"MembershipController as vm",resolve:MembershipController.resolve,noRecentlyViewed:!0}).state("garden-profile",{url:"/my-account/garden-profile/",templateUrl:"/views/my-account/garden-profile.html",controller:"MembershipController as vm",resolve:MembershipController.resolve,authenticate:!0}).state("edit-garden-profile",{url:"/my-account/edit-garden-profile/",templateUrl:"/views/my-account/edit-garden-profile.html",controller:"MembershipController as vm",resolve:MembershipController.resolve,authenticate:!0}).state("link-card",{url:"/my-account/link-card/",templateUrl:"/views/my-account/link-card.html",controller:"MembershipController as vm",resolve:MembershipController.resolve,authenticate:!0}).state("membership",{url:"/membership/",templateUrl:"/views/membership.html",controller:"MembershipController as vm",resolve:MembershipController.resolve}).state("basket",{url:"/basket/",controller:"BasketController",templateUrl:"/views/basket.html",page_type:"basket"}).state("checkout",{url:"/checkout/",controller:"CheckoutController as vm",resolve:CheckoutController.resolve,templateUrl:"/views/checkout/index.html",page_type:"checkout"}).state("checkout.billing-info",{url:"step-1/",parent:"checkout",views:{billing:{controller:"BillingController as vm",resolve:BillingController.resolve,templateUrl:"/views/checkout/billing-info.html"}},page_type:"checkout"}).state("checkout.shipping-info",{url:"step-2/",parent:"checkout",views:{shipping:{controller:"ShippingController as vm",resolve:ShippingController.resolve,templateUrl:"/views/checkout/shipping-info.html"}},page_type:"checkout"}).state("checkout.payment",{url:"step-3/",parent:"checkout",views:{payment:{controller:"PaymentController as vm",resolve:PaymentController.resolve,templateUrl:"/views/checkout/payment.html"}},page_type:"checkout"}).state("checkout-sign-in",{url:"/checkout/sign-in/",controller:"CheckoutSignInController as vm",templateUrl:"/views/checkout/sign-in.html",page_type:"checkout"}).state("checkout-birthday",{url:"/partials/my-account/birthday/",controller:"BillingController as vm",templateUrl:"/partials/my-account/birthday.html",page_type:"checkout"}).state("order-confirmation",{url:"/checkout/order-confirmation/",controller:"OrderConfirmationController as vm",resolve:OrderConfirmationController.resolve,templateUrl:"/views/checkout/order-confirmation.html",page_type:"checkout"}).state("session-expired",{url:"/session-expired/",templateUrl:"/views/session-expired.html"}).state("store-locator",{url:"/stores/",controller:"StoreLocatorController as vm",templateUrl:"/views/store-locator.html",resolve:StoreLocatorController.resolve}).state("store-detail",{url:"/stores/{name:[A-Za-z0-9\\-]*}-{id:[0-9]+}/",controller:"StoreDetailController",templateUrl:"/views/store-detail.html",resolve:StoreDetailController.resolve}).state("ui-kit",{url:"/ui-kit/",templateUrl:"/views/ui-kit.html"}).state("404",{url:"/404?url",templateUrl:"/views/errors/404.html",controller:"ErrorController as vm",page_type:"error"}),$urlRouterProvider.otherwise(function($injector,$location){window.location.replace("/404?url="+encodeURIComponent($location.url()))}),$uiViewScrollProvider.useAnchorScroll(),$urlRouterProvider.rule(function($injector,$location){var path=$location.url();return"/"!==path[path.length-1]&&-1===path.indexOf("/?")?path.indexOf("?")>-1?path.replace("?","/?"):path+"/":void 0})}function ScreenSize($rootScope){var screen=matchMedia("(min-width: 768px)"),getSize=function(mq){$rootScope.$apply(function(){$rootScope.screenSize=mq.matches?"tablet":"mobile"})};getSize(screen),screen.addListener(getSize)}function SEOService($injector,$timeout){var timer;return{response:function(response){var $http=$injector.get("$http");return $http.pendingRequests.length<1&&($timeout.cancel(timer),timer=$timeout(function(){$http.pendingRequests.length<1&&(window.prerenderReady=!0)},700)),response}}}function SEOInterceptor($httpProvider){$httpProvider.interceptors.push("SEOService")}function AccountPreferencesController(user,messages){var vm=this;vm.updateEmail=function(event){event.preventDefault(),vm.emailForm.$invalid||user.updateEmail(vm.email.old,vm.email["new"]).then(function(data){vm.email={},vm.emailForm.$setPristine(),messages.push({type:"success",content:"Email successfully changed to <strong>"+data.email+"</strong>",autoclose:4e3})},function(error){messages.push({type:"alert",content:error.description})})},vm.updatePassword=function(event){event.preventDefault(),vm.passwordForm.$invalid||user.updatePassword(vm.password.old,vm.password["new"]).then(function(){vm.password={},vm.passwordForm.$setPristine(),messages.push({type:"success",content:"Password successfully changed",autoclose:4e3})},function(error){messages.push({type:"alert",content:error.description})})}}function AccountSummaryController(userDetails,orderHistory,userWishlist,preferredStore,UserService,authentication,$location,loyalty){var vm=this;if(vm.user=userDetails,vm.wishlist=userWishlist,vm.orderHistory=orderHistory,vm.preferredStore=preferredStore,vm.isLoyaltyMember=userDetails.loyalty_card_number,vm.card_number_formated=[],vm.card_number_formated_string="",vm.isLoyaltyMember){for(var i=0;i<vm.isLoyaltyMember.length;i+=4)vm.card_number_formated.push(vm.isLoyaltyMember.substr(i,4));vm.card_number_formated_string=vm.card_number_formated.join("-"),vm.loyaltyPoints=loyalty.total_points}vm.signOut=function(event){event&&event.preventDefault(),authentication.signOut().then(function(){$location.path("/")})}}function AddressBookController(addressBook,addressLookup,addresses,universal_variable,titles,ajaxStatus,overlay){var vm=this,resetForm=function(){vm.updatedAddress=!1,vm.addressForm.$setPristine(),vm.addressOptions=[],vm.postcode_lookup=null};vm.first_name=universal_variable.user.first_name||universal_variable.user.name,vm.titles=titles,vm.addresses=addresses,vm.updatedAddress=addresses.length?!1:{title:titles[0]},vm.extraFields=["phonenumber"],vm.addAddress=function(){vm.updatedAddress={title:titles[0]}},vm.editAddress=function(address){vm.updatedAddress=angular.copy(address)},vm.preDeleteAddress=function(address,screenSize){"mobile"===screenSize?vm.deleteAddress(address):overlay.confirm("Are you sure you want to delete this address?",function(bool){bool&&vm.deleteAddress(address)},!1,!1)},vm.deleteAddress=function(address){addressBook.deleteAddress(address).then(function(){addressBook.getAddresses().then(function(updatedAddresses){vm.addresses=updatedAddresses})})},vm.updateAddress=function(e){return e.preventDefault(),vm.addressForm.$invalid?!1:void addressBook.updateAddress(vm.updatedAddress).then(function(){addressBook.getAddresses().then(function(updatedAddresses){vm.addresses=updatedAddresses,resetForm()})})},vm.cancelUpdate=function(e){e.preventDefault(),resetForm()},vm.oneLineAddress=addressLookup.oneLineAddress,vm.addressPicked=function(newAddress){if(vm.updatedAddress&&vm.updatedAddress.id)for(var e in newAddress)vm.updatedAddress[e]=newAddress[e];else vm.updatedAddress=addressLookup.replaceAddress(vm.updatedAddress,newAddress)},vm.lookupAddress=function(){vm.lookupStatus=ajaxStatus.pending,addressLookup.findAddress(vm.building_number,vm.postcode_lookup).then(function(addressResults){return vm.lookupStatus=ajaxStatus.success,vm.postcodeLookupError=!1,1===addressResults.length?void vm.addressPicked(addressResults[0]):void(vm.addressOptions=addressResults)},function(error){vm.addressOptions=[],vm.lookupStatus=ajaxStatus.error,vm.postcodeLookupError=error.message})},vm.handlePostcodeSubmit=addressLookup.handlePostcodeSubmit(vm.lookupAddress)}function BasketController($scope,$rootScope,$timeout,$state,$log,universal_variable,basket,browserStorage,productService,user,wishlistService,ajaxStatus,tagManagerService,scrollToAnchorService){function processPreorderDatesErrors(errData){for(var lineItems=$scope.basket.line_items,i=0;i<errData.errors.length;++i)for(var lineId=errData.errors[i].field,errorType=errData.errors[i].message,z=0;z<lineItems.length;++z){var productName=lineItems[z].product.name;if(lineItems[z].id===lineId&&"BUCKET_PREORDER_DATE_NOT_SET"===errorType){$scope.basketErrors.push("Please set a pre-order date on item: "+productName);break}if(lineItems[z].id===lineId&&"BUCKET_PREORDER_DATE_EXPIRED"===errorType){$scope.basketErrors.push("Please set a valid pre-order date on item: "+productName);break}}}var bounceUpdate,vm=this;vm.status="",user.checkIfLoyaltyMember().then(function(){$scope.LoyaltyNumber=!0},function(){$scope.LoyaltyNumber=!1}),$scope.loggedIn=user.isSignedIn(),$scope.loadRelatedProducts=function(){if(!$scope.relatedProductsFirstLoadDone){$scope.relatedProductsFirstLoadDone=!0;var basket_id=browserStorage.getItem("basket_id");return basket_id||($scope.relatedProducts=[]),productService.getRelatedProducts(basket_id,3,"Automated Merchandising Up-Sells",!0,basket_id).then(function(data){$scope.relatedProducts=data})["catch"](function(){$scope.relatedProducts=[]})}},$scope.forceBasketReload=function(){$scope.forcedBasketReload||($scope.forcedBasketReload=!0,basket.getBasket(!0).then(function(data){$scope.basket.estimated_delivery_charge=data.estimated_delivery_charge,$scope.basket.estimated_total=data.estimated_total,$scope.basket.delivery_charge=data.delivery_charge,$scope.basket.total=data.total}))},$scope.$watchCollection(function(){return universal_variable.basket.line_items},function(){if($scope.basket=_.clone(universal_variable.basket,!0),$scope.basket&&$scope.basket.line_items){var basketSlider=angular.element("#cartSliderContainer");basketSlider.length&&(basketSlider=basketSlider.scope(),basketSlider.destroySlider()),$scope.basket.line_items=[],setTimeout(function(){$scope.basket=universal_variable.basket},5)}},!0),$scope.relatedProducts=[],$scope.relatedProductsFirstLoadDone=!1,$scope.forcedBasketReload=!1,$scope.remove=basket.removeLineItem,$scope.gtmCheckout=tagManagerService.generateCheckoutEvent,$scope.urlPartFor=productService.urlPartFor,$scope.imagePathFor=productService.imagePathFor,$scope.ajaxStatus=ajaxStatus,$scope.basketErrors=[],user.checkIfLoyaltyMember().then(function(){$scope.showPoints=!0}),$scope.updateQuantity=function(item){$timeout.cancel(bounceUpdate),bounceUpdate=$timeout(function(){item.status=ajaxStatus.pending,basket.updateLineItem(item).then(function(){item.status=ajaxStatus.success,tagManagerService.generateCheckoutEvent($scope.basket,"basket")},function(){item.status=ajaxStatus.error})},200)},$scope.saveForLater=function(item){return wishlistService.addToWishlist(item.product.href.replace("products/",""),item.product.sku_code).then(function(){return basket.removeLineItem(item)}).then(function(){$state.go("basket")})},$scope.validateAndProceedToCheckout=function(){$scope.basketErrors=[],$scope.status="updating",basket.validateBasket().then(function(){$scope.status="",$scope.gtmCheckout($scope.basket),$state.go("checkout")},function(err){$scope.status="",422===err.data.code&&"PREORDER_DATE_ERRORS"===err.data.message&&processPreorderDatesErrors(err.data),$timeout(function(){scrollToAnchorService.scrollTo("basket_errors")},100)})},$scope.addPromoCode=function(params){{var val="",e=params.event,targ=document.getElementById(params.input);params.result}if(targ==e.target){if(e.keyCode&&13!=e.keyCode)return;targ.blur()}targ&&targ.value&&(val=targ.value,basket.addPromoCode(val).then(function(data){data.data&&data.data.message&&($scope.basket.promoCodeError=data.data.message),201===data.status&&($scope.basket.promoCodeError=!1,basket.getBasket())}))},$scope.removePromoCode=function(){var activeVouchers=$scope.basket.vouchers;activeVouchers&&activeVouchers.length>0&&basket.removePromoCode(activeVouchers[0]).then(function(data){204===data.status&&basket.getBasket()})},$rootScope.$on("$stateChangeSuccess",function(e,toState){$rootScope.pageType=toState.page_type}),$scope.$watch("pageType",function(newValue,oldValue){newValue!==oldValue&&oldValue&&"basket"===oldValue.toLowerCase()&&basket.recreateBasket()}),$scope.$on("ngRepeatComplete",function(name,params){setTimeout(function(){params.attrs.repeatType&&"basket"==params.attrs.repeatType},5)})}function BillingController($rootScope,$scope,$state,$log,$q,checkout,addressBook,billingAddress,user,loyaltyService,authentication,universal_variable,passwordPattern,ajaxStatus,order,isLoyaltyMember,tagManagerService){function registerInCheckout(){var details={email:vm.billing.email,password:vm.create_account.password,title:vm.billing.title,first_name:vm.billing.first_name,last_name:vm.billing.last_name,address:vm.billing,join_gardening_club:vm.details.join_gardening_club||!1,show_hide_text:vm.show_hide_text||!1};return vm.gardening_club_number&&(details.gardening_club_number=vm.gardening_club_number),16==(""+vm.card1+vm.card2+vm.card3+vm.card4).trim().length&&(details.gardening_club_number=""+vm.card1+vm.card2+vm.card3+vm.card4),user.register(details).then(function(response){return authentication.signIn({username:response.email,password:vm.create_account.password})}).then(function(){vm.isSignedIn=!0})}function joinGardeningClub(){return function(){return vm.gardening_club_number?loyaltyService.storeCardNumber(vm.gardening_club_number):loyaltyService.joinLoyaltyScheme(vm.billing)}().then(function(){vm.isLoyaltyMember=!0,$rootScope.$emit("user-status")})}var vm=this;vm.selectedYear="",vm.selectedMonth="",vm.selectedDay="",vm.details={join_gardening_club:vm.join_gardening_club||!1},vm.billing=billingAddress,vm.validateEmail=function(){var dto={email:vm.billing.email};return user.validateUser(dto)},vm.validateGCNumber=function(){16==(""+vm.card1+vm.card2+vm.card3+vm.card4).trim().length&&loyaltyService.validateGCNumber(user,""+vm.card1+vm.card2+vm.card3+vm.card4).then(function(){})},order.billing_address?vm.billing=order.billing_address:user.isSignedIn()&&(vm.billing=billingAddress),vm.order=order,vm.isLoyaltyMember=isLoyaltyMember,vm.isSignedIn=user.isSignedIn(),vm.passwordPattern=passwordPattern,vm.extraFields=["phonenumber"],user.requireEmail()["catch"](function(){$log.log("An email address is required"),vm.extraFields.push("email"),(order.billing_address||{}).email&&(vm.email_address_again=order.billing_address.email)}),vm.chooseBillingAddress=function(event){var beforeContinue;event&&event.preventDefault(),vm.billing&&!vm.billingForm.$invalid&&vm.billingForm.status!==ajaxStatus.pending&&(vm.billingForm.status=ajaxStatus.pending,vm.saveAddress&&!vm.billing.address_id&&addressBook.addAddress(vm.billing),vm.details.join_gardening_club&&(vm.billing.selectedDay=vm.selectedDay,vm.billing.selectedMonth=vm.selectedMonth,vm.billing.selectedYear=vm.selectedYear),order.billing_address=vm.billing,vm.create_account&&vm.create_account.password?beforeContinue=registerInCheckout():(vm.gardening_club_number||vm.details.join_gardening_club)&&(user.isSignedIn()?beforeContinue=joinGardeningClub():vm.create_account&&vm.create_account.password&&(beforeContinue=registerInCheckout())),16==(""+vm.card1+vm.card2+vm.card3+vm.card4).trim().length&&user.isSignedIn()&&loyaltyService.getCard(user,""+vm.card1+vm.card2+vm.card3+vm.card4).then(function(){}),$q.when(beforeContinue).then(function(){return checkout.updateAddress("billing",vm.billing)}).then(function(){vm.billingForm.status=ajaxStatus.success,$scope.basket=_.clone(universal_variable.basket,!0),tagManagerService.generateCheckoutEvent($scope.basket,"billing"),$scope.$emit("order-updated"),$state.go("checkout.shipping-info")})["catch"](function(){vm.billingForm.status=ajaxStatus.error}))}}function BirthdayController($scope){var years=[],months=[],days=[],i=0,thisYear=(new Date).getYear(),isLeapYear=function(){var year=$scope.SelectedYear||0;return year%400!==0&&year%100===0||year%4!==0?0:1},getNumberOfDaysInMonth=function(){var selectedMonth=$scope.SelectedMonth||0;return 31-(2===selectedMonth?3-isLeapYear():(selectedMonth-1)%7%2)};for(i=20;thisYear-12>i;i++)years.push(i+1900);for(i=1;13>i;i++)months.push(i);for(i=1;32>i;i++)days.push(i);$scope.UpdateNumberOfDays=function(){$scope.NumberOfDays=getNumberOfDaysInMonth()},$scope.NumberOfDays=31,$scope.Years=years,$scope.Days=days,$scope.Months=months}function BreadcrumbController($scope,$rootScope,$window,$location,browserStorage,breadcrumbsService,universal_variable,_){var wentBack=!1,params={toState:!1,toParams:!1,fromState:!1};$scope.historicBreadcrumb=browserStorage.temporary.getItem("historic_breadcrumb")||{},$scope.$evalAsync(function(){$scope.assignmentsLoaded()}),$scope.assignmentsLoaded=function(){$scope.popCrumbs()},$scope.popCrumbs=function(){function cameFromListingPage(){return params.fromState?"category"===params.fromState.page_type||"search"===params.fromState.page_type:void 0}function nowOnDetailsPage(){return params.toState?"product"===params.toState.page_type||"ensemble"===params.toState.page_type:void 0}breadcrumbsService.getCrumbsForPage($location.path(),params.toState,params.toParams).then(function(crumbs){$scope.crumbs=params.toState.noBreadCrumb?[]:_.cloneDeep(crumbs),"mobile"==$scope.$root.screenSize;for(var noCrumb=["/cms/","/shop/","/content/"],i=0;i<$scope.crumbs.length;i++)for(var j=0;j<noCrumb.length;j++)if(0===$scope.crumbs[i].link.toLowerCase().search(noCrumb[j])&&3===$scope.crumbs[i].link.split("/").length){$scope.crumbs.splice(i,1),i--;break}if(universal_variable.page.breadcrumb=crumbs.map(function(crumb){return crumb.name}),"mobile"==$scope.$root.screenSize){var l=$scope.crumbs.length;l>1&&($scope.crumbs=$scope.crumbs.splice(l-2),$scope.crumbs[0].name="Back to "+$scope.crumbs[0].name)}}),cameFromListingPage()&&nowOnDetailsPage()?(wentBack||($scope.historicBreadcrumb={resultsUrl:$scope.oldUrl,productUrl:$scope.newUrl},browserStorage.temporary.setItem("historic_breadcrumb",$scope.historicBreadcrumb)),$scope.showBackLink=!!$scope.historicBreadcrumb.resultsUrl):params&&params.fromState&&($scope.showBackLink=!params.fromState.page_type&&nowOnDetailsPage()&&$scope.historicBreadcrumb.resultsUrl),wentBack=!1},$rootScope.$on("$locationChangeStart",function(e,newUrl,oldUrl){$scope.oldUrl=oldUrl.replace(/http:\/\/[^\/]*/,""),$scope.newUrl=newUrl.replace(/http:\/\/[^\/]*/,"")}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState){params={toState:toState,toParams:toParams,fromState:fromState},$scope.popCrumbs()}),$window.onpopstate=function(){wentBack=!0}}function CheckoutSignInController($state,authentication,universal_variable){var vm=this,onLoginComplete=function(){$state.transitionTo("checkout",null,{location:"replace"})};return universal_variable.basket.line_items.length?(vm.onLoginComplete=onLoginComplete,void(vm.login=function(event){event.preventDefault();var button=$(event.target).find("button[type='submit']");return vm.signin.$invalid?!1:(button.addClass("updating"),vm.signInError=null,void authentication.signIn({username:vm.email,password:vm.password}).then(onLoginComplete,function(error){vm.signInError=error.message,button.removeClass("updating")}))})):($state.transitionTo("basket",null,{location:"replace"}),!1)}function CheckoutController($scope,$state,checkout,user,order,universal_variable,$location,overlay,productService,calendar){var vm=this;if($scope.urlPartFor=productService.urlPartFor,$scope.imagePathFor=productService.imagePathFor,!universal_variable.basket.line_items.length)return $state.transitionTo("basket",null,{location:"replace"}),!1;vm.order=order,vm.dontAsk=!1,vm.order&&vm.order.localData&&vm.order.localData.cal&&vm.order.localData.cal.day_delivery_dates?(console.log("EVT- create checkout cal"),vm.summaryCalendar=calendar.newCal({$scope:$scope,local:vm.order.localData.cal,addFunction:checkout.chooseShippingDate})):console.log("EVT- cal Error ",vm.order,vm.order.localData,vm.order.localData.cal,vm.order.localData.cal.day_delivery_dates),vm.isSignedIn=user.isSignedIn(),vm.isSignedIn&&user.getUserDetails().then(function(details){vm.userEmail=details.email}),$scope.$on("order-updated",function(){checkout.getOrder().then(function(updatedOrder){vm.order=updatedOrder})}),"checkout"===$state.current.name&&(vm.isSignedIn?$state.go("checkout.billing-info",null,{location:"replace",notify:!0}):$state.transitionTo("checkout-sign-in",null,{location:"replace",notify:!0})),$scope.fromLink=!1;var doFull=!1,clearEvents=function(){vm.dontAsk=!1};if(doFull){var findHREF=function(targ){for(var hrefs=["href","data-ng-href","ng-href"],i=0;i<hrefs.length;i++)if(targ.getAttribute(hrefs[i]))return targ.getAttribute(hrefs[i]);return!1},storeLinkClick=function(e){var targ=e.currentTarget,link=findHREF(targ);link&&($scope.fromLink=link)},unstoreLinkClick=function(e){var targ=e.currentTarget,link=findHREF(targ);link&&$scope.fromLink==link&&($scope.fromLink=!1)};clearEvents=function(){$("a").off("mouseover focus",storeLinkClick),$("a").off("mouseout blur",unstoreLinkClick)},$("a").on("mouseover focus",storeLinkClick),$("a").on("mouseout blur",unstoreLinkClick)}var ask=$scope.$on("$locationChangeStart",function(e,newUrl,oldUrl){if(-1!=newUrl.search($scope.fromLink)||vm.dontAsk)clearEvents();else{for(var defaultGoURL="/basket/",check=["step-","/basket/","/sign-in"],checkInt=0;checkInt<check.length;checkInt++)if(-1!=newUrl.search(check[checkInt])){if(0===checkInt){var end=newUrl.split(check[checkInt]),start=oldUrl.split(check[checkInt]);if(start.length<=1){checkInt=check.length;break}if(end.length<=1)break;if(end=parseInt(end.pop()),start=parseInt(start.pop()),end>start){checkInt=check.length;break}break}break}if("/checkout/"===newUrl&&-1!=oldUrl.search("step-")&&(checkInt=check.length-1),checkInt<check.length){if(-1!=newUrl.search("/sign-in/forgotten-password/"))return;e.preventDefault(),overlay.confirm('Using the "Back" button could cause you to lose any information entered in Checkout. Do you want to continue and possibly lose entered information?',function(bool){if(bool){ask(),clearEvents();var n=-1;0===checkInt&&(n=-parseInt(oldUrl.split("step-").pop())),isNaN(n)||n>history.length?$location.ulr(defaultGoURL):(user.isSignedIn()||n--,history.go(n))}},!1,!1)}else clearEvents()}})}function ClippingsController($q,wishlist,lineItems,wishlistService,productService,basket,messages,ajaxStatus,_){function allVariantsSelected(){var anyMissing=vm.lineItems.some(function(item){return!item.product.selectedVariant});return!anyMissing}function getProducts(){wishlistService.getWishlist().then(function(newWishlist){vm.wishlist=newWishlist,productService.getProductArray(_.pluck(wishlist,"product_id")).then(function(products){vm.lineItems=products.map(function(product){return{product:product,quantity:1}})})})}var vm=this;vm.wishlist=wishlist,vm.lineItems=lineItems,vm.messages={selectVariant:!1},vm.notification=function(params){if(params)switch(params.type){case"selectVariant":vm.messages.selectVariant=params.val}},vm.remove=function(itemID){wishlistService.removeFromWishlist(itemID).then(getProducts)},vm.addWishlistToBasket=function(){var promises=[];return allVariantsSelected()?(vm.notification({type:"selectVariant",val:"false"}),vm.submittedWithoutVariant=!1,vm.basketStatus=ajaxStatus.pending,vm.lineItems.forEach(function(item){promises.push(basket.addLineItem({product:item.product.selectedVariant,quantity:item.quantity}))}),void $q.all(promises).then(function(){vm.basketStatus=ajaxStatus.success},function(errors){vm.basketStatus=ajaxStatus.error,errors.forEach(function(error){messages.push({type:"alert",content:error.message})})})):(vm.submittedWithoutVariant=!0,notification({type:"selectVariant",val:"true"}),!1)}}function CmsContentController($scope,$location,cms,cmsPathExist){$scope.cmsPageExists=!1,cmsPathExist?$scope.cmsPageExists=!0:window.location.replace("/404?url="+encodeURIComponent($location.path()))}function EnsembleDetailController(ensembleData,basket,wishlistService,recentlyViewed,ajaxStatus,messages){var vm=this;vm.ensemble=ensembleData,vm.deliveryBoxy=!1;for(var check={home_delivery:0,click_collect:0,lifetime_guarantee:0,dropship:0},prods=ensembleData.products,len=prods.length,e=0,i=0;len>i;i++)for(e in check)"dropship"===e?prods[i].product.hasOwnProperty("splitordergroup")&&"dropship"===prods[i].product.splitordergroup.toLowerCase()&&check[e]++:prods[i].product[e]&&check[e]++;vm.ensembleDeliveryOptions={};for(e in check)check[e]==len&&(vm.ensembleDeliveryOptions[e]=!0,vm.deliveryBoxy=!0);vm.addToWishlist=function(){for(var prods=[],i=0;i<vm.ensemble.products.length;i++){var p=vm.ensemble.products[i].product;if(!p.selectedVariant)return void messages.push({type:"alert",content:"Please select a variant for "+p.name+" before adding to your saved products."});for(var bAdd=!0,j=0;j<vm.wishlist.length;j++)if(vm.wishlist[j].product_id==p.id){bAdd=!1;break}bAdd&&prods.push({productID:p.id,variantID:p.selectedVariant.id})}prods.length?wishlistService.addListToWishList(prods).then(function(bSuccess){bSuccess&&(location="/my-account/clippings/")}):location="/my-account/clippings/"},wishlistService.getWishlist().then(function(wishlist){vm.wishlist=wishlist}),vm.addToBasket=function(){vm.status=ajaxStatus.pending;for(var ary=[],targs=vm.ensemble.products,i=0;i<targs.length;i++)ary[i]={product:targs[i].product.selectedVariant,quantity:targs[i].meta.quantity};basket.addLineItems(ary).then(function(){vm.status=ajaxStatus.success},function(){vm.status=ajaxStatus.error})},recentlyViewed.addItem(vm.ensemble)}function ErrorController($state){var vm=this;vm.requestUrl=$state.params.url}function FooterController($rootScope,$location,menuService,cms){var vm=this,i=0,ary=[];vm.privacyStatement=!1,vm.checkPrivacyCookie=function(){var c=readCookie("privacyAccepted");c||(vm.privacyStatement=!0);

},vm.acceptPrivacyCookie=function(){createCookie("privacyAccepted","y",3650),vm.privacyStatement=!1},vm.hidePrivacyCookie=function(){vm.privacyStatement=!1},$(document).on("click","a",function(){vm.privacyStatement=!1}),vm.checkPrivacyCookie(),$rootScope.$on("$stateChangeSuccess",function(){cms.getContentForPage($location.path()).then(function(content){for(vm.footer=content.footer,ary=[],i=1;content.footer["section_"+i+"_heading"];)ary.push({name:content.footer["section_"+i+"_heading"],html:content.footer["section_"+i+"_links"]}),i++;vm.menus=ary})}),vm.toggleMoreMenu=function(e){e.preventDefault(),vm.moreMenuOpen=!vm.moreMenuOpen}}function ForgottenPasswordController(passwordService,messages){var vm=this;vm.requestReset=function(e){return e.preventDefault(),vm.forgottenPassword.$invalid?!1:(vm.forgottenPasswordError=null,vm.status="updating",void passwordService.requestResetFor(vm.email).then(function(){vm.status="",messages.push({type:"success",content:"Request successful, you should receive an email shortly."})},function(error){vm.status="",vm.forgottenPasswordError=error.message}))}}function HeadController($rootScope,$location,metaDataService,siteName,browserStorage,tagManagerService){var vm=this;vm.title=siteName,$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams){vm.title=siteName,vm.metatags={},metaDataService.getMetaData($location.path(),toState,toParams).then(function(data){vm.title=data.title||siteName,vm.metatags=data.metatags||{}}),tagManagerService.generatePageView("/search/"===$location.path()?$location.path()+"?query="+toParams.query:$location.path())})}function HeaderController($scope,$rootScope,$window,$location,$sce,cms){function update(){var currentScrollY;ticking=!1,currentScrollY=latestKnownScrollY,$scope.$apply(function(){$scope.scrolled="tablet"===$rootScope.screenSize?currentScrollY>headerHeight:currentScrollY>0})}function requestTick(){ticking||requestAnimationFrame(update),ticking=!0}function onScroll(){latestKnownScrollY=window.scrollY||window.pageYOffset,requestTick()}var headerHeight=107,latestKnownScrollY=0,ticking=!1;$scope.scrolled=!1,$window.addEventListener("scroll",onScroll,!1),$scope.scrollTop=function(event){event&&event.preventDefault(),$window.scrollTo(0,0),$scope.scrolled=!1},$rootScope.$on("$stateChangeSuccess",function(){cms.getContentForPage($location.path()).then(function(content){Object.keys(content.header).forEach(function(key){content.header[key]=$sce.trustAsHtml(content.header[key])}),$rootScope.header=content.header})})}function HighlightContentBlocksController($rootScope){var vm=this;vm.toggleHighlight=function(e){e.preventDefault(),$rootScope.highlightContentBlocks=!$rootScope.highlightContentBlocks}}function LandingPageController(topSellers,categoryData,wishlistService){var vm=this;vm.topSellers=topSellers,vm.category=categoryData.category,vm.subcategories=categoryData._metadata.descendents,wishlistService.getWishlist().then(function(wishlist){vm.wishlist=wishlist})}function LearnMoreController($location,cms){var vm=this;cms.getContentForPage($location.path()).then(function(content){vm.content=content.page.learn_more_overlay})}function MembershipController($state,$rootScope,user,billingAddress,loyaltyService,isLoyaltyMember,messages,storeAccount,totalPoints,titles){function validateAddress(address){var fields=["title","first_name","last_name","line_1","line_2","city","post_code"];return fields.some(function(field){return address[field]&&address[field].length})}function validateStoreAddress(address){var fields=["title","first_name","last_name","line_1","line_2","line_3","line_4","line_5","post_code","phone"];return fields.some(function(field){return address[field]&&address[field].length})}var vm=this;vm.updatedAddress=!1,vm.titles=titles,vm.isSignedIn=user.isSignedIn(),vm.billingAddress=billingAddress,vm.showAddressForm=billingAddress,vm.updatedAddress=!1,vm.details={join_gardening_club:!0},vm.storeAccount=storeAccount,vm.isLoyaltyMember=user.getUserDetails().loyalty_card_number,vm.total_points=totalPoints,vm.updateAddress=function(){vm.updatedAddress=_(vm.billingAddress).clone()},vm.cancelUpdate=function(e){e.preventDefault(),vm.updatedAddress=!1},vm.join=function(e){return e.preventDefault(),vm.addressForm.$invalid||!validateAddress(vm.billingAddress)?!1:("undefined"!=typeof vm.selectedDay&&"undefined"!=typeof vm.selectedMonth&&"undefined"!=typeof vm.selectedYear?(vm.billingAddress.selectedDay=vm.selectedDay,vm.billingAddress.selectedMonth=vm.selectedMonth,vm.billingAddress.selectedYear=vm.selectedYear):(delete vm.billingAddress.selectedDay,delete vm.billingAddress.selectedMonth,delete vm.billingAddress.selectedYear),void loyaltyService.joinLoyaltyScheme(vm.billingAddress).then(function(){$rootScope.$emit("user-status"),$state.go("vouchers")},function(error){messages.push({type:"alert",content:error.message})}))},vm.saveStoreAddress=function(e){return e.preventDefault(),vm.editStoreAddressForm.$invalid||!validateStoreAddress(vm.storeAccount)?!1:void loyaltyService.saveStoreAccount(vm.storeAccount).then(function(){vm.updatedAddress=!1,$state.go("garden-profile")})},vm.orderReplacementCard=function(event){event.preventDefault(),loyaltyService.orderReplacementCard().then(function(){messages.push({type:"success",content:"Your replacement card has been ordered"})},function(error){messages.push({type:"alert",content:error.message})})},vm.linkCard=function(event){event.preventDefault(),loyaltyService.linkCard(user,""+vm.card1+vm.card2+vm.card3+vm.card4).then(function(){messages.push({type:"success",content:"Your card has been linked"})},function(error){messages.push({type:"alert",content:error.message})})}}function MessageController($scope,$timeout,messages){var counter=0;$scope.messages=messages,$scope.closeMessage=function(i){$scope.messages.splice(i,1)},$scope.$watchCollection("messages",function(newMessages,oldMessages){var lastIndex,latestMessage;!newMessages.length||newMessages.length<oldMessages.length||(lastIndex=newMessages.length-1,latestMessage=newMessages[lastIndex],"undefined"==typeof latestMessage.autoclose&&(latestMessage.autoclose=4e3),newMessages[lastIndex].autoclose&&(newMessages[lastIndex].id=counter++,$timeout(function(){var index=angular.copy($scope.messages).reduce(function(output,message,i){return message.id===latestMessage.id&&(output=i),output},0);$scope.closeMessage(index)},latestMessage.autoclose)))})}function NavigationController($scope,$rootScope,menuService,$location,$sce,cms){var vm=this,canCloseNav=!0,canHandleClick=!0,menuTO=!1;menuService.getMenuByAlias("main-menu").then(function(menus){vm.menus=menus,cms.getContentForPage($location.path()).then(function(content){for(var i=0;i<vm.menus.length;i++){var targ=content.header["menu_"+vm.menus[i].name.toLowerCase().replace(/ /g,"_").replace(/&/g,"and")];targ&&(vm.menus[i].cmsContent=$sce.trustAsHtml(targ))}})}),vm.showMobileNav=$rootScope.showNav,vm.toggleMobileNav=function(e){e.preventDefault(),e.stopPropagation(),$(".closeMobileNav").show(),$rootScope.showNav=!$rootScope.showNav},vm.toggleMobileItems=function(e,item){function hasChildren(parentItem){return $(e.target).closest("li").children("ul").children(".open").removeClass("open"),$(e.target).closest("li").toggleClass("open"),!!parentItem.items.length}function closeChildItems(childItems){childItems.forEach(function(childItem){childItem.open=!1})}!$(e.target).closest("li").hasClass("open")&&e.target.href&&e.preventDefault(),canHandleClick&&(hasChildren(item)&&vm.dontFollowLink(e),item.open=!item.open,item.open||closeChildItems(item.items)),canHandleClick=!0},vm.closeNav=function(){canCloseNav&&($rootScope.showNav=!1,vm.selectedMenu=null),$(".closeMobileNav").hide(),canCloseNav=!0},vm.selectMenu=function(index){clearTimeout(menuTO),void 0!==vm.selectedMenu?vm.selectedMenu===index||(vm.selectedMenu=index):menuTO=setTimeout(function(){vm.selectedMenu=index,$scope.$apply()},500)},vm.menuOut=function(){clearTimeout(menuTO)},vm.isShownMenu=function(index){return vm.selectedMenu===index},vm.dontFollowLink=function(e,index){vm.selectedMenu!=index&&e.preventDefault()},vm.dontCloseNav=function(){canCloseNav=!1},vm.dontHandleClick=function(){canHandleClick=!1},vm.stopProp=function(e){e.stopPropagation()},angular.element("body").on("click",function(){$scope.$apply(function(){vm.closeNav()})}),$rootScope.$on("$stateChangeStart",function(){vm.closeNav()})}function NewsletterController($rootScope,newsletter,user,universal_variable,browserStorage){var vm=this;vm.isSignedIn=user.isSignedIn(),vm.newsletter=browserStorage.getItem("newsletter"),vm.isSignedIn&&(vm.email=universal_variable.user.email),vm.signUp=function(){newsletter.subscription("subscribe",vm.email)},$rootScope.$on("user-status",function(e,action){vm.isSignedIn="login"===action})}function OrderConfirmationController($scope,checkout,user,authentication,messages,passwordPattern,order,loyalty,rewards,$window,_){var vm=this,gtmLineItems=[];if(vm.order=order,vm.isSignedIn=user.isSignedIn(),vm.passwordPattern=passwordPattern,vm.isLoyaltyMember=loyalty.card_number,vm.card_number_formated=[],vm.card_number_formated_string="",vm.isLoyaltyMember)for(var i=0;i<vm.isLoyaltyMember.length;i+=4)vm.card_number_formated.push(vm.isLoyaltyMember.substr(i,4));vm.card_number_formated_string=vm.card_number_formated.join("-"),vm.rewards=rewards,vm.loyaltyPoints=loyalty.total_points;var promoCode="";vm.order.vouchers[0]&&(promoCode=vm.order.vouchers[0].toUpperCase());var orderTax="";vm.order.wgc_order_tax&&(orderTax=vm.order.wgc_order_tax),_.each(vm.order.line_items,function(lineItem){var productBrand="";lineItem.product.brand&&(productBrand=lineItem.product.brand),gtmLineItems.push({name:lineItem.product.name,id:lineItem.product.code,price:lineItem.product.unit_price,brand:productBrand,category:lineItem.product.category,variant:lineItem.product.sku_code,quantity:lineItem.quantity})}),$window.dataLayer.push({event:"purchase",ecommerce:{purchase:{actionField:{id:vm.order.order_id,revenue:vm.order.total,tax:orderTax,shipping:vm.order.delivery_charge,paymentmethod:"Credit Card",coupon:promoCode},products:gtmLineItems}}}),vm.register=function(e){return e.preventDefault(),vm.postCheckoutRegistration.$invalid?!1:(vm.registrationError=!1,void user.register({email:order.billing_address.email,password:vm.password,title:order.billing_address.title,first_name:order.billing_address.first_name,last_name:order.billing_address.last_name,address:order.billing_address,join_gardening_club:!1}).then(function(response){return authentication.signIn({username:response.email,password:vm.password})})["catch"](function(error){vm.registrationError=error.message}).then(function(){vm.isSignedIn=!0,messages.push({type:"success",content:"Thank you for registering <strong>"+order.billing_address.email+"</strong>"})}))},$scope.$on("$destroy",function(){checkout.end()})}function OrderDetailsController($state,orderData,user,userDetails){var vm=this;vm.order=orderData,vm.userDetails=userDetails,vm.bDeliverToStore=!1,("cfs"==vm.order.delivery_method.toLowerCase()||"z"==vm.order.delivery_method.toLowerCase())&&(vm.bDeliverToStore=!0),vm.bSameAddress=!0;for(var check=["address","city","county","line_1","line_2","postcode"],i=0;check>i;i++)if(vm.order.billing_address[check[e]]!=vm.order.delivery_address[check[e]]){vm.bSameAddress=!1;break}if(vm.longShipType=!1,vm.order.delivery_method){var shipLUT={S:"Standard Shipping",E:"Overnight Delivery",Z:"In Store Pick-up",CFS:"WGC Collect from Store Delivery",POST:"WGC Post Delivery",COURIER:"WGC Courier Delivery","2MAN":"WGC 2 Man Delivery"};vm.longShipType=shipLUT[vm.order.delivery_method]}vm.orderStatus=vm.order.status.replace(/_/g," "),vm.orderId=$state.params.id}function OrderHistoryController(orderHistory,salesHistory){function pageResult(){vm.orderHistory.currentPage=vm.orderHistory.slice(0+vm.orderHistory.offset,vm.orderHistory.pageSize+vm.orderHistory.offset)}var vm=this;vm.orderHistory=orderHistory,vm.salesHistory=salesHistory,vm.orderHistory.currentPage=[],vm.orderHistory.pages=[],vm.orderHistory.offset=0,vm.orderHistory.pageSize=8,vm.orderHistory.disablePrev=!0,vm.orderHistory.totalPageNumbers=0,pageResult(),vm.orderHistory.totalPageNumbers=Math.ceil(vm.orderHistory.length/vm.orderHistory.pageSize);for(var i=1;i<=vm.orderHistory.totalPageNumbers;i++){var obj={value:i};vm.orderHistory.pages.push(obj)}vm.orderHistory.nextPage=function(){vm.orderHistory.offset+=vm.orderHistory.pageSize,pageResult()},vm.orderHistory.getPage=function(page){vm.orderHistory.offset=vm.orderHistory.pageSize*(page.value-1),vm.orderHistory.currentPage=vm.orderHistory.slice(vm.orderHistory.offset,vm.orderHistory.pageSize+vm.orderHistory.offset)},vm.orderHistory.activePageClass=function(page){return{active:vm.orderHistory.pageSize*(page.value-1)===vm.orderHistory.offset}},vm.orderHistory.previousPage=function(){pageResult(),vm.orderHistory.offset===vm.orderHistory.pageSize&&(vm.orderHistory.disablePrev=!0),0!==vm.orderHistory.offset&&(vm.orderHistory.offset-=vm.orderHistory.pageSize,pageResult())}}function PaymentController($scope,$rootScope,$sce,$state,$log,$timeout,checkout,messages,order,paymentMethods,scrollToAnchorService,universal_variable,tagManagerService){var vm=this,paymentProcessedEvent=null;vm.order=order,vm.paymentInitializationError=!1,vm.displayMessage=function(params){messages.push({type:"alert",content:params.message})},paymentMethods.length?checkout.setPaymentMethod(paymentMethods[0]).then(function(method){$log.info("Hosted payment url: "+method.url),vm.hostedPaymentUrl=$sce.trustAsResourceUrl(method.url)},function(errorData){$log.error('An error occured during the "checkout.setPaymentMethod" call: '+errorData.message+" - "+errorData.description),vm.paymentInitializationError=!0,vm.hostedPaymentUrl="views/checkout/payment_error.html"}):vm.paymentMethods=paymentMethods,paymentProcessedEvent=$scope.$on("payment-processed",function(){checkout.awaitCompletion().then(function(latestOrderData){$scope.basket=_.clone(universal_variable.basket,!0),tagManagerService.generateCheckoutEvent($scope.basket,"payment"),$log.log("Order id: "+latestOrderData.order_id),$state.go("order-confirmation")},function(latestOrderData){messages.push({type:"alert",content:latestOrderData.error_messages})})}),$scope.$on("$destroy",function(){null!==paymentProcessedEvent&&paymentProcessedEvent(),checkout.stopWaiting()}),$timeout(function(){scrollToAnchorService.scrollTo("panel-payment")})}function PlantFinderController($scope,$injector,$location,API,plantFinderData,universal_variable,baseSearchParams,_){function filtersUpdated(){var params=_(angular.copy(vm.answers)).pick(function(value,key){return"page"===key?!1:"object"==typeof value?_(value).values().some():_.isBoolean(value)?value:!_.isNull(value)}).mapValues(function(value){return"object"!=typeof value?value:_(value).pick(_.identity).keys().sortBy().value()}).value(),sortedParams=_(params).keys().sortBy().reduce(function(sorted,key){return sorted[key]=params[key],sorted},{});$location.search(sortedParams).replace(),vm.search.offset=0}function getFilterByKey(key){var index=_.findIndex(vm.search.query.filters,function(filter){return filter.key===key});return{index:index,found:index>-1}}function filterHasValuesApplied(index,values){return _.every(values,function(value){return _.contains(vm.search.query.filters[index].values,value)})}function applyFilter(key,values){vm.search.query.filters.push({key:key,values:values}),filtersUpdated()}function updateFilter(index,values){vm.search.query.filters[index].values=_.union(vm.search.query.filters[index].values,values),filtersUpdated()}function replaceFilter(key,values){var index=getFilterByKey(key).index;vm.search.query.filters[index].values=values,filtersUpdated()}function removeFilter(key,values,index){"undefined"==typeof index&&(index=getFilterByKey(key).index),vm.search.query.filters[index].values=_.difference(vm.search.query.filters[index].values,values),vm.search.query.filters[index].values.length||vm.search.query.filters.splice(index,1),filtersUpdated()}var vm=this;vm.selectOne=function(key,value){var values=value.split(","),match=getFilterByKey(key);match.found?replaceFilter(key,values,match.index):applyFilter(key,values)},vm.selectMany=function(key,value){var values=value.split(","),match=getFilterByKey(key);match.found?filterHasValuesApplied(match.index,values)?removeFilter(key,values,match.index):updateFilter(match.index,values):applyFilter(key,values)},vm.toggleBoolean=function(key){var match=getFilterByKey(key);match.found?removeFilter(key,[!0],match.index):applyFilter(key,[!0])},vm.clearFilter=function(key){var index=getFilterByKey(key).index;vm.search.query.filters.splice(index,1),filtersUpdated()},vm.resetSection=function(event,section){event.preventDefault(),section.questions.forEach(function(question){var actions={"select-one":function(){vm.answers[question.key]=null,vm.clearFilter(question.key)},"select-many":function(){vm.answers[question.key+"[]"]={},vm.clearFilter(question.key)},"boolean":function(){vm.question.answers.forEach(function(answer){delete vm.answers[answer.key],vm.clearFilter(answer.key)})}};actions[question.type]()})},vm.plantFinder=plantFinderData,vm.answers=_.mapValues($location.search(),function(value,key){var checked;if(key.indexOf("[]")>-1){if(checked={},"object"==typeof value)return _.reduce(value,function(map,check){return map[check]=!0,map},checked);if("string"==typeof value)return checked[value]=!0,checked}return value}),universal_variable.search=angular.copy(baseSearchParams),universal_variable.search.query={onlyActive:!0},universal_variable.search.query.filters=_.transform(vm.answers,function(filters,value,key){var values;return"page"===key?(universal_variable.search.offset=universal_variable.search.limit*(parseInt(value,10)-1),filters):(values=_.isBoolean(value)?[!0]:"object"==typeof value?_(value).keys().map(function(val){return val.split(",")}).flatten().uniq().value():value.split(","),filters.push({key:key.replace("[]",""),values:values}),filters)},[]),vm.search=universal_variable.search,vm.imgPath=API.amplience.url+"/i/"+API.amplience.client_id,$injector.invoke(ProductListController,vm,{$scope:$scope})}function PreorderDatesController($scope,$rootScope,$log,$document,preorderDates){function resetMonitorDims(){var d=box.getAttribute("data-calanderPlacement");if(d&&d.length){var cWrap=$(".off-canvas-wrap")[0];cWrap.style.cssText="",box.setAttribute("data-calanderPlacement",""),box.parentElement.style.overflow="",window.scrollTo(oldScrollLeft,oldScrollTop),oldScrollTop=-1,oldScrollLeft=-1}}function monitorDims(iHeight){var r=box.getBoundingClientRect(),h=parseInt(r.bottom-r.top),w=parseInt(r.right-r.left),rootScope=$rootScope;if("mobile"==rootScope.screenSize){if(box.setAttribute("data-calanderPlacement","true"),monitorHeight&&h!=iHeight&&$(window).height()<r.top+h){0>oldScrollTop&&(oldScrollTop=Math.max(Math.max(document.documentElement.scrollTop),Math.max(document.body.scrollTop)),oldScrollLeft=Math.max(Math.max(document.documentElement.scrollLeft),Math.max(document.body.scrollLeft)));var cWrap=$(".off-canvas-wrap")[0];winRect=cWrap.getBoundingClientRect(),cWrap.style.cssText="position:fixed;top:"+winRect.top+"px;width:100%;overflow:hidden",box.parentElement.style.overflow="scroll"}}else resetMonitorDims();clearTimeout(monitorDimstTO),monitorDimstTO=setTimeout(function(){monitorDims(h,w)},500)}function backButton(e){e.preventDefault(),$rootScope.$emit("closeSearchBox")}function escapeKey(e){27===e.keyCode&&$rootScope.$emit("closeSearchBox")}var preorderDatesBoxOverlay,vm=this,monitorDimstTO=(parseInt(navigator.userAgent.toLowerCase().split("msie").pop())<12,"hi there what's up"),monitorHeight=!0,winRect=!1,oldScrollTop=-1,oldScrollLeft=-1,box=$("#preoder-dates-box-overlay .overlay__inner div")[0];vm.stopProp=function(e){e.stopPropagation()},vm.hide=function(){$rootScope.$emit("closePreorderDatesBox")},vm.reset=function(){vm.status="",$scope.itemPreorderDateAvailableQuantityError=!1,$scope.disableConfirmationButton=!0,$scope.formattedPreoderDate="",$scope.availableStockForPreoderDate=0,$scope.selectedPreorderDateRange=""},vm.status="",$scope.disableConfirmationButton=!0,$scope.formattedPreoderDate="",$scope.itemPreorderDateAvailableQuantityError=!1,$scope.availableStockForPreoderDate=0,$scope.selectedPreorderDateRange="",$scope.updatePreoderDateValue=function(){var validationAnswer=preorderDates.isInventoryQuantityAvailable();$scope.itemPreorderDateAvailableQuantityError=!validationAnswer.isValid,$scope.availableStockForPreoderDate=validationAnswer.stockQuantity,$scope.selectedPreorderDateRange=validationAnswer.dateRange,$scope.itemPreorderDateAvailableQuantityError||preorderDates.updatePreoderDateValue()},$scope.changePreorderBucketDate=function(line_item,monthsToShow){preorderDates.changePreorderBucketDate(line_item,monthsToShow)},$rootScope.$on("preorderDateStatusChanged",function(event,ajaxStatus){vm.status=ajaxStatus}),$rootScope.$on("preorderDateChanged",function(event,formatted_chosen_date){$scope.$apply(function(){$scope.disableConfirmationButton=!1,$scope.formattedPreoderDate=formatted_chosen_date})}),$rootScope.$on("openPreorderDatesBox",function(event,formattedPreoderDate){"undefined"!=typeof formattedPreoderDate&&($scope.formattedPreoderDate=formattedPreoderDate);var d=box.getAttribute("data-calanderPlacement");(!d||d&&0===d.length)&&(box.setAttribute("data-calanderPlacement","true"),monitorDims(0,0)),$document.on("keyup",escapeKey).on("backbutton",backButton)}),preorderDatesBoxOverlay=document.getElementById("preoder-dates-box-overlay"),$rootScope.$on("closePreorderDatesBox",function(){vm.reset(),preorderDates.reset(),resetMonitorDims(),box.setAttribute("data-calanderPlacement",""),clearTimeout(monitorDimstTO),preorderDatesBoxOverlay.classList.add("is-hidden"),$document.off("keyup",escapeKey).off("backbutton",backButton)})}function PDPController(productDetailService,productData,relatedProducts,recentlyViewed,wishlist,user,$scope,$location,tagManagerService){var vm=this;vm.product=productData,productDetailService.setupController(vm),vm.ensembleDeliveryOptions=!1,tagManagerService.generateProductDetail(vm.product);var windowSizerTO=0,getWinWidth=function(){var w=-1;return document.body&&document.body.offsetWidth&&(w=document.body.offsetWidth),document.documentElement&&document.documentElement.offsetWidth&&(w=document.documentElement.offsetWidth),window.innerWidth&&window.innerHeight&&(w=window.innerWidth),w},isMoblie=0;getWinWidth()<=767&&(isMoblie=1);var windowSizer=function(){clearTimeout(windowSizerTO),windowSizerTO=setTimeout(function(){var w=getWinWidth();w>=0&&(767>=w?0===isMoblie&&(isMoblie=1,$(".hero-heading.acc-hero-heading").removeClass("open"),$(".hero-heading.acc-hero-heading").next(".accordion-wrapper").css("display","none")):1===isMoblie&&(isMoblie=0,$(".hero-heading.acc-hero-heading").addClass("open"),$(".hero-heading.acc-hero-heading").next(".accordion-wrapper").css("display","flex")))},500)};if($(window).on("resize",windowSizer),$scope.$on("$destroy",function(){$(window).off("resize",windowSizer)}),vm.product.product_detail_9&&(vm.product.product_detail_9=vm.product.product_detail_9.toString().split(",")),vm.product.product_detail_4&&(vm.product.product_detail_4=vm.product.product_detail_4.toString().split(",")),vm.deliveryBoxy=!1,vm.product.hasOwnProperty("splitordergroup")&&"dropship"===vm.product.splitordergroup.toLowerCase())vm.deliveryBoxy=!0;else for(var check=["home_delivery","click_collect","lifetime_guarantee"],i=0;i<check.length;i++)if(vm.product[check[i]]){vm.deliveryBoxy=!0;break}recentlyViewed.addItem(vm.product),vm.relatedProducts=relatedProducts,vm.wishlist=wishlist,vm.isSignedIn=user.isSignedIn(),vm.reviewReturnUrl=encodeURIComponent($location.path());var closeOverlay=$scope.$on("$locationChangeStart",function(){closeOverlay();var targ=$(".template-fullscreen .amp-icon-zoom-close");targ.length&&targ.click()});vm.showHide=function(evt){var w=getWinWidth();if(w>=0&&767>=w){for(var targ=$(evt.target)[0];-1==targ.className.search(/\bhero-heading\b/)&&targ!=document;)targ=targ.parentElement;targ!=document&&($(targ).toggleClass("open"),$(targ).next(".accordion-wrapper").toggle())}}}function ProductListController($rootScope,$scope,user,wishlistService,searchService,orderOptions,universal_variable,$location){var vm=this,firstRun=!0;vm.products=vm.productResults&&vm.productResults.results||[],vm.refinements=vm.productResults&&vm.productResults.refinements||[],vm.meta=vm.productResults&&vm.productResults._metadata||{},vm.isSignedIn=user.isSignedIn(),$scope.$watch(function(){return $location.search()},function(newVal){if(firstRun&&vm.productResults)return void(firstRun=!1);var next=vm.search.limit*(newVal.page-1);isNaN(next)&&(next=0),vm.search.offset=next,searchService.getResults(universal_variable).then(function(data){vm.products=data.results,vm.meta=data._metadata,vm.refinements=data.refinements})},!0),$scope.$watch(function(){return vm.search},function(){return firstRun&&vm.productResults?void(firstRun=!1):void searchService.getResults(universal_variable).then(function(data){vm.products=data.results,vm.meta=data._metadata,vm.refinements=data.refinements})},!0),vm.view=$rootScope.view,vm.updateView=function(view){$rootScope.view=view},vm.isSignedIn&&wishlistService.getWishlist().then(function(wishlist){vm.wishlist=wishlist}),vm.setPageSize=function(size){vm.search.offset=0,vm.search.limit=size},vm.showViewAll=function(){return vm.meta.totalCount<=4*vm.search.limit},vm.viewAll=function(){vm.showViewAll()&&vm.setPageSize(vm.meta.totalCount)},vm.displayedPageSize=function(){return vm.meta.totalCount-vm.search.offset>vm.search.limit?vm.search.limit:vm.meta.totalCount-vm.search.offset},vm.changeOrder=function(option){vm.search.sort=""===option||null===option?searchService.defaultSort(universal_variable.search.query.filters):[option.value],vm.search.sortDropDown=option,vm.order=option},vm.orderOptions=orderOptions,vm.order="",vm.search.sortDropDown&&(vm.order=vm.search.sortDropDown),$scope.$on("$destroy",function(){delete universal_variable.listing})}function QuickLookController(quickLook,productDetailService){var vm=this;vm.product=quickLook.getProduct(),vm.product.meta={quantity:1,buyButtonType:!0},vm.limit=4,productDetailService.setupController(vm)}function RecentController($rootScope,recentlyViewed,user,wishlistService){function getWishlist(){wishlistService.getWishlist().then(function(wishlist){vm.wishlist=wishlist})}var vm=this;vm.products=recentlyViewed.getItems(),user.isSignedIn()&&getWishlist(),$rootScope.$on("user-status",function(action){"login"===action?getWishlist():vm.wishlist=[]})}function ResetPasswordController($state,$location,passwordService,passwordPattern,messages){var vm=this;vm.passwordPattern=passwordPattern,vm.setNewPassword=function(e){return e.preventDefault(),vm.resetPassword.$invalid?!1:void passwordService.setNewPassword($state.params.email,vm.password,$state.params.uid).then(function(){messages.push({type:"success",content:"Password changed successfully, you can now login to your account"}),$location.url("/sign-in/")},function(response){messages.push({type:"alert",content:response.message})})}}function SearchResultsController($scope,$injector,$state,universal_variable,productResults,tagManagerService){var vm=this;vm.productResults=productResults,vm.query=$state.params.query,vm.search=universal_variable.search,$injector.invoke(ProductListController,vm,{$scope:$scope}),tagManagerService.generateImpressionEvent(vm,"Search Results")}function SearchBoxController($rootScope,$document,$state,$scope,$http,API){function backButton(e){e.preventDefault(),$rootScope.$emit("closeSearchBox")}function keyHandler(e){13===e.keyCode?vm.performSearch(e):27===e.keyCode&&$rootScope.$emit("closeSearchBox")}var searchBoxOverlay,vm=this;vm.query=$state.params.query||"",vm.config=API,vm.status="";var isIE11=parseInt(navigator.userAgent.toLowerCase().split("msie").pop())<12,monitorDimstTO=!1,monitorHeight=!0,winRect=!1;$scope.searchAPI=function(userInputString,timeoutPromise){var remoteUrl=vm.config.search_suggest.url;"/"!==remoteUrl.substr(remoteUrl.length-1)&&(remoteUrl+="/");var params=encodeURIComponent(userInputString)+"/true";return $http.get(remoteUrl+params,{timeout:timeoutPromise})},vm.populateSuggestion=function(term){term&&term.title&&(vm.query='"'+term.title+'"',vm.performSearch())},vm.performSearch=function(e){var oneTimer;e&&(e.preventDefault(),e.target.value?vm.query=e.target.value:e.target.query&&(vm.query=e.target.query.value)),vm.status="updating",$state.go("search",{query:vm.query,page:1},{reload:!0}),oneTimer=$rootScope.$on("$stateChangeSuccess",function(){vm.status="",vm.hide(),oneTimer()}),e.target.blur()},vm.stopProp=function(e){e.stopPropagation()},vm.hide=function(){$rootScope.$emit("closeSearchBox")},$rootScope.$on("openSearchBox",function(){$document.on("keyup",keyHandler).on("backbutton",backButton);var locationChange=$scope.$on("$locationChangeStart",function(){locationChange(),closeSearchBoxFunction()});monitorDims(0,0)}),searchBoxOverlay=document.getElementById("search-box-overlay");var closeSearchBoxFunction=function(){clearTimeout(monitorDimstTO);for(var ary=["#tabletNavWrap",".off-canvas-wrap",".overlay__inner","#overlay","#search-box-overlay"],i=0;i<ary.length;i++){var targ=$(ary[i]);targ.length&&(targ[0].style.cssText="")}winRect&&window.scrollTo(0,-winRect.top),winRect=!1,searchBoxOverlay.classList.add("is-hidden"),$document.off("keyup",keyHandler).off("backbutton",backButton)};$rootScope.$on("closeSearchBox",closeSearchBoxFunction);var monitorDims=function(iHeight,iWidth){var box=$("#search-box-overlay .overlay__inner")[0],r=box.getBoundingClientRect(),h=box.scrollHeight,w=parseInt(r.right-r.left);if(monitorHeight&&h!=iHeight&&$(window).height()<r.top+h){var stickyNav=document.getElementById("tabletNavWrap");stickyNav.style.cssText="position:absolute !important;top:auto";var cWrap=$(".off-canvas-wrap")[0];winRect=cWrap.getBoundingClientRect(),cWrap.style.cssText="position:fixed;top:"+winRect.top+"px;width:100%;overflow:hidden";var bH=h,targ=document.getElementById("overlay");targ.style.position="absolute",targ.style.height=document.body.scrollHeight+"px";var t=Math.max(Math.max(document.documentElement.scrollTop),Math.max(document.body.scrollTop))+r.top,off=0;t+h>bH&&(off=bH-(t+h),t=bH-h),0>t&&(off=t,t=0),t+h>bH&&(targ.style.height=t+h),window.scrollBy(0,off),$(".overlay__inner")[0].style.top=t+"px",bH=document.body.scrollHeight,targ=document.getElementById("search-box-overlay"),targ.style.position="absolute",targ.style.height=h+"px",t=Math.max(Math.max(document.documentElement.scrollTop),Math.max(document.body.scrollTop))+r.top,off=0,t+h>bH&&(off=bH-(t+h),t=bH-h),0>t&&(off=t,t=0),t+h>bH&&(targ.style.height=t+h),window.scrollBy(0,off),box.style.top=t+"px"}if(isIE11&&w!=iWidth){var left=($(window).width()-w)/2;0>left&&(left=0),box.style.left=parseInt(left)+"px"}monitorDimstTO=setTimeout(function(){monitorDims(h,w)},500)}}function ShippingController($scope,$state,$timeout,checkout,addressBook,geolocation,storeLocator,order,deliveryMethods,messages,collectionCode,ajaxStatus,scrollToAnchorService,calendar,universal_variable,tagManagerService){function syncStores(response){vm.stores=response.stores;var storeList=document.getElementById("stores-list"),storeListTitle=document.getElementById("stores-list-title");vm.stores.length&&(storeList.classList.remove("is-hidden"),storeListTitle.classList.remove("is-hidden"),vm.selectedStore=vm.stores[0].id),universal_variable.selectedStore&&(vm.selectedStore=universal_variable.selectedStore)}var vm=this,only_stores_with_pickup_available="Y";vm.order=order,vm.order&&(vm.deliveryMethod=vm.order.shipping_carrier_code),vm.order&&vm.order.localData&&vm.order.localData.cal&&vm.order.localData.cal.day_delivery_dates?(console.log("EVT- create ship cal"),vm.furnatureCalendar=calendar.newCal({$scope:$scope,local:vm.order.localData.cal,addFunction:checkout.chooseShippingDate
})):console.log("EVT- error ship cal",vm.order,vm.order.localData,vm.order.localData.cal,vm.order.localData.cal.day_delivery_dates),checkout.getOrder().then(function(latestOrderData){order=latestOrderData}),vm.geoEnabled=geolocation.isEnabled,vm.delivery=order.delivery_address||{},vm.delivery.postcodeValidationError="",vm.billingAddress=order.billing_address,vm.setDeliveryMethod=function(method){checkout.setDeliveryMethod(method).then(function(){$scope.$emit("order-updated")})},vm.deliveryMethods=deliveryMethods,vm.clickCollectAvailable="CFS"===deliveryMethods[0].carrier_code,vm.collectionCode=collectionCode,vm.deliveryMethod?"CFS"==vm.deliveryMethod?storeLocator.getStoresNear(vm.location,only_stores_with_pickup_available).then(syncStores):universal_variable.selectedStore=void 0:deliveryMethods.length&&(deliveryMethods.length>1||(vm.deliveryMethod=deliveryMethods[0].carrier_code,vm.setDeliveryMethod(deliveryMethods[0]))),vm.getStoresNearby=function(){storeLocator.getStoresNearby(only_stores_with_pickup_available).then(syncStores,function(error){messages.push({type:"alert",content:error})})},vm.getStores=function(){return"undefined"==typeof vm.location||""===vm.location?void messages.push({type:"alert",content:"Please enter a town, county, or post code."}):void storeLocator.getStoresNear(vm.location,only_stores_with_pickup_available).then(syncStores)},vm.instantStoreSearch=function(e){return 13===e.keyCode?(e.preventDefault(),void vm.getStores()):void 0},vm.chooseCollection=function(e){return e.preventDefault(),vm.selectedStore&&vm.collectionForm.status!==ajaxStatus.pending?(vm.collectionForm.status=ajaxStatus.pending,void checkout.chooseCollection(vm.selectedStore).then(function(){universal_variable.selectedStore=vm.selectedStore,vm.collectionForm.status=ajaxStatus.success,$scope.$emit("order-updated"),$state.go("checkout.payment")},function(){vm.collectionForm.status=ajaxStatus.error,messages.push({type:"alert",content:"Please select a garden centre.",autoclose:4e3})})):void messages.push({type:"alert",content:"Please select a garden centre.",autoclose:4e3})},vm.chooseDelivery=function(e){if(e.preventDefault(),checkout.getOrder().then(function(latestOrderData){order=latestOrderData}),vm.deliveryForm.status!==ajaxStatus.pending){if(vm.sameAsBilling){var message=vm.delivery.message;vm.delivery=order.billing_address,vm.delivery.message=message,order.delivery_address=order.billing_address,order.delivery_address.message=message}else{if(vm.delivery.postcodeValidationError="",vm.deliveryForm.postcode.$setValidity("",!0),vm.deliveryForm.$invalid)return;vm.saveAddress&&!vm.delivery.address_id&&addressBook.addAddress(vm.delivery)}vm.deliveryForm.status=ajaxStatus.pending,order.delivery_address=vm.delivery,checkout.updateAddress("delivery",vm.delivery).then(function(){vm.deliveryForm.status=ajaxStatus.success,$scope.basket=_.clone(universal_variable.basket,!0),tagManagerService.generateCheckoutEvent($scope.basket,"delivery"),$scope.$emit("order-updated"),$state.go("checkout.payment")},function(err){vm.deliveryForm.status=ajaxStatus.error,err.description&&-1!==err.description.indexOf("postcode")&&(vm.delivery.postcodeValidationError=err.description,vm.deliveryForm.postcode.$setValidity("",!1),scrollToAnchorService.scrollTo(vm.sameAsBilling?"same-as-delivery":"postcode"))})}},$timeout(function(){scrollToAnchorService.scrollTo("panel-shipping")})}function SignInController($stateParams,$location,authentication,user,scrollToAnchorService,passwordPattern,titles,loyaltyService,tagManagerService,ajaxStatus,messages){var vm=this,onLoginComplete=function(){vm.newRegistration&&tagManagerService.generateRegistrationEvent(),$location.url(vm.returnUrl?vm.returnUrl:$stateParams.return_url?$stateParams.return_url:"/")};vm.card1="",vm.card2="",vm.card3="",vm.card4="",vm.selectedYear="",vm.selectedMonth="",vm.selectedDay="",vm.returnUrl=$stateParams.return_url,vm.newRegistration=!1,vm.required=$stateParams.required,vm.onLoginComplete=onLoginComplete,vm.isSignedIn=user.isSignedIn(),vm.passwordPattern=passwordPattern,vm.titles=titles,vm.details={title:titles[0],join_gardening_club:!1,join_signIn:!0};var locSearch=$location.search();locSearch.newcustomer&&"true"===locSearch.newcustomer&&($("#join_signIn-noAccount").click(),vm.details=!1),vm.validateEmail=function(){var dto={email:vm.details.email};return user.validateUser(dto)},vm.login=function(event){return event.preventDefault(),vm.signin.$invalid?!1:(vm.signInError=null,vm.status=ajaxStatus.pending,void authentication.signIn({username:vm.email,password:vm.password}).then(onLoginComplete,function(error){vm.signInError=(error||{}).message,vm.status=ajaxStatus.error}))},vm.register=function(event){function registrationError(error){vm.status=ajaxStatus.error;var errMsg=error.message;"undefined"!=typeof error.description&&(errMsg+=" "+error.description),messages.push({type:"alert",content:errMsg})}return event.preventDefault(),vm.registration.$invalid?!1:(vm.details.join_gardening_club&&(vm.details.address.selectedDay=vm.selectedDay,vm.details.address.selectedMonth=vm.selectedMonth,vm.details.address.selectedYear=vm.selectedYear),vm.details.gardening_club_number=""+vm.card1+vm.card2+vm.card3+vm.card4,vm.registrationError=null,vm.newRegistration=!0,vm.status=ajaxStatus.pending,void user.register(vm.details).then(function(response){return messages.push({type:"success",content:"Registration successful for user "+vm.details.email,autoclose:4e3}),authentication.signIn({username:response.email,password:vm.details.password}).then(function(){vm.status=ajaxStatus.success,vm.onLoginComplete()},registrationError)},registrationError))},vm.validateGCNumber=function(){16==(""+vm.card1+vm.card2+vm.card3+vm.card4).trim().length&&loyaltyService.validateGCNumber(user,""+vm.card1+vm.card2+vm.card3+vm.card4).then(function(){})}}function SiteManagerService($rootScope,$http,$q,$log,$sce,API,messages){var service=this;return service.getParameter=function(param){return service.getParameter(param,"")},service.getParameter=function(param,defaultValue){return defaultValue||(defaultValue=""),$http({url:API.site_manager.url+"/"+param+"/"+defaultValue+"/",method:"GET"}).then(function(response){return 200!==response.status?$q.reject(response.data):response.data},function(error){var handleError={401:function(){return $log.error("Not authorised to retrieve site parameters"),defaultValue},403:function(){return $log.error("Not authorised to retrieve site parameters"),defaultValue},404:function(){return $log.error("No parameter found with name "+param),defaultValue},unknown:function(){return messages.push({type:"alert",content:"Failed to retrieve site parameter from the server."}),defaultValue}};return(handleError[error.status]||handleError.unknown)()})},service}function setTransactionalSite($rootScope){$rootScope.transactionalSite=!0}function StoreDetailController($scope,$sce,$location,API,storeData,storeEvents,storeDetails,user,messages){$scope.store=storeData,$scope.map={center:storeData.location,zoom:15,markers:[storeData]},$scope.marker={location:storeData.location},$scope.articleUrl=$sce.trustAsResourceUrl(API.wordpress.url+"/"+storeData.store_details);for(var check=["end_date","start_date"],i=0;i<storeEvents.length;i++)for(var j=0;j<check.length;j++){var targ=storeEvents[i][check[j]];if(targ){var a=targ.split(" ");"00:00"==a[a.length-1]&&a.pop(),storeEvents[i][check[j]]=a.join(" ")}}$scope.storeEvents=storeEvents,$scope.storeDetails=storeDetails,$scope.isSignedIn=user.isSignedIn(),user.getPreferredStore().then(function(store_id){$scope.homeCentre=store_id+""}),$scope.setMyHomeCentre=function(store){user.setPreferredStore(store.id).then(function(){messages.push({type:"success",content:"<strong>"+store.name+"</strong> has been saved as your home centre!",autoclose:5e3}),$scope.homeCentre=store.id,$scope.homeCemtreMessage=store.name+" has been saved as your home centre!"},function(error){messages.push({type:"alert",content:error&&error.message?error.message:"Updating your home centre failed, sorry :("})})},$scope.removeMyHomeCentre=function(store){user.setPreferredStore("-1").then(function(){messages.push({type:"success",content:"<strong>"+store.name+"</strong> has been removed as your home centre!",autoclose:5e3}),$scope.homeCentre="-1",$scope.homeCemtreMessage=store.name+" has been removed as your home centre!"},function(error){messages.push({type:"alert",content:error&&error.message?error.message:"Updating your home centre failed, sorry :("})})}}function StoreLocatorController($location,$scope,storeLocator,geolocation,geocodeService,user,messages,_){function showStores(data){vm.map.center.latitude=data.location.latitude,vm.map.center.longitude=data.location.longitude,vm.map.markers=data.stores,vm.map.markers.length>-1&&(vm.map.zoom=9),$location.search("location",data.location.latitude+","+data.location.longitude),_.each(vm.map.markers,function(marker){marker.showWindow=!1,marker.closeClick=function(){marker.showWindow=!1,$scope.$evalAsync()},marker.onClick=function(){vm.onMarkerClicked(marker)}});var mapMarkers=vm.map.markers;for(i=0;i<mapMarkers.length;i++)"Y"==mapMarkers[i].collect_in_store&&(mapMarkers[i].badge="click-and-collect-available-icon"),"C"==mapMarkers[i].collect_in_store&&(mapMarkers[i].badge="click-and-collect-coming-soon-icon"),"T"==mapMarkers[i].collect_in_store&&(mapMarkers[i].badge="click-and-collect-unavailable-icon"),"N"==mapMarkers[i].collect_in_store&&(mapMarkers[i].badge="click-and-collect-not-available-icon")}var vm=this,lastMarker=null;vm.map={zoom:6,markers:[],center:{latitude:53,longitude:-2}},vm.onMarkerClicked=function(marker){_.each(vm.map.markers,function(prevMarker){prevMarker.show=!1}),marker.showWindow=!0,$scope.$digest()},vm.switchMarkers=function(marker){null!==lastMarker&&(lastMarker.show=!1,lastMarker.showWindow=!1),marker.showWindow=!0,lastMarker=marker},vm.geoEnabled=geolocation.isEnabled,vm.getStoresNearby=function(){vm.location="your current location",geolocation.getLocation().then(function(position){storeLocator.getStores(position.coords).then(showStores)},function(error){messages.push({type:"alert",content:error})})},vm.getStores=function(){vm.location=vm.postcode,geocodeService.lookUpAddress(vm.postcode).then(function(coords){storeLocator.getStores(coords).then(showStores)})},vm.isSignedIn=user.isSignedIn(),user.getPreferredStore().then(function(store_id){vm.homeCentre=store_id+""}),vm.setHomeCentre=function(store){user.setPreferredStore(store.id).then(function(){messages.push({type:"success",content:"<strong>"+store.name+"</strong> has been saved as your home centre!",autoclose:5e3}),vm.homeCentre=store.id,vm.homeCemtreMessage=store.name+" has been saved as your home centre!"},function(error){messages.push({type:"alert",content:error&&error.message?error.message:"Updating your home centre failed, sorry :("})})},function(location){var coords;location&&location.length&&(coords=location.split(","),coords.length<2||storeLocator.getStores({latitude:coords[0],longitude:coords[1]}).then(showStores))}($location.search().location)}function SubcategoryController($scope,$rootScope,$injector,universal_variable,categoryName,productResults,tagManagerService){var vm=this;vm.productListTitle=categoryName,vm.search=universal_variable.search,vm.productResults=productResults,$injector.invoke(ProductListController,vm,{$scope:$scope}),tagManagerService.generateImpressionEvent(vm,"Subcategory")}function TabsController($rootScope,$location,keyHandler){function getCurrentIndex(){var index=0;return vm.tabs.some(function(tab,i){return tab.selected?(tab.selected=!1,index=i,!0):!1}),index}function selectTabByIndex(index){vm.tabs[index].selected=!0}function selectTabByKeypress(keyword){var index=getCurrentIndex(),first=function(){return 0},last=function(){return vm.tabs.length-1},prev=function(){return index--,0>index?vm.tabs.length-1:index},next=function(){return index++,index>=vm.tabs.length?0:index},getIndexForKeypress={LEFT:prev,UP:prev,END:last,HOME:first,RIGHT:next,DOWN:next};index=getIndexForKeypress[keyword](),selectTabByIndex(index)}function anchorTab(bFirst){if(0!==vm.tabs.length){var hash=$location.hash(),index=getCurrentIndex(),bFound=!1;if(bFirst===!0&&(bFound=!0),hash.length||bFirst===!0){{vm.tabs.forEach(function(tab,i){return tab.id!==hash?!1:(bFound=!0,index=i,!0)})}if(bFound&&hash.length&&bFirst===!0){var targ=vm.tabs[index].elm;if(!targ.length)return;targ=targ[0];clearTimeout(scrollTO);var scroll=function(){var r=targ.getBoundingClientRect();window.scrollBy(r.left,r.top)};scrollTO=setTimeout(scroll,500)}}selectTabByIndex(index)}}var watchOnce,scrollTO,vm=this;vm.tabs=[],vm.selectTab=function(event,newTab){var index=getCurrentIndex();event&&event.preventDefault(),vm.tabs.some(function(tab,i){return tab.name!==newTab.name?!1:(index=i,!0)}),selectTabByIndex(index)},vm.handleKeyboard=function(event){keyHandler.handleEvent(event,["END","HOME","LEFT","UP","RIGHT","DOWN"],function(e,key){e.preventDefault(),selectTabByKeypress(key)})},vm.addTab=function(tab){vm.tabs.push(tab)};var aTO=!1;$rootScope.$on("$locationChangeSuccess",anchorTab),watchOnce=$rootScope.$watch(function(){return vm.tabs},function(tabs){0!==tabs.length&&(clearTimeout(aTO),aTO=setTimeout(function(){anchorTab(!0),watchOnce()},50))})}function TermsConditionsController($location,cms){var vm=this;cms.getContentForPage($location.path()).then(function(content){vm.content=content.page.terms_conditions_overlay})}function UserController($rootScope,$state,$location,universal_variable,user,authentication){var vm=this;vm.isSignedIn=user.isSignedIn(),user.getUserDetails().then(function(userDetails){vm.user=userDetails}),vm.signIn=function(event){event&&event.preventDefault(),$state.go("sign-in",{return_url:$location.url()})},vm.signOut=function(event){event&&event.preventDefault(),authentication.signOut().then(function(){$location.path("/")})},$rootScope.$on("user-status",function(e,action){"login"===action&&(vm.user=universal_variable.user),vm.isSignedIn=user.isSignedIn()})}function VouchersController(userInfo,rewards,loyaltyService,messages){var vm=this;vm.points=userInfo,vm.rewards=rewards,vm.orderReplacementCard=function(event){event.preventDefault(),loyaltyService.orderReplacementCard().then(function(){messages.push({type:"success",content:"Your replacement card has been ordered"})},function(error){messages.push({type:"alert",content:error.message})})}}function AccountProfileHeader($location){return{restrict:"E",templateUrl:"/assets/partials/my-account/profile-header.html",link:function(scope){scope.menu=[{name:"Garden profile",url:"/my-account/garden-profile/",type:"primary"},{name:"Account Preferences",url:"/my-account/account-preferences/",type:"primary"},{name:"Rewards",url:"/my-account/vouchers/",type:"primary"},{name:"Join gardening club",url:"/membership/",type:"secondary"}],scope.url=$location.url()},replace:!0}}function AccountSideNav(user){return{restrict:"A",link:function(scope){scope.isGardenClub=!1,user.getUserDetails().then(function(obj){scope.isGardenClub=obj.loyalty_card_number?"yes":"no"})}}}function AddressFormDirective(user,addressBook,titles,addressLookup,ajaxStatus){return{restrict:"EA",templateUrl:"/assets/partials/address-form.html",scope:{model:"=",saveAddress:"=",noSave:"=",hideName:"=",hideAddressBook:"=",form:"="},controller:function(){var vm=this;vm.addressBook=[],vm.isSignedIn=user.isSignedIn(),vm.titles=titles,vm.model=vm.model||{},vm.model.title=vm.model.title||titles[0],vm.isSignedIn&&addressBook.getAddresses().then(function(addresses){addresses&&(vm.addressBook=addresses,vm.selectFromAddressBook=function(address){vm.showAddressBook=!1,vm.model=address})}),vm.addNewAddress=function(e){e.preventDefault(),vm.showAddressBook=!1,vm.model={title:titles[0]}},vm.oneLineAddress=addressLookup.oneLineAddress,vm.addressPicked=function(newAddress){vm.model=addressLookup.replaceAddress(vm.model,newAddress)},vm.lookupAddress=function(){vm.lookupStatus=ajaxStatus.pending,addressLookup.findAddress(vm.building_number,vm.postcode_lookup).then(function(addresses){return vm.lookupStatus=ajaxStatus.success,vm.postcodeLookupError=!1,1===addresses.length?void vm.addressPicked(addresses[0]):void(vm.addressOptions=addresses)},function(error){vm.addressOptions=[],vm.lookupStatus=ajaxStatus.error,vm.postcodeLookupError=error.message})},vm.handlePostcodeSubmit=addressLookup.handlePostcodeSubmit(vm.lookupAddress)},controllerAs:"af",bindToController:!0}}function AmplienceCarouselDirective($rootScope,API,amp){return{restrict:"A",scope:{product:"="},link:function(scope,element){amp.createViewer({set:scope.product.id+"_ms",account:"wgc",path:API.amplience.url+"/",templates:{imageZoom:"$gc_full$",imageMain:"$gc_main$",imageThumb:"$gc_thumb$"},seoFriendlyName:scope.product.name,mobile:"mobile"===$rootScope.screenSize,target:element})}}}function backButtonCheckDirective(overlay,$location){return{restrict:"A",scope:{url:"@"},link:function(scope){var pass=scope.url,returnToCart=scope.$on("$locationChangeStart",function(e,newUrl){-1===newUrl.search(pass)&&(overlay.confirm("CHANGE ME: Are you sure you want to navigate away from checkout?",function(bool){bool&&(returnToCart(),$location.url("/"+newUrl.split("/").slice(3).join("/")))},!1,!1),e.preventDefault())})}}}function CMSContentDirective($rootScope,$location,$q,$compile,cms,personalisedContent){function handleError(){return{}}return{restrict:"A",link:function(scope,element,attrs){function getContent(){return $q.all([personalisedContent.getContentForPage()["catch"](handleError),cms.getContentForPage($location.path()).then(function(response){return response.page},handleError)]).then(function(response){var content=response[0][attrs.cmsContent]||response[1][attrs.cmsContent];return content?(content=$.parseHTML(content,document,!0),content=$compile(content)(scope),void element.html(content)):$q.reject()})["catch"](function(){0===location.pathname.search("/checkout/sign-in/")&&"footer_upper"!=element[0].getAttribute("data-cms-content")&&element.html(null)})}attrs.cmsContent&&(getContent(),$rootScope.$on("$stateChangeSuccess",getContent))}}}function CollapseToggleDirective(){return{restrict:"A",controller:["$scope",function($scope){var vm=this;vm.isOpen=!1,vm.toggleContent=function(){vm.isOpen=!vm.isOpen,$scope.$broadcast("toggle-content",vm.isOpen)}}],controllerAs:"collapseToggleScope",bindToController:!0}}function CollapseToggleClickDirective(){return{restrict:"A",require:"^collapseToggle",link:function(scope,element,attrs,ctrl){element.on("click",function(e){e.preventDefault(),ctrl.toggleContent()}),attrs.closeText&&attrs.openText&&scope.$on("toggle-content",function(e,open){element.text(open?attrs.openText:attrs.closeText)})}}}function CollapseToggleContentDirective(){return{restrict:"A",require:"^collapseToggle",link:function(scope,element,attrs,ctrl){ctrl.isOpen||element.hide(),scope.$on("toggle-content",function(e,open){open?element.show():element.hide()})}}}function ConfirmDirective(overlay){return{restrict:"A",link:function(scope){var over=overlay.getScope();scope.displayText=over.displayText,scope.callBack=over.callBack,scope.confirmWrapClass=over.confirmWrapClass,scope.applyAction=function(bool){scope.callBack&&scope.callBack(bool),overlay.hide()}}}}function EditStoreAddressFormDirective(user,addressBook,titles,addressLookup,ajaxStatus){return{restrict:"EA",templateUrl:"/assets/partials/edit-store-address-form.html",scope:{model:"=",saveAddress:"=",noSave:"=",hideName:"=",hideAddressBook:"=",form:"="},controller:function(){var vm=this;vm.addressBook=[],vm.isSignedIn=user.isSignedIn(),vm.titles=titles,vm.model=vm.model||{},vm.model.title=vm.model.title||titles[0],vm.isSignedIn&&addressBook.getAddresses().then(function(addresses){addresses&&(vm.addressBook=addresses,vm.selectFromAddressBook=function(address){vm.showAddressBook=!1,vm.model=address,vm.model.line_4=vm.model.city})}),vm.addNewAddress=function(e){e.preventDefault(),vm.showAddressBook=!1,vm.model={title:titles[0]}},vm.oneLineAddress=addressLookup.oneLineAddress,vm.addressPicked=function(newAddress){vm.model=addressLookup.replaceAddress(vm.model,newAddress),vm.model.line_4=vm.model.city},vm.lookupAddress=function(){vm.lookupStatus=ajaxStatus.pending,addressLookup.findAddress(vm.building_number,vm.postcode_lookup).then(function(addresses){return vm.lookupStatus=ajaxStatus.success,vm.postcodeLookupError=!1,1===addresses.length?void vm.addressPicked(addresses[0]):void(vm.addressOptions=addresses)},function(error){vm.addressOptions=[],vm.lookupStatus=ajaxStatus.error,vm.postcodeLookupError=error.message})},vm.handlePostcodeSubmit=addressLookup.handlePostcodeSubmit(vm.lookupAddress)},controllerAs:"af",bindToController:!0}}function FeaturedProductDirective($rootScope,productAPI){return{restrict:"E",replace:!0,scope:{id:"="},link:function(scope){productAPI.getProduct(scope.id).then(function(product){product.url="/shop/product-name-"+product.variant_id+"/",product.image="//i1.adis.ws/i/wgc/"+product.variant_id+".jpg?$product_list$",scope.product=product})},templateUrl:"/assets/partials/featured-product.html"}}function GigyaConnectionsDirective($window,$log,socialLogin){return{restrict:"E",template:'<div id="connections"></div>',replace:!0,link:function(){"gigya"in $window&&socialLogin.getProviders().then(function(providers){providers.length&&gigya.socialize.showAddConnectionsUI({enabledProviders:providers.join(","),version:2,containerID:"connections",showEditLink:!0,width:"300px",onConnectionAdded:function(eventObj){$log.log(eventObj)}})})}}}function GigyaReviewsDirective($window,$state,$log,$location,socialLogin){return{restrict:"EA",template:'<div id="ratings"></div>',replace:!0,link:function(){"gigya"in $window&&socialLogin.getProviders().then(function(providers){gigya.comments.showCommentsUI({categoryID:"product_detail",streamID:"product-"+$state.params.id,version:2,containerID:"ratings",cid:"",enabledProviders:providers||"facebook,twitter,google,linkedin,yahoo",width:"auto",useSiteLogin:!0,scope:"both",privacy:"public",onBeforeCommentSubmitted:function(eventObj){$log.info(eventObj)},onCommentSubmitted:function(eventObj){$log.info(eventObj)},onSiteLoginClicked:function(){$state.go("sign-in",{return_url:$location.url()})}})})}}}function GigyaShareBarDirective($window,$location,$rootScope){return{restrict:"EA",template:'<div id="social-media-share"></div>',scope:{product:"="},replace:!0,link:function($scope){var act;if("gigya"in $window){act=new gigya.socialize.UserAction,$scope.product&&(act.setTitle($scope.product.name),act.addMediaItem({type:"image",src:"http://i1.adis.ws/i/wgc/"+$scope.product.id+".jpg?$product_list$",href:$location.absUrl()})),act.setLinkBack($location.absUrl());var getShareButtons=function(){return"mobile"===$rootScope.screenSize?[{provider:"share",iconImgUp:"/assets/images/social_share_share.png"},{provider:"email",iconImgUp:"/assets/images/social_share_email.png"},{provider:"facebook",iconImgUp:"/assets/images/social_share_facebook_mobile.png"},{provider:"twitter",iconImgUp:"/assets/images/social_share_twitter_mobile.png"},{provider:"pinterest",iconImgUp:"/assets/images/social_share_pinterest_mobile.png"}]:[{provider:"share",iconImgUp:"/assets/images/social_share_share.png"},{provider:"email",iconImgUp:"/assets/images/social_share_email.png"},{provider:"facebook",iconImgUp:"/assets/images/social_share_facebook.png"},{provider:"twitter",iconImgUp:"/assets/images/social_share_twitter.png"},{provider:"pinterest",iconImgUp:"/assets/images/social_share_pinterest.png"}]};gigya.socialize.showShareBarUI({containerID:"social-media-share",shareButtons:getShareButtons($rootScope.screenSize),userAction:act,iconsOnly:!0,noButtonBorders:!0,deviceType:"auto"}),gigya.socialize.showShareUI({deviceType:"auto"})}}}}function GigyaSocialFeedDirective($window){return{restrict:"E",link:function(scope){"gigya"in $window&&gigya.socialize.getFeed({limit:4,callback:function(response){0===response.errorCode&&response.everyone&&(scope.feed=response.everyone.items,scope.$digest())}})},templateUrl:"/assets/partials/social-feed.html",replace:!0}}function GigyaSocialLoginDirective($window,socialLogin){return{restrict:"EA",scope:{then:"="},controller:function(){var vm=this;"gigya"in $window&&socialLogin.getProviders().then(function(providers){socialLogin.setup(providers.join(",")).then(vm.then)["catch"](function(error){vm.socialSignInError=(error||{}).message||"Social sign in failed."})})},controllerAs:"vm",bindToController:!0,templateUrl:"/assets/partials/gigya-social-login.html",replace:!0}}function AutoResizeDirective(){return{restrict:"A",link:function(scope,element){element.iFrameResize({enableInPageLinks:!0})}}}function OpenOverlayDirective(overlay){return{restrict:"A",link:function(scope,element,attrs){element.on("click",function(e){e.preventDefault(),overlay.show(attrs.openOverlay)})}}}function OrderSummaryDirective(productService){return{restrict:"A",scope:{order:"=",withItems:"=",summaryCalendar:"=",withAddresses:"="},templateUrl:"/assets/partials/checkout/order-summary.html",controller:["$scope",function($scope){$scope.urlPartFor=productService.urlPartFor,$scope.imagePathFor=productService.imagePathFor}]}}function PaginationDirectiveController($scope,$location,_){var vm=this;vm.curPage=0;var getPages=function(){var pageCount=Math.ceil(vm.meta.totalCount/vm.search.limit);return isNaN(pageCount)?[]:_.range(0,pageCount).map(function(i){return{number:i+1,offset:i*vm.search.limit,text:"Page "+(i+1)}})};vm.pages=[],vm.displayPages=[],vm.midPagination=3,vm.maxPagination=5,vm.currentPageNumber=Math.round(vm.search.offset/vm.search.limit)+1,vm.updatePageSelect=function(){var offset=(vm.currentPageNumber-1)*vm.search.limit;vm.setPage(offset)},vm.currentPage=function(){return vm.curPage=Math.round(vm.search.offset/vm.search.limit),vm.curPage},vm.setPage=function(offset){vm.search.offset!=offset&&window.scrollTo(0,0),vm.search.offset=offset,vm.currentPageNumber=vm.currentPage()+1;var page=vm.currentPageNumber;$location.search("page",page>1?page:null)},vm.nextPage=function(){var i=vm.currentPage();i<vm.pages.length-1&&vm.setPage(vm.pages[i+1].offset)},vm.prevPage=function(){var i=vm.currentPage();i>0&&vm.setPage(vm.pages[i-1].offset)},vm.showPagination=function(){return vm.search.limit>0&&vm.search.limit<vm.meta.totalCount},$scope.$watch(function(){return vm.meta},function(){vm.pages=getPages();var tempPages=getPages(),currentPage=vm.currentPage();vm.displayPages=[],vm.displayPages=vm.displayPages.concat(tempPages.splice(0,2));var start=currentPage-2-parseInt(.5*vm.maxPagination);(0>start||isNaN(start))&&(start=0);var end=start+vm.maxPagination,rem=tempPages.length-end;0>rem?start+=rem:(rem=vm.maxPagination-(end-start),0>rem&&(start+=rem)),start>0&&(vm.displayPages.push({dots:!0}),tempPages.splice(0,start));for(var i=0;i<vm.maxPagination&&tempPages.length;i++)vm.displayPages.push(tempPages.splice(0,1)[0]);tempPages.length&&(vm.displayPages.splice(vm.displayPages.length,0,{dots:!0}),vm.displayPages=vm.displayPages.concat(tempPages.splice(tempPages.length-2))),currentPage!==vm.pages.length-1&&vm.displayPages.push({arrow:!0}),0!==currentPage&&vm.displayPages.splice(0,0,{arrow:!0})})}function PaginationDirective(){return{restrict:"A",scope:{search:"=",meta:"="},controller:"PaginationDirectiveController",controllerAs:"vm",bindToController:!0,templateUrl:"/assets/partials/pagination.html"}}function PreviewDirective(){return{restrict:"A",scope:{text:"=",expand:"=",length:"="},templateUrl:"/assets/partials/preview.html",link:function($scope){var maxLength=$scope.length||140,textLength=$scope.text?$scope.text.length:0;$scope.show=$scope.expand&&textLength>maxLength,$scope.display_text=$scope.preview=function(text){return text?maxLength>=textLength?text:text.substr(0,maxLength)+"...":""}($scope.text),$scope.open=!1,$scope.showToggle=function(){$scope.open=!$scope.open,$scope.display_text=$scope.open?$scope.text:$scope.preview}}}}function PriceDirective(){return{restrict:"E",scope:{minPrice:"=",maxPrice:"=",variants:"=",price:"="},templateUrl:"/assets/partials/price.html",replace:!0}}function ProductListDirective(){return{restrict:"EA",scope:{search:"=",productResults:"="},controller:"ProductListController",controllerAs:"vm",bindToController:!0,templateUrl:"/assets/partials/product-list.html"}}function ProductSliderDirective(){return{restrict:"A",link:function(scope,element,attrs){var sliderTO=!1,distroy=function(){if(scope.docIsReady&&scope.parentReady){var slider=scope.slider;if("true"===slider.attr("data-slicked")){scope.watchers,slider.addClass("visibilyHidden");try{scope.slider.unslick()}catch(e){}slider.find(".slick-prev").remove(),slider.find(".slick-next").remove(),slider.find(".slick-list").remove(),slider.removeClass(".slick-initialized"),slider.removeClass(".slick-slider"),slider.attr("data-slicked","false")}}},applySlider=function(){var slider=scope.slider;if(clearTimeout(sliderTO),"true"===slider.attr("data-slicked"))return distroy(),void(sliderTO=setTimeout(function(){applySlider()},1));if(scope.docIsReady&&scope.parentReady){var sliderTypes={"recently-viewed":{dots:!0,infinite:!1,speed:300,slidesToShow:6,slidesToScroll:3,responsive:[{breakpoint:1024,settings:{slidesToShow:4,slidesToScroll:4,infinite:!0,dots:!0}},{breakpoint:767,settings:{slidesToShow:3,slidesToScroll:3}}]},cart:{slidesToShow:3,slidesToScroll:1,centerMode:!1,infinite:!1}},sliderType=sliderTypes[scope.sliderType];clearTimeout(scope.TO),scope.TO=setTimeout(function(){"true"!=slider.attr("data-slicked")&&(slider.removeClass("visibilyHidden"),slider.slick(sliderType),slider.attr("data-slicked","true"))},500)}},runFirst=function(){scope.docIsReady&&scope.parentReady&&(scope.viewReady(),"true"===element.attr("data-autoplay")&&applySlider())};"true"===attrs.sliderwindow?(element.addClass("visibilyHidden"),element.attr("sliderwindow","set"),scope.viewReady=scope.$root.$on("$viewContentLoaded",function(){scope.docIsReady=!0,runFirst()}),scope.cullElm=element.on("$destroy",function(){scope.parentReady=!1,distroy()}),scope.slider=element,scope.sliderType=attrs.slidertype,scope.TO=!1,element.ready(function(){scope.parentReady=!0,runFirst()})):(element.attr("data-slider-index",scope.$index),scope.parentReady&&(scope.$first&&scope.docIsReady||scope.$last)&&applySlider()),scope.destroySlider=function(){distroy()},scope.applySlider=function(){applySlider()},scope.$on("ngRepeatStart",function(){}),scope.$on("ngRepeatComplete",function(name,params){setTimeout(function(){params&&params.attrs&&params.attrs.repeatType&&"basket"==params.attrs.repeatType&&(scope.docIsReady=!0,applySlider())},5)})}}}function ProductThumbDirective($rootScope,productService,user,wishlistService,quickLook,basket,ajaxStatus,_,tagManagerService){return{restrict:"EA",scope:{product:"=",layout:"=",wishlist:"=",meta:"=",lineItems:"=",notification:"=",index:"@"},link:function($scope,element,attrs){attrs.layout||(attrs.layout="grid"),$scope.quickLook=quickLook.show,$scope.isSignedIn=user.isSignedIn(),$scope.product.url="/shop/"+("ensemble"===$scope.product.type?"ensemble-":"")+productService.urlPartFor($scope.product.name,$scope.product.id)+"/",$scope.product.image=productService.imagePathFor($scope.product.id),$scope.productClick=function(){tagManagerService.generateProductClick($scope.product)},$scope.isSaved=function(){var id=$scope.product.id;return $scope.wishlist&&$scope.wishlist.some(function(item){return item.product_id===id})},$scope.addToWishlist=function(){var id=$scope.product.id;$scope.isSaved()?wishlistService.removeFromWishlist(id).then(function(){var index;$scope.wishlist.some(function(item,i){return item.product_id===id?(index=i,!0):!1}),$scope.wishlist.splice(index,1),$scope.meta&&$scope.meta.bRemoveFromProduct&&"undefined"!=typeof $scope.lineItems&&"undefined"!=typeof $scope.meta.prodPos&&$scope.lineItems.splice($scope.meta.prodPos,1)}):wishlistService.addToWishlist(id).then(function(){$scope.wishlist.push({product_id:id})})},$scope.removeFromWishlist=function(){var id=$scope.product.id;

wishlistService.removeFromWishlist(id).then(function(){$scope.updateWishlist_Remove()})},$scope.updateWishlist_Remove=function(){for(var lineIndex=parseInt($scope.index),i=0;i<$scope.wishlist.length;i++)$scope.wishlist[i].product_id==$scope.product.id&&($scope.wishlist.splice(i,1),$scope.meta&&$scope.meta.bRemoveFromProduct&&"undefined"!=typeof $scope.lineItems&&"number"==typeof lineIndex&&$scope.lineItems.splice(lineIndex,1))},$scope.product.selectedVariant=function(){return($scope.product.variants||[]).length?1===$scope.product.variants.length?$scope.product.variants[0]:$scope.isSaved()?_.find($scope.product.variants,{id:_.find($scope.wishlist,{product_id:$scope.product.id}).variant_id}):null:null}(),$scope.product.variants&&1===$scope.product.variants.length&&($scope.selectedVariant=$scope.product.variants[0]),$scope.determinErrorStates=function(){if($scope.notification){$scope.notification({type:"selectVariant",val:!1});for(var hasVarentError=!1,i=0;i<$scope.lineItems.length;i++)if($scope.lineItems[i].meta.hasVarentError&&!hasVarentError){$scope.notification({type:"selectVariant",val:!0}),hasVarentError=!0;break}}},$scope.determinBasketButtonState=function(){if("undefined"==typeof $scope.meta&&($scope.meta={}),$scope.meta.buyButtonType=0,"undefined"==typeof $scope.product.variants)return void($scope.meta.buyButtonType=1);if(!$scope.selectedVariant&&$scope.product.variants.length)return void($scope.meta.buyButtonType=1);if($scope.meta.hasVarentError=!1,$scope.determinErrorStates(),$scope.submittedWithoutVariant=!1,$scope.product.selectedVariant.stock>0)return void($scope.meta.buyButtonType=1);$scope.currentDate=Date.parse(new Date);for(var months={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11},seasons=[],availSeasons=["one","two"],startDate=new Date,endDate=new Date,i=0;i<availSeasons.length;i++){var start="pf_availabilityseason"+availSeasons[i]+"_fromdate",stop="pf_availabilityseason"+availSeasons[i]+"_todate";if("undefined"!=typeof $scope.product[start]&&"undefined"!=typeof $scope.product[stop]){var s=$scope.product[start].split("-");if(3==s.length)startDate.setFullYear(parseInt(s[2]),months[s[1].toLowerCase()],parseInt(s[0]));else{if(s=$scope.product[start].split("/"),3!=s.length)return void($scope.meta.buyButtonType=0);startDate.setFullYear(parseInt(s[2]),parseInt(s[1]),parseInt(s[0]))}if(s=$scope.product[stop].split("-"),3==s.length)endDate.setFullYear(parseInt(s[2]),months[s[1].toLowerCase()],parseInt(s[0]));else{if(s=$scope.product[stop].split("/"),3!=s.length)return void($scope.meta.buyButtonType=0);endDate.setFullYear(parseInt(s[2]),parseInt(s[1]),parseInt(s[0]))}seasons.push({start:startDate.getTime(),end:endDate.getTime()})}}seasons.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(var k=0;k<seasons.length;k++){if($scope.currentDate>seasons[k].start&&$scope.currentDate<seasons[k].end){$scope.meta.buyButtonType=0;break}$scope.meta.buyButtonType=2}},$scope.meta&&$scope.meta.buyButtonType&&$scope.determinBasketButtonState(),$scope.addToBasket=function(){return $scope.meta.hasVarentError=!1,$scope.product.selectedVariant?($scope.notification&&$scope.notification({type:"selectVariant",val:!1}),$scope.status=ajaxStatus.pending,void basket.addLineItem({product:$scope.product.selectedVariant,quantity:$scope.meta.quantity}).then(function(){$scope.status=ajaxStatus.success},function(){$scope.status=ajaxStatus.error})):($scope.meta.hasVarentError=!0,$scope.notification&&$scope.notification({type:"selectVariant",val:!0}),!1)},$rootScope.$on("user-status",function(){$scope.isSignedIn=user.isSignedIn()})},template:['<div class="product-thumb--grid" data-ng-if="layout === \'grid\'" data-ng-include="\'/assets/partials/product-thumb.html\'"></div>','<div class="product-thumb--list" data-ng-if="layout === \'list\'" data-ng-include="\'/assets/partials/product-tile.html\'"></div>','<div class="product-thumb--line-item" data-ng-if="layout === \'line-item\'" data-ng-include="\'/assets/partials/line-item.html\'"></div>','<div class="product-thumb--line-item" data-ng-if="layout === \'line-item-clippings\'" data-ng-include="\'/assets/partials/line-item-clippings.html\'"></div>'].join("")}}function PulseOnUpdateDirective($timeout,$log){var timer;return{restrict:"A",link:function(scope,element,attrs){scope.$watch(attrs.pulseOnUpdate,function(data){return data?($timeout.cancel(timer),element.removeClass("pulse"),$log.log(element[0].offsetHeight),element.text(data).addClass("pulse"),void(timer=$timeout(function(){element.removeClass("pulse")},800))):void element.text(data)})}}}function RefinementsDirective($location,$state){return{restrict:"A",scope:{refinements:"=",view:"=",search:"=",meta:"="},templateUrl:"/assets/partials/refine.html",controller:["$scope",function($scope){var map={},buildMap=function(){map={},$scope.search.refinements&&$scope.search.refinements.forEach(function(filter,filterIndex){map[filter.key]=filterIndex},!0)},refinementsUpdated=function(){var params=$scope.search.refinements.reduce(function(output,refinement){return output[refinement.key]=refinement.values.join("|"),output},{}),sortedParams={},query=$location.search().query||$state.params&&$state.params.query;query&&(params.query=query),Object.keys(params).sort().forEach(function(key){sortedParams[key]=params[key]}),$location.search(sortedParams).replace(),$scope.search.offset=0,buildMap()},openRefinements=[];buildMap(),$scope.isSelected=function(key,value){var values,index=map[key];return"undefined"==typeof index?!1:(values=$scope.search.refinements[index].values,"object"==typeof values?values.some(function(val){return angular.equals(val,value)}):-1!==values.indexOf(value))},$scope.isSelectedSection=function(refinement){return"undefined"!=typeof map[refinement.key]},$scope.addValue=function(key,value){var index=map[key];"undefined"==typeof index?$scope.search.refinements.push({key:key,values:[value]}):$scope.search.refinements[index].values.push(value),refinementsUpdated()},$scope.removeValue=function(key,value){var valueIndex,index=map[key];return"undefined"==typeof index?!1:1===$scope.search.refinements[index].values.length?($scope.search.refinements.splice(index,1),refinementsUpdated()):("object"==typeof value?$scope.search.refinements[index].values.some(function(range,i){return range.to===value.to&&range.from===value.from?(valueIndex=i,!0):void 0}):valueIndex=$scope.search.refinements[index].values.indexOf(value),$scope.search.refinements[index].values.splice(valueIndex,1),void refinementsUpdated())},$scope.updateValue=function(key,value,state){state?$scope.addValue(key,value):$scope.removeValue(key,value)},$scope.clearRefinements=function(){$scope.search.refinements=[],refinementsUpdated()},$scope.isTruncated=function(refinement,$index){return!refinement.truncate_after||refinement.show_all||$index<refinement.truncate_after},$scope.showTruncation=function(refinement){return refinement.truncate_after&&refinement.truncate_after<refinement.values.length},$scope.isSectionOpen=function(key){return openRefinements.indexOf(key)>=0},$scope.toggleOpenSection=function(key){var index=openRefinements.indexOf(key);index>=0?openRefinements.splice(index,1):openRefinements.push(key)},$scope.handleKeypress=function(e,key){switch(e.charCode||e.keyCode){case 32:case 13:e.preventDefault(),$scope.toggleOpenSection(key)}}}]}}function ScrollToAnchorDirective(scrollToAnchorService){return{restrict:"A",link:function(scope,element,attrs){element.on("click",function(e){e.preventDefault(),scrollToAnchorService.scrollTo(attrs.href)})}}}function ScrollToFirstErrorDirective($timeout,scrollToAnchorService){return{restrict:"A",link:function(scope,element){var timeout;element.on("submit",function(){var $invalidElements=element.find(".ng-invalid");$invalidElements.length&&(scrollToAnchorService.scrollTo($invalidElements[0].id),$timeout.cancel(timeout),$invalidElements.addClass("hightlight-invalid-field"),timeout=$timeout(function(){$invalidElements.removeClass("hightlight-invalid-field")},1500))})}}}function ShowPreorderDatesBoxDirective($rootScope){return{restrict:"A",link:function(scope,element){var preorderDatesBoxOverlay=document.getElementById("preoder-dates-box-overlay");element.on("click",function(e){e.preventDefault(),preorderDatesBoxOverlay.classList.remove("is-hidden"),$rootScope.$emit("openPreorderDatesBox")})}}}function ShowSearchBoxDirective($rootScope){return{restrict:"A",link:function(scope,element){var searchBoxOverlay=document.getElementById("search-box-overlay"),searchField=$("input#search-field");element.on("click",function(e){e.preventDefault(),searchBoxOverlay.classList.remove("is-hidden"),searchField.focus(),searchField.val(""),$rootScope.$emit("openSearchBox")})}}}function TabControlDirective(){return{restrict:"A",templateUrl:"/assets/partials/tab-control.html",transclude:!0,controller:"TabsController",controllerAs:"tc",bindToController:!0}}function TabDirective(){return{restrict:"E",templateUrl:"/assets/partials/tab.html",transclude:!0,replace:!0,scope:{name:"@name",id:"@id",data:"@data",hide:"=",remove:"="},require:"^tabControl",link:function(scope,element,attrs,ctrl){return scope.remove?!1:(scope.selected=""===attrs.selected||"true"===attrs.selected||scope.data&&scope.data.length>0,scope.selectTab=function(){ctrl.selectTab(null,scope)},scope.handleKeyboard=ctrl.handleKeyboard,scope.elm=element,void ctrl.addTab(scope))}}}function WatchRepeat(){return{restrict:"A",link:function(scope,element,attrs){scope.$last&&scope.$emit("ngRepeatComplete",{scope:scope,element:element,attrs:attrs}),scope.$first&&scope.$emit("ngRepeatStart",{scope:scope,element:element,attrs:attrs})}}}function AddressBookService($http,$q,$log,user,messages){var service=this,defaultErrorResponse=function(error){return $log.error("AddressBook API error:",JSON.stringify(error,null,4)),$q.reject(error.data)};service.getAddresses=function(type){return $http({url:user.getBaseUrl()+"/addressbook",method:"GET",params:{type:type}}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},defaultErrorResponse)},service.addAddress=function(address){return address.default_shipping=address.default_shipping||!1,address.default_billing=address.default_billing||!1,$http({url:user.getBaseUrl()+"/addressbook",method:"POST",data:address}).then(function(response){return 201!==response.status?$q.reject(response.data):(messages.push({type:"success",content:"New address for "+address.first_name+" "+address.last_name+" created successfully.",autoclose:4e3}),response.data)},defaultErrorResponse)},service.updateAddress=function(address){return address.id?$http({url:user.getBaseUrl()+"/addressbook/"+address.id,method:"PUT",data:address}).then(function(response){return 204!==response.status?$q.reject(response.data):(messages.push({type:"success",content:"Address for "+address.first_name+" "+address.last_name+" has been updated successfully.",autoclose:4e3}),response.data)},defaultErrorResponse):this.addAddress(address)},service.deleteAddress=function(address){return address.id?address.default_billing?(messages.push({type:"alert",content:"Cannot delete default billing address. To delete it, please first make another address your default."}),defaultErrorResponse({data:"Cannot delete default billing address."})):address.default_shipping?(messages.push({type:"alert",content:"Cannot delete default delivery address. To delete it, please first make another address your default."}),defaultErrorResponse({data:"Cannot delete default shipping address."})):($log.log("Deleting address: "+address.id),$http({url:user.getBaseUrl()+"/addressbook/"+address.id,method:"DELETE"}).then(function(response){return 200!==response.status?$q.reject(response.data):(200===response.status&&messages.push({type:"success",content:"Address for "+address.first_name+" "+address.last_name+" has been deleted successfully.",autoclose:4e3}),response.data)},defaultErrorResponse)):defaultErrorResponse({data:"Failed to delete address, no id."})}}function AddressLookupService($http,$q,$log,API,keyHandler){function getNameFromAddress(address){return{title:address.title,first_name:address.first_name,last_name:address.last_name}}var service=this;service.replaceAddress=function(oldAddress,newAddress){return angular.extend(getNameFromAddress(oldAddress),newAddress)},service.oneLineAddress=function(address){return address.line_2?[address.line_1,address.line_2,address.city,address.postcode].join(", "):[address.line_1,address.city,address.postcode].join(", ")},service.handlePostcodeSubmit=function(callback){return function(event){keyHandler.handleEvent(event,["ENTER"],function(e){e.preventDefault(),e.stopImmediatePropagation(),callback()})}},service.findAddress=function(building_number,postcode){return postcode&&""!==postcode?$http({method:"GET",url:API.address_lookup.url,params:{building_number:building_number,postcode:postcode}}).then(function(response){return"object"!=typeof response.data||0===response.data.length?$q.reject(response):response.data})["catch"](function(error){return $log.error("Addresses API error:",JSON.stringify(error,null,4)),$q.reject(error.data&&error.data.message?error.data:{message:"No addresses found, please check your postcode and try again, or enter your address manually below"})}):$q.reject({message:"Please specify a postcode to lookup"})}}function AmplienceService($window){return $window.amp}function ArticlesService($http,$q,$log,API,universal_variable,baseSearchParams){var articles={},getArticles=function(filters){var uv=angular.copy(universal_variable);return uv.search=angular.copy(baseSearchParams),uv.search.query={filters:filters||[]},$http({url:API.search.url+"?type=article",method:"POST",data:uv}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data.results},function(error){return $log.error("Articles API error: ",JSON.stringify(error,null,4)),$q.reject(error.data)})};return articles.relatedToProduct=function(id){return getArticles([{key:"custom_fields.product",values:[id]}])},articles.relatedToCategory=function(category){return getArticles([{key:"custom_fields.category",values:[category]}])},articles.getMetaDataFor=function(path){return path=path.replace("/content/",""),$http({url:API.wordpress.url+"/"+path,params:{json:1},method:"GET"}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data.meta},function(error){return $log.error("Wordpress API error: ",JSON.stringify(error,null,4)),$q.reject(error.data)})},articles}function AuthenticationService($window,$rootScope,$http,$q,$location,$state,$log,API,session,basket,checkout,browserStorage){function defaultErrorResponse(error){return $log.error("Login error:",JSON.stringify(error,null,4)),$q.reject(error.data)}function integrateSiteLogin(sessionInfo){var deferred=$q.defer(),params={siteUID:sessionInfo.user.id,UIDSig:sessionInfo.gigya.signature,UIDTimestamp:sessionInfo.gigya.timestamp,userInfo:{email:sessionInfo.user.email,firstName:sessionInfo.user.first_name,lastName:sessionInfo.user.last_name,newsLetter:sessionInfo.userSubscribedForNewsletter},callback:function(response){deferred.resolve(response)}};return browserStorage.setItem("newsletter",sessionInfo.userSubscribedForNewsletter),sessionInfo.newUser&&(params.newUser=!0),"gigya"in $window&&gigya.socialize.notifyLogin(params),deferred.promise}var authentication=this;authentication.signIn=function(credentials){var request={url:API.authentication.url,method:"POST",data:credentials};return credentials.UIDSignature&&(request.headers={"Accept-Extra":"application/vnd.gigya.com.login+json; version=1.0"}),$http(request).then(function(response){return console.log(response.data),"object"!=typeof response.data?$q.reject(response.data):(session.storeInfo(response.data),response.data.newUser=credentials.newUser,integrateSiteLogin(response.data).then(function(){return $rootScope.$broadcast("user-status","login"),response.data.user}))}).then(function(user){return basket.recreateBasket().then(function(){return user})})["catch"](defaultErrorResponse)},authentication.signOut=function(){return $http({url:API.authentication.url+"/"+session.getInfo().token,method:"DELETE",data:{}}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):(checkout.end(),session.destroy(),"gigya"in $window&&gigya.socialize.logout(),response.data)})["catch"](defaultErrorResponse)},authentication.isRequired=function(event){session.exists()||(event&&event.preventDefault(),$state.go("sign-in",{return_url:$location.url(),required:!0},{replace:!0}))}}function AuthenticationChecker($rootScope,authentication){$rootScope.$on("$stateChangeStart",function(event,stateParams){stateParams.authenticate&&authentication.isRequired(event,stateParams)})}function BasketService($rootScope,$http,$q,$log,browserStorage,API,messages,universal_variable,JSONSelect,tagManagerService){function syncBasket(server_basket){universal_variable.basket=server_basket,universal_variable.basket.total_product_count=universal_variable.basket.line_items.map(function(line_item){return line_item.quantity}).reduce(function(count,quantity){return count+quantity},0),universal_variable.basket.estimated_points=universal_variable.basket.estimated_loyalty_points,$log.log(universal_variable.basket);var basketSlider=angular.element("#cartSliderContainer");setTimeout(function(){basketSlider.length&&(basketSlider=basketSlider.scope(),basketSlider.destroySlider(),basketSlider.applySlider())},50)}function defaultErrorResponse(error){return $log.error("Basket API error:",JSON.stringify(error,null,4)),$q.reject(error.data)}function getIdForLineItem(line_item){return line_item.id?line_item.id:JSONSelect.match(".product:has(.sku_code:val(?)) ~ .id",[line_item.product.sku_code],universal_variable.basket.line_items)[0]}function updateLineItem(line_item){var id=getIdForLineItem(line_item);return id?basket_id?line_item.quantity?$http({url:API.basket.url+"/"+basket_id+"/line_items/"+id+"/",method:"PUT",data:line_item})["catch"](function(error){return messages.push({type:"alert",content:"Failed to update the quantity of <strong>"+line_item.product.name+"</strong> in the basket."}),defaultErrorResponse(error)}):void 0:defaultErrorResponse({data:"no basket id"}):defaultErrorResponse({data:"cannot find product in basket"})}function addLineItem(line_item){var lookUp;return basket_id?(lookUp=JSONSelect.match(".product:has(.sku_code:val(?)) ~ .quantity",[line_item.product.sku_code],universal_variable.basket.line_items),line_item.quantity=line_item.quantity||1,lookUp.length?(line_item.quantity+=lookUp[0],updateLineItem(line_item)):$http({url:API.basket.url+"/"+basket_id+"/line_items/",method:"POST",data:line_item})["catch"](function(error){return 403===error.status?($log.error("Not authorised to access basket with id "+basket_id+", creating another one."),basketAPI.recreateBasket().then(function(){return addLineItem(line_item)})):409===error.status?updateLineItem(line_item):(error.data&&error.data.message&&messages.push({type:"alert",content:error.data.message}),defaultErrorResponse(error))})):defaultErrorResponse({data:"no basket id"})}function addLineItems(line_items){return basket_id?$http({url:API.basket.url+"/"+basket_id+"/add_line_items/",method:"POST",data:line_items})["catch"](function(error){return 403===error.status?($log.error("Not authorised to access basket with id "+basket_id+", creating another one."),basketAPI.recreateBasket().then(function(){return addLineItems(line_items)})):409===error.status?(error.data&&error.data.message&&messages.push({type:"alert",content:error.data.message}),error.status=201,error):(error.data&&error.data.message&&messages.push({type:"alert",content:error.data.message}),defaultErrorResponse(error))}):defaultErrorResponse({data:"no basket id"})}var basketAPI={},basket_id=browserStorage.getItem("basket_id");return basketAPI.createBasket=function(basket){return $http({url:API.basket.url+"/",method:"POST",data:basket||{}}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):(basket_id=response.data.id,browserStorage.setItem("basket_id",basket_id),$log.info("Created new basket with id: "+basket_id),syncBasket(response.data),response.data)},defaultErrorResponse)},basketAPI.recreateBasket=function(){return basketAPI.createBasket({id:basket_id})},basketAPI.validateBasket=function(){return $http({url:API.basket.url+"/"+basket_id+"/validate",method:"POST"}).then(function(response){return 204!==response.status?$q.reject(response.data):response.data},function(error){return $q.reject(error)})},basketAPI.getBasket=function(skipSyncBasket){return basket_id?($log.info("Fetching basket with id: "+basket_id),$http({url:API.basket.url+"/"+basket_id+"/",method:"GET"}).then(function(response){return 200!==response.status?$q.reject(response.data):("undefined"!=typeof skipSyncBasket&&skipSyncBasket||syncBasket(response.data),response.data)},function(error){var handleError={401:function(){return $log.error("Not authorised to access basket with id "+basket_id+", creating another one."),basketAPI.recreateBasket()},403:function(){return $log.error("Not authorised to access basket with id "+basket_id+", creating another one."),basketAPI.recreateBasket()},404:function(){return $log.error("No basket found with id "+basket_id+", creating new one."),basketAPI.createBasket()},422:function(){return $log.error("Can no longer access basket with id "+basket_id+", most likely due to a failed checkout."),basketAPI.recreateBasket()},unknown:function(){return messages.push({type:"alert",content:"Failed to retrieve basket from the server."}),defaultErrorResponse(error)}};return(handleError[error.status]||handleError.unknown)()})):basketAPI.createBasket()},basketAPI.addLineItem=function(line_item){return addLineItem(line_item).then(function(response){return-1===[200,201].indexOf(response.status)?$q.reject(response.data):(basketAPI.getBasket(),response.data)})},basketAPI.addLineItems=function(line_items){return addLineItems(line_items).then(function(response){return console.log(response),-1===[200,201].indexOf(response.status)?$q.reject(response.data):(basketAPI.getBasket(),response.data)})},basketAPI.updateLineItem=function(line_item){return updateLineItem(line_item).then(function(response){return 200!==response.status?$q.reject(response.data):(basketAPI.getBasket(),response.data)})},basketAPI.removeLineItem=function(line_item){var id=getIdForLineItem(line_item);return id?basket_id?$http({url:API.basket.url+"/"+basket_id+"/line_items/"+id+"/",method:"DELETE"}).then(function(response){return 204!==response.status?$q.reject(response.data):(basketAPI.getBasket(),tagManagerService.generateCheckoutEvent(universal_variable.basket),response.data)},function(error){return messages.push({type:"alert",content:"Failed to remove <strong>"+line_item.product.name+"</strong> from your basket."}),defaultErrorResponse(error)}):defaultErrorResponse({data:"no basket id"}):defaultErrorResponse({data:"cannot find product in basket"})},basketAPI.addPromoCode=function(sData){return $http({url:API.basket.url+"/"+basket_id+"/promo_codes",method:"POST",data:'["'+sData+'"]'}).then(function(response){return response},function(response){return response})},basketAPI.removePromoCode=function(sPromo){return $http({url:API.basket.url+"/"+basket_id+"/promo_codes/"+encodeURIComponent(sPromo),method:"DELETE"}).then(function(response){return response},function(error){return messages.push({type:"alert",content:"Failed to remove <strong>"+sPromo+"</strong> promo code from your basket."}),defaultErrorResponse(error)})},basketAPI.getBasket(),$rootScope.$on("user-status",function(event,action){"logout"===action&&basketAPI.createBasket()}),basketAPI}function BreadcrumbsService($q,categoriesService,productService,articles){function generateNameForUrl(url){var name=url.replace(/-/g," ");return name=name.replace(/E[0-9]+$/g,""),name=name.replace(/[0-9]+/g,""),name=name.charAt(0).toUpperCase()+name.slice(1)}function generateFallbackBreadcrumbs(url){var parts=url.replace(/^\/|\/$/g,"").split("/");return 1===parts.length&&""===parts[0]?[]:parts.reduce(function(crumbs,part,i){return crumbs.push({name:generateNameForUrl(part),link:"/"+parts.slice(0,i+1).join("/")+"/"}),crumbs},[])}var service=this;service.getCrumbsForPage=function(url,toState,toParams){var deferred=$q.defer();return"product"===toState.page_type||"ensemble"===toState.page_type?productService.getProduct(toParams.id).then(function(product){var crumbs=(product.categories||[]).map(categoriesService.createLink).map(function(category){return category.name||(category.name=category.display_name),category});crumbs.push({name:product.name,link:url}),deferred.resolve(crumbs)},function(){deferred.resolve(generateFallbackBreadcrumbs(url))}):"category"===toState.page_type?categoriesService.getBreadcrumbsFor(url).then(function(breadcrumbs){deferred.resolve(breadcrumbs)},function(){deferred.resolve(generateFallbackBreadcrumbs(url))}):"search"===toState.page_type?deferred.resolve(generateFallbackBreadcrumbs(url).concat([{name:toParams.query,link:toState.url}])):"content"===toState.page_type?articles.getMetaDataFor(url).then(function(meta){deferred.resolve(meta.breadcrumbs?meta.breadcrumbs:generateFallbackBreadcrumbs(url))},function(){deferred.resolve(generateFallbackBreadcrumbs(url))}):deferred.resolve("error"===toState.page_type?[]:generateFallbackBreadcrumbs(url)),deferred.promise}}function BrowserStorageService($timeout,$log,messages){function catchError(error){$log.error("Failed to access local storage",error),userHasBeenWarned||(messages.push({type:"alert",content:"This website requires localStorage to work properly, without it everything will be lost when you refresh the page."}),userHasBeenWarned=!0)}function StorageHandler(provider){this.storageProvider=provider,this.cache={},this.tempCache={}}var service,userHasBeenWarned=!1;return StorageHandler.prototype.getItem=function(key){var item,self=this;if("undefined"!=typeof self.tempCache[key])return self.tempCache[key];try{item=self.storageProvider.getItem(key),$log.debug("Reading `"+key+"`")}catch(error){catchError(error),item=self.cache[key]}if(item)try{item=JSON.parse(item)}catch(err){$log.warn("Failed to parse `"+key+"`, removing it from storage: ",err),self.removeItem(key),item=null}return self.tempCache[key]=item,$timeout(function(){delete self.tempCache[key]},50),item},StorageHandler.prototype.setItem=function(key,item){item=JSON.stringify(item);try{this.storageProvider.setItem(key,item)}catch(error){return catchError(error),this.cache[key]=item,!1}return!0},StorageHandler.prototype.removeItem=function(key){try{this.storageProvider.removeItem(key)}catch(error){return catchError(error),delete this.cache[key],!1}return!0},StorageHandler.prototype.clear=function(){this.tempCache={};try{this.storageProvider.clear()}catch(error){return catchError(error),this.cache={},!1}return!0},service=new StorageHandler(localStorage),service.temporary=new StorageHandler(sessionStorage),service}function CalendarService(){var CalandarAPI={};return CalandarAPI.newCal=function(params){for(var calPointer,calElm=!1,buttonElm=!1,bodyHideCal=!0,autoSelectDate=!1,animateId=!1,bAnimating=!1,$scope=params.$scope,calCallBack=params.addFunction,canDeliver=params.local.day_delivery_dates,ary=[],timeZoneHours=(new Date).getTimezoneOffset()/60,i=0;i<canDeliver.length;i++){var sd=canDeliver[i].split("T").shift().split("-");ary[i]=new Date(Date.UTC(parseInt(sd[0]),parseInt(sd[1]-1),parseInt(sd[2]),timeZoneHours,0,0)).getTime()}for(var out=[];ary.length;){for(i=0;i<ary.length-1;i++)if(ary[i+1]-ary[i]!=864e5){out.push([ary[0],ary[0]+864e5*(i+1)]),ary.splice(0,i+1);break}if(i==ary.length-1){out.push([ary[0],ary[0]+864e5*(i+1)]);break}}var calendar={monthsLUT:["Janurary","Feburary","March","April","May","June","July","August","September","October","November","December"],delivery:{year:0,month:0,date:0,pointer:!1,setDateParams:!1},local:params.local,cals:{},displayMonth:{},flipMonth:!1,className:"",lastMonth:{date:-1,displayMonth:!1,todayOffset:{sStr:"yesterday",iInt:-1},monthName:"&nbsp;",year:"&nbsp;"},nextMonth:{date:-1,displayMonth:!1,todayOffset:{sStr:"yesterday",iInt:-1},monthName:"&nbsp;",year:"&nbsp;"},animationWatch:{},animating:{},dateSet:!1,maxAnimation:4,deliveryDates:out,canGoLastMonth:!1,canGoNextMonth:!0},cssTransitions={transitionEnd:{transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"}};for(var e in cssTransitions)for(var t in cssTransitions[e])if(void 0!==document.body.style[t]){cssTransitions[e]={evt:cssTransitions[e][t],scripts:{},animating:{}};break}var rv,monthNameLUT=["Janurary","Feburary","March","April","May","June","July","August","September","October","November","December"],newCalendar=function(mm,yyyy){var d=new Date,todayLow=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0)).getTime(),dayOffLUT=(d.getMonth(),d.getFullYear(),d.getDate(),["yesterday","today","tomorrow"]);mm&&d.setMonth(mm),yyyy&&d.setYear(yyyy);var monthName=monthNameLUT[d.getMonth()],monthObj={month:d.getMonth(),year:d.getFullYear(),dates:[],monthName:monthName,flat:[],display:[[]],lastMonth:{date:-1,displayMonth:!1,todayOffset:{sStr:"yesterday",iInt:-1},monthName:!1},nextMonth:{date:-1,displayMonth:!1,todayOffset:{sStr:"tomorrow",iInt:1},monthName:!1},todaysDatePointer:-1},todayOffset=function(){var time=d.getTime();time=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0)).getTime();var timeOff=(time-todayLow)/864e5;return timeOff?{sStr:dayOffLUT[timeOff/Math.abs(timeOff)+1],iInt:timeOff}:(monthObj.todaysDate=monthObj.flat.length,{sStr:dayOffLUT[1],iInt:timeOff})},week=monthObj.display[0],push={};d.setDate(1);var dd=d.getDay();if(mm=d.getMonth(),d.setDate(0),0!==dd)for(dd=d.getDate(),week.splice(0,0,{date:dd,displayMonth:!1,todayOffset:todayOffset(),monthName:monthName,month:d.getMonth()}),monthObj.lastMonth=week[0],monthObj.flat.splice(0,0,week[0]);0!==d.getDay();)d.setDate(dd-1),dd=d.getDate(),week.splice(0,0,{date:dd,displayMonth:!1,todayOffset:todayOffset(),month:d.getMonth(),monthName:monthName}),monthObj.flat.splice(0,0,week[0]);else dd=d.getDate(),monthObj.lastMonth={date:dd,displayMonth:!1,todayOffset:todayOffset(),monthName:monthName};for(var i=0;i<monthObj.flat.length;i++)monthObj.flat[i].flatIndex=i,monthObj.flat[i].todayOffset.iInt||(monthObj.todaysDatePointer=i);d.setMonth(mm+1),d.setDate(0),d.setMonth(monthObj.month),d.setYear(monthObj.year);for(var endDate=d.getDate(),j=0;endDate>j;j++){d.setDate(j+1);var dTime=d.getTime(),unselectable="";if(calendar.deliveryDates)for(unselectable="unselectable",i=0;i<calendar.deliveryDates.length;i++)if(dTime>=calendar.deliveryDates[i][0]&&dTime<=calendar.deliveryDates[i][1]){unselectable="";break}push={date:j+1,unselectable:unselectable,displayMonth:!0,todayOffset:todayOffset(),month:d.getMonth(),monthName:monthName,flatIndex:monthObj.flat.length},push.todayOffset.iInt||(monthObj.todaysDatePointer=monthObj.flat.length),week.push(push),monthObj.dates.push(week[week.length-1]),monthObj.flat.push(week[week.length-1]),autoSelectDate===j+1&&(autoSelectDate=week[week.length-1]),7==week.length&&(monthObj.display.push([]),week=monthObj.display[monthObj.display.length-1])}var iInt=1;if(d.setDate(iInt),d.setMonth(monthObj.month+1),monthName=monthNameLUT[d.getMonth()],week.length)for(;week.length<7;)push={date:iInt,displayMonth:!1,todayOffset:todayOffset(),month:d.getMonth(),monthName:monthName,flatIndex:monthObj.flat.length},push.todayOffset.iInt||(monthObj.todaysDatePointer=monthObj.flat.length),week.push(push),monthObj.flat.push(week[week.length-1]),1==iInt&&(monthObj.nextMonth=week[week.length-1]),iInt++;else monthObj.nextMonth={date:iInt,displayMonth:!1,todayOffset:todayOffset(),monthName:monthName,flatIndex:monthObj.flat.length};return monthObj},hideCal=function(evt){return evt&&evt.currentTarget==calElm?void(bodyHideCal=!1):(bodyHideCal&&calElm&&(calElm.style.visibility="hidden",
calElm=!1,$("body").off("click",hideCal),$(calElm).off("click",hideCal)),void(bodyHideCal=!0))},showCal=function(params){var cal=calendar;if(cal.local.dateSet){var rv=drawCalendar(cal.local.deliver.mm-1,cal.local.deliver.yyyy),p={cal:params.calId,date:cal.local.deliver.dd,flatIndex:rv.dates[cal.local.deliver.dd-1].flatIndex};setDate(p)}if(!calElm){calElm=document.getElementById(params.calId),buttonElm=document.getElementById(params.buttonId),animateId=params.animateId,calPointer=params.calPointer,calElm.style.visibility="visible";var D=document,h=Math.min(Math.min(D.body.scrollHeight,D.documentElement.scrollHeight),Math.min(D.body.offsetHeight,D.documentElement.offsetHeight),Math.min(D.body.clientHeight,D.documentElement.clientHeight)),rect=calElm.getBoundingClientRect(),dif=rect.bottom-h;if(dif>0)var x=0,sb=10,scrollTO=setInterval(function(){x+=sb,x>dif&&clearTimeout(scrollTO),window.scrollBy(0,sb)});bodyHideCal=!1,$(calElm).on("click",hideCal),$("body").on("click",hideCal)}},getCal=function(mm,yyyy){var strYear=yyyy.toString(),cals=calendar.cals;cals[strYear]||(cals[strYear]=[]),cals[strYear][mm]||(cals[strYear][mm]=newCalendar(mm,yyyy));var lM=new Date;lM.setMonth(mm),lM.setYear(yyyy),lM.setDate(0);var nM=new Date;return nM.setMonth(mm+1),nM.setYear(yyyy),nM.setDate(1),calendar.canGoLastMonth=lM.getTime()>calendar.deliveryDates[0][0],calendar.canGoNextMonth=nM.getTime()<calendar.deliveryDates[calendar.deliveryDates.length-1][1],cals[strYear][mm]},setDate=function(params){if(!bAnimating){var cal=calendar,date=cal.displayMonth.flat[params.flatIndex];if(date.unselectable);else{if(date.displayMonth)return cal.delivery.pointer&&(cal.delivery.pointer.selectState=""),cal.delivery.year=cal.displayMonth.year,cal.delivery.month=cal.displayMonth.month,cal.delivery.day=date.date,cal.delivery.pointer=date,cal.delivery.setDateParams=params,cal.dateSet=!0,cal.curDate=params,cal.local.deliver.mm=cal.delivery.month+1,cal.local.deliver.dd=cal.delivery.day,cal.local.deliver.yyyy=cal.delivery.year,cal.local.deliver.monthName=monthNameLUT[cal.delivery.month],cal.local.dateSet=!0,cal.local.deliver.setDateParams=params,cal.local.deliver.pointer=date,date.selectState="selected",autoSelectDate===!1&&hideCal(),!0;if(date.todayOffset.iInt>0){var m=date.month-cal.displayMonth.month;m>1&&(m=-1),-1>m&&(m=1),autoSelectDate=date.date,advanceMonth({iInt:m,animate:!0,elmID:animateId})}}}},storeDate=function(){var cal=calendar,m="0"+(cal.delivery.month+1),d="0"+cal.delivery.day;calCallBack(cal.delivery.year+""+m.substr(m.length-2)+d.substr(d.length-2))},advanceMonth=function(params){if(!cssTransitions.transitionEnd.animating[params.elmID]){var cal=calendar,mm=cal.displayMonth.month+params.iInt,yyyy=cal.displayMonth.year;0>mm&&(yyyy--,mm=11),mm>11&&(yyyy++,mm=0);var rv=getCal(mm,yyyy);cal.flipMonth=rv;var maxAnim=5;if(params.animate&&params.elmID){if(!cssTransitions.transitionEnd.animating[params.elmID]){bAnimating=!0;var targ=document.getElementById(params.elmID);if(!targ)return;var className="advanceMonth ";cal.flipMonth=calendar.displayMonth.month>rv.month||calendar.displayMonth.year>rv.year?"lastMonth":"nextMonth",cal[cal.flipMonth]=rv,className+=cal.flipMonth,calendar.displayMonth.year<rv.year&&(className+=" lastYear"),calendar.displayMonth.year>rv.year&&(className+=" nextYear"),cal.className=className,cssTransitions.transitionEnd.scripts[params.elmID]||(cssTransitions.transitionEnd.scripts[params.elmID]=function(){cssTransitions.transitionEnd.animating[params.elmID]--,cssTransitions.transitionEnd.animating[params.elmID]||($(targ).removeClass(cal.className),cal.displayMonth=cal[cal.flipMonth],autoSelectDate=!1,bAnimating=!1,autoSelectDate=!1,bAnimating=!1,$scope.$apply()),cssTransitions.transitionEnd.animating[params.elmID]<0&&(maxAnim++,cssTransitions.transitionEnd.animating[params.elmID]=0)},targ.addEventListener(cssTransitions.transitionEnd.evt,cssTransitions.transitionEnd.scripts[params.elmID])),cssTransitions.transitionEnd.animating[params.elmID]=maxAnim,$(targ).addClass(className)}}else calendar.displayMonth=rv,autoSelectDate=!1}},drawCalendar=function(mm,yyyy){var rv=getCal(mm,yyyy);return calendar.displayMonth=rv,rv};if(params.local.dateSet)rv=drawCalendar(params.local.deliver.mm,params.local.deliver.yyyy),calendar.local.deliver.monthName=monthNameLUT[calendar.local.deliver.mm];else{var dd=new Date;rv=drawCalendar(dd.getMonth(),dd.getFullYear())}return{calendar:calendar,advanceMonth:function(params){advanceMonth(params)},setDate:function(params){var rv=setDate(params);rv&&storeDate()},showCal:function(params){console.log("EVT- show cal"),showCal(params)}}},CalandarAPI}function CategoriesService($http,$q,$log,API){var service={};return service.createLink=function(category){return category.link="/shop/"+category.id.replace(/_/g,"/")+"/",category},service.getCategory=function(category_url){var category_id=category_url.replace("/shop/","").replace(/\/$/g,"").replace(/\//g,"_");return $http({url:API.categories.url+"/"+category_id,method:"GET",cache:!0}).then(function(response){return 200!==response.status?$q.reject(response.data):(response.data.category=service.createLink(response.data.category),response.data._metadata.ancestors.map(service.createLink),response.data._metadata.descendents.map(service.createLink),response.data)},function(error){return $log.error("Categories API error:",JSON.stringify(error,null,4)),$q.reject(error.data)})},service.getNameFor=function(url){return service.getCategory(url).then(function(data){return data.category.name})},service.getDetailsFor=function(url){return service.getCategory(url).then(function(data){return data.category})},service.getSubcategoriesFor=function(url){return service.getCategory(url).then(function(data){return data._metadata.descendents})},service.getBreadcrumbsFor=function(url){return service.getCategory(url).then(function(data){return data._metadata.ancestors.push(data.category),data._metadata.ancestors})},service}function CheckoutService($rootScope,$http,$q,$interval,$log,browserStorage,API,universal_variable,basket){function clearPollTimeout(){$interval.cancel(poll),poll=null}function estimateLoyaltyPoints(transaction){return transaction.loyalty_points}var basket_id=universal_variable.basket.id||browserStorage.getItem("basket_id"),checkout_id=browserStorage.temporary.getItem("checkout_id"),defaultSuccessResonse=function(response){return 200!==response.status?$q.reject(response.data):response.data},defaultErrorResponse=function(error){return $log.error("Checkout API error:",JSON.stringify(error,null,4)),$q.reject(error.data)},formatAddressObject=function(address){return"undefined"==typeof address?console.log("No address"):(address.name="undefined"!=typeof address.name?address.title+" "+address.first_name+" "+address.last_name:"",address.address="undefined"!=typeof address.address?address.line_1+(address.line_2&&address.line_2.length?", "+address.line_2:""):"",address.email=address.email||universal_variable.user.email),address},completeCheckout=function(){browserStorage.removeItem("basket_id"),basket.createBasket()},poll=null,checkoutAPI={localData:{copy:{cal:["day_delivery_dates"]},out:{cal:{deliver:{mm:1,dd:1,yyyy:2016,pointer:!1,setDateParams:!1,monthName:!1},dateSet:!1}}}};return checkoutAPI.hasBegun=function(){return!!checkout_id},checkoutAPI.begin=function(){return basket_id=universal_variable.basket.id||browserStorage.getItem("basket_id"),basket_id?$http({url:API.checkout.url+"/"+basket_id,method:"POST",data:{basket:universal_variable.basket}}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):(response.data.estimated_points=estimateLoyaltyPoints(response.data),checkoutAPI.data=response.data,universal_variable.transaction=response.data,checkout_id=response.data.id,browserStorage.temporary.setItem("checkout_id",checkout_id),response.data)},defaultErrorResponse):$q.reject("No basket_id")},checkoutAPI.getOrder=function(){if(!checkout_id)return $q.reject({message:"No checkout session found"});var self=this;return $http({url:API.checkout.url+"/"+checkout_id,method:"GET",data:{}}).then(function(response){if("object"!=typeof response.data)return $q.reject(response.data);var c=self.localData.copy,t=self.localData.out;for(var e in c)for(t[e]||(t[e]={});c[e].length;){var p=c[e].pop();t[e][p]=response.data[p]}return response.data.localData=self.localData.out,response.data.estimated_points=estimateLoyaltyPoints(response.data),universal_variable.transaction=response.data,response.data},function(error){return 422===error.status?(checkout_id=null,basket.recreateBasket().then(function(newBasket){return basket_id=newBasket.id,checkoutAPI.getOrder()})):defaultErrorResponse(error)})},checkoutAPI.getPaymentMethods=function(){return $http({url:API.checkout.url+"/"+checkout_id+"/payment_methods",method:"GET",data:{}}).then(defaultSuccessResonse,defaultErrorResponse)},checkoutAPI.setPaymentMethod=function(method){return $http({url:API.checkout.url+"/"+checkout_id+"/payment_method",method:"POST",data:method}).then(defaultSuccessResonse,function(error){return 422===error.status,defaultErrorResponse(error)})},checkoutAPI.getDeliveryMethods=function(){return $http({url:API.checkout.url+"/"+checkout_id+"/delivery_methods",method:"GET",data:{}}).then(defaultSuccessResonse,defaultErrorResponse)},checkoutAPI.setDeliveryMethod=function(method){return $http({url:API.checkout.url+"/"+checkout_id+"/delivery_method",method:"POST",data:method}).then(defaultSuccessResonse,defaultErrorResponse)},checkoutAPI.getAddress=function(type,address){return type=type||"delivery","undefined"==typeof address?console.log("No address: getAddress"):formatAddressObject(address),$http({url:API.checkout.url+"/"+checkout_id+"/"+type+"_address",method:"GET",data:address}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},defaultErrorResponse)},checkoutAPI.updateAddress=function(type,address){return type=type||"delivery","undefined"==typeof address?console.log("No address: updateAddress"):formatAddressObject(address),$http({url:API.checkout.url+"/"+checkout_id+"/"+type+"_address",method:"PUT",data:address}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},defaultErrorResponse)},checkoutAPI.chooseCollection=function(store_id){return $http({url:API.checkout.url+"/"+checkout_id+"/collection_address",method:"POST",data:{store:{id:store_id}}}).then(function(response){return response.data},defaultErrorResponse)},checkoutAPI.chooseShippingDate=function(sDate){return $http({url:API.checkout.url+"/"+checkout_id+"/delivery_date/"+sDate,method:"PUT",data:{checkoutId:checkout_id,deliveryDate:sDate}}).then(function(response){return response.data},defaultErrorResponse)},checkoutAPI.awaitCompletion=function(){function checkStatus(){checkoutAPI.getOrder().then(function(order){(statusActions[order.status]||statusActions["default"])(order)},function(order){clearPollTimeout(),deferred.reject(order)})}var deferred=$q.defer(),statusActions={COMPLETED:function(order){clearPollTimeout(),completeCheckout(),deferred.resolve(order)},ERROR:function(order){clearPollTimeout(),deferred.reject(order)},"default":function(){}};return null===poll&&(poll=$interval(checkStatus,1e3)),deferred.promise},checkoutAPI.stopWaiting=function(){clearPollTimeout()},checkoutAPI.end=function(){checkoutAPI.localData.out.cal.dateSet=!1,basket_id=null,checkout_id=null,browserStorage.temporary.removeItem("checkout_id")},checkoutAPI}function CmsService($rootScope,$http,$q,$window,$log,API,$location){function getCmsContent(url,apiUrl){return-1!==$location.path().indexOf("/cms/")&&(url=url.replace(/\/+$/i,"")),$http({url:apiUrl,params:{url:url},method:"GET",cache:!0}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):($log.debug("CMS response: ",response.data),response.data)},function(error){return $log.error("CMS API error:",JSON.stringify(error,null,4)),$q.reject(error.data)})}var cms={};return cms.getContentForPage=function(url){return getCmsContent(url,API.cms.url)},cms.pageExists=function(url){return getCmsContent(url,API.cms.url+"/exists")},$rootScope.$on("$locationChangeStart",function(e,toUrl){toUrl=toUrl.replace($window.location.origin,""),cms.getContentForPage(toUrl),$log.info("Getting CMS content for "+toUrl+" at earliest possible moment")}),cms}function EnsembleService($http,$q,$log,API){var cache={},ensembleService={},getEnsemble=function(id){return $http({url:API.ensembles.url+"/"+id,method:"GET",dataType:"json",data:""}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},function(error){return $log.error("Ensemble API error:",JSON.stringify(error,null,4)),$q.reject(error.data)})};return ensembleService.getEnsemble=function(id){return cache[id]||(cache[id]=getEnsemble(id)),cache[id]},ensembleService}function GeocodeService($q,$log,uiGmapGoogleMapApi,messages){var service=this,googleGeocoder={init:function(){var self=this,deferred=$q.defer();return self.geocoder?deferred.resolve(self.geocoder):uiGmapGoogleMapApi.then(function(maps){self.maps=maps,self.geocoder=new maps.Geocoder,deferred.resolve(self.geocoder)}),deferred.promise},geocode:function(params){var self=this,deferred=$q.defer();return(self.goecoder||self.init()).then(function(geocoder){geocoder.geocode(params,function(results,status){status===self.maps.GeocoderStatus.OK?deferred.resolve(results):($log.error("Geocode was not successful for the following reason: "+status),messages.push({type:"alert",content:"Please enter a postcode or town or check your entry for errors.",autoclose:6e3}),deferred.reject(status))})}),deferred.promise}};service.lookUpAddress=function(address){return googleGeocoder.geocode({address:address,componentRestrictions:{country:"UK"}}).then(function(results){return results.length?($log.log(results[0].geometry.location),{latitude:results[0].geometry.location.lat(),longitude:results[0].geometry.location.lng()}):$q.reject(results)})}}function GeolocationService($q,$window,universal_variable){var service=this;service.isEnabled="geolocation"in $window.navigator,service.getLocation=function(){var deferred=$q.defer();return service.isEnabled?($window.navigator.geolocation.getCurrentPosition(function(position){deferred.resolve(position),universal_variable.user.location=position.coords},function(error){switch(error.code){case error.PERMISSION_DENIED:deferred.reject("error: permission denied");break;case error.POSITION_UNAVAILABLE:deferred.reject("error: position unavailable");break;case error.TIMEOUT:deferred.reject("error: timeout");break;default:deferred.reject("error: unknown")}},{enableHighAccuracy:!0}),deferred.promise):deferred.reject("errors.location.unsupportedBrowser")}}function JSONSelectService($window){return $window.JSONSelect}function KeyHandlerService(){var service=this,keyMapping={13:"ENTER",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"};service.handleEvent=function(e,keys,hitCallback,missCallback){var key=keyMapping[e.keyCode];-1!==keys.indexOf(key)?hitCallback(e,key):"function"==typeof missCallback&&missCallback(e,key)}}function LateralService($http,$q,$log,user){function defaultErrorResponse(error){return $log.error("Lateral API error: ",JSON.stringify(error.data,null,4)),$q.reject(error.data)}var service=this;service.getSale=function(id){return $http({url:user.getBaseUrl()+"/sales/"+id,method:"GET"}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data.transactions[0]},defaultErrorResponse)},service.getSalesHistory=function(){return $http({url:user.getBaseUrl()+"/sales",method:"GET"}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data.transactions},defaultErrorResponse)}}function lodash($window){return $window._}function LoyaltyService($http,$q,$log,user,API,universal_variable,messages){function defaultSuccessResponse(response){return"object"!=typeof response.data?$q.reject(response.data):response.data}function defaultErrorResponse(error){return $log.error("Membership API error:",JSON.stringify(error,null,4)),$q.reject(error.data)}var service=this;service.joinLoyaltyScheme=function(address){return $http({url:user.getBaseUrl()+"/loyalty_card",method:"POST",data:address}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):(universal_variable.user.card_number=response.data.card_number,response.data)},defaultErrorResponse)},service.linkCard=function(user,cardNumber){return $http({url:user.getBaseUrl()+"/link_card",method:"POST",data:$.param({cardNumber:cardNumber}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},defaultErrorResponse)},service.saveStoreAccount=function(address){return $http({url:user.getBaseUrl()+"/store_account_save",method:"POST",data:address}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},defaultErrorResponse)},service.orderReplacementCard=function(){return $http({url:user.getBaseUrl()+"/loyalty_card",method:"PUT"})["catch"](defaultErrorResponse)},service.getLoyaltyCardForMemmber=function(user){return $http({url:user.getBaseUrl()+"/loyalty_card",method:"GET"}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},defaultErrorResponse)},service.getCard=function(user,cardNumber){return $http({url:user.getBaseUrl()+"/loyalty_card_info",method:"POST",data:$.param({cardNumber:cardNumber}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},function(error){return messages.push({type:"alert",content:error.data.message}),error})},service.validateGCNumber=function(user,cardNumber){return $http({url:API.users.url+"//loyalty_card",method:"POST",data:$.param({cardNumber:cardNumber}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):($(".gcinputs i").addClass("fa"),response.data)},function(error){return $(".gcinputs i").removeClass("fa"),messages.push({type:"alert",content:error.data.message,autoclose:4e3}),error})},service.getStoreAccountInfo=function(user){return $http({url:user.getBaseUrl()+"/store_account",method:"GET"}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},defaultErrorResponse)},service.getRewards=function(user){return $http({url:user.getBaseUrl()+"/rewards",method:"GET"}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},defaultErrorResponse)},service.storeCardNumber=function(card_number){return $http({url:user.getBaseUrl(),method:"PATCH",data:{card_number:card_number}}).then(defaultSuccessResponse,defaultErrorResponse)}}function MenuService($http,$q,$log,API,universal_variable){function extractMenuItems(menuObject){return menuObject.menu.items}function defaultErrorResponse(error){return $log.error("Menus API error:",JSON.stringify(error,null,4)),$q.reject(error.data)}var service=this;service.getMenus=function(alias){var query=API.menus.url;return alias&&(query+="?alias="+alias.map(function(value){return"alias="+value}).join("&")),$http({url:query,method:"POST",data:universal_variable}).then(function(response){return"object"!=typeof response.data?$.reject(response.data):response.data.reduce(function(map,menu){return map[menu.alias]=extractMenuItems(menu),map},{})},defaultErrorResponse)},service.getMenuByAlias=function(alias){return $http({url:API.menus.url+"?alias="+alias,method:"POST",data:universal_variable}).then(function(response){return"object"!=typeof response.data?$.reject(response.data):response.data[0]&&response.data[0].alias===alias?extractMenuItems(response.data[0]):$.reject(response.data)},defaultErrorResponse)}}function MessagesService(){var messages=[];return messages}function MetaDataService($q,categoriesService,productService,ensembleService,articles,cms,siteName,_){function fallback(){return{}}function generateFallbackTitle(stateName){var name;return stateName.length?(name=stateName.replace(/[-\.]/g," "),name=name.charAt(0).toUpperCase()+name.slice(1),name+" | "+siteName):""}var service=this;service.getMetaData=function(url,toState,toParams){var promises={cms:cms.getContentForPage(url).then(function(response){return response.page},fallback)},deferred=$q.defer();return"product"===toState.page_type?promises.site_data=productService.getProduct(toParams.id).then(function(product){return{title:product.name+" | "+siteName,description:product.meta_description,keywords:product.meta_keywords}}):"ensemble"===toState.page_type?promises.site_data=ensembleService.getEnsemble(toParams.id).then(function(ensemble){return{title:ensemble.name+" | "+siteName,description:ensemble.meta_description,keywords:ensemble.meta_keywords}}):"category"===toState.page_type?promises.site_data=categoriesService.getNameFor(url).then(function(name){return{title:name+" | "+siteName}}):"search"===toState.page_type&&(promises.site_data=deferred.promise,deferred.resolve(toParams.query?{title:"Search results for '"+toParams.query+"' | "+siteName}:{title:"Search results | "+siteName})),promises.site_data&&promises.site_data["catch"](fallback),$q.all(promises).then(function(response){var metatags;return response.site_data=response.site_data||{},metatags=_.pick(response.site_data,function(value,key){return["description","keywords"].indexOf(key)>-1}),metatags=_(response.cms).pick(function(value,key){return key.match(/meta[_-]/)&&-1===value.indexOf("_NO_OVERRIDE")}).mapKeys(function(value,key){return key.replace(/meta[_-]/,"")}).defaults(metatags).value(),response.cms.title&&response.cms.title.indexOf("_NO_OVERRIDE")>-1&&(response.cms.title=response.site_data.title),{title:response.cms.title||response.site_data.title||generateFallbackTitle(toState.name),metatags:metatags}})}}function newsletterService($http,$q,$log,API,universal_variable,messages,tagManagerService){var service=this,baseUrl=API.users.url+(universal_variable.user.id?"/"+universal_variable.user.id:"")+"/newsletter";service.subscription=function(action,email){return action||(action="subscribe"),email||(email=universal_variable.user.email),$http({url:baseUrl+"/"+action,method:"subscribe"===action?"POST":"DELETE",data:{email:email}}).then(function(response){if("object"!=typeof response)return $q.reject(response);switch("string"==typeof response.data&&(response.data={}),"undefined"==typeof response.data.message&&(response.data.message=""),response.status){case 200:case 201:case 202:response.data.message="You have been "+action+"d successfully",tagManagerService.generateNewsLetterSubscription(action);break;case 304:response.data.message=email+" is"+("subscribe"===action?" already":"n't ")+" subscribed to the newsletter";break;default:return response.data.message="Unknown response status",$q.reject(response)}return $log.info(response.data.message),messages.push({type:"success",content:response.data.message}),response.data},function(error){messages.push({type:"alert",content:error.data.message}),$log.error("Newletter API Error:",JSON.stringify(error,null,4))})}}function OrderService($http,$q,$log,API){var service=this,defaultSuccessResponse=function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},defaultErrorResponse=function(error){return $log.error("Orders API error:",JSON.stringify(error,null,4)),$q.reject(error.data)};service.getOrder=function(id){return $http({url:API.orders.url+"/"+id,method:"GET"}).then(defaultSuccessResponse,defaultErrorResponse)},service.getOrderHistory=function(){return $http({url:API.orders.url,method:"GET"}).then(defaultSuccessResponse,defaultErrorResponse)}}function OverlayService(){var service={},scope={template:"",isHidden:!0,displayText:"",confirmWrapClass:"",callBack:!1},isIE11=parseInt(navigator.userAgent.toLowerCase().split("msie").pop())<12,monitorDimstTO=!1,monitorHeight=!1,winRect=!1,rootScope=!1;service.show=function(template,bMonitorHeight){rootScope||(rootScope=angular.element("body").scope()),scope.template="/assets/partials/"+template+".html",scope.isHidden=!1,monitorHeight=bMonitorHeight,(bMonitorHeight||isIE11)&&monitorDims(0,0)};var monitorDims=function(iHeight,iWidth){var box=$(".overlay__inner")[0],r=box.getBoundingClientRect(),h=parseInt(r.bottom-r.top),w=parseInt(r.right-r.left);if("tablet"==rootScope.screenSize){if(monitorHeight&&h!=iHeight&&$(window).height()<r.top+h){var stickyNav=document.getElementById("tabletNavWrap"),stickyRect=stickyNav.getBoundingClientRect();stickyNav&&(stickyNav.style.cssText="position:fixed;top:"+stickyRect.top+"px;left:0");var cWrap=$(".off-canvas-wrap")[0];winRect=cWrap.getBoundingClientRect(),cWrap.style.cssText="position:fixed;top:"+winRect.top+"px;width:100%;overflow:hidden";var bH=h,targ=document.getElementById("overlay");targ.style.position="absolute",targ.style.height=document.body.scrollHeight+"px";var t=Math.max(Math.max(document.documentElement.scrollTop),Math.max(document.body.scrollTop))+r.top,off=0;t+h>bH&&(off=bH-(t+h),t=bH-h),0>t&&(off=t,t=0),t+h>bH&&(targ.style.height=t+h),window.scrollBy(0,off),$(".overlay__inner")[0].style.top=t+"px"}if(isIE11&&w!=iWidth){var left=($(window).width()-w)/2;0>left&&(left=0),$(".overlay__inner")[0].style.left=parseInt(left)+"px"}}monitorDimstTO=setTimeout(function(){monitorDims(h,w)},500)};return service.confirm=function(displayText,callBack,confirmWrapClass,template){scope.displayText=displayText,confirmWrapClass||(confirmWrapClass="confirmWrap"),scope.confirmWrapClass=confirmWrapClass,template||(template="confirm"),scope.callBack=callBack,service.show(template)},service.hide=function(){clearTimeout(monitorDimstTO),scope.isHidden=!0,scope.displayText=scope.template="",scope.callBack=!1;for(var ary=["#tabletNavWrap",".off-canvas-wrap",".overlay__inner","#overlay"],i=0;i<ary.length;i++){var targ=$(ary[i]);targ.length&&(targ[0].style.cssText="")}winRect&&window.scrollTo(0,-winRect.top),winRect=!1},service.getScope=function(){return scope},service}function PageVisitTracker($rootScope,browserStorage,universal_variable){universal_variable.session.page_visits=browserStorage.temporary.getItem("page_visits")||[],$rootScope.$on("$locationChangeStart",function(event,url){universal_variable.session.page_visits.push(url),browserStorage.temporary.setItem("page_visits",universal_variable.session.page_visits)}),$rootScope.$on("$locationChangeError",function(){universal_variable.session.page_visits.pop(),browserStorage.temporary.setItem("page_visits",universal_variable.session.page_visits)})}function PasswordService($http,$q,$log,API){var service=this;service.requestResetFor=function(email){return $http({url:API.base.url+"/forgot_password",method:"POST",dataType:"json",data:{email:email}})["catch"](function(error){return $log.error("Password Reset error:",JSON.stringify(error,null,4)),$q.reject(error.data)})},service.setNewPassword=function(email,password,token){return $http({url:API.base.url+"/reset_password",method:"POST",dataType:"json",data:{email:email,password:password,token:token}})["catch"](function(error){return $log.error("Password Reset error:",JSON.stringify(error,null,4)),$q.reject(error.data)})}}function PersonalisedContentService($rootScope,$http,$q,$log,API,universal_variable){function handleRedirects(redirects){return redirects}var cache,service={};return service.getContentForPage=function(){return cache||(cache=$http({url:API.personalised_content.url,method:"POST",data:universal_variable,cache:!0}).then(function(response){return"object"!=typeof response.data?$q.reject(response):(handleRedirects(response.data.redirects),response.data.content.reduce(function(output,content){return output[content.zone]=content.snippets.join(""),output},{}))})["catch"](function(error){return $log.error("Personalised Content API Error:",JSON.stringify(error,null,4)),$q.reject(error.data)})),cache},$rootScope.$on("$stateChangeStart",function(){cache=null}),service}function PlantFinderService($http,$q,$log,API,universal_variable){var service=this;service.getQuestions=function(){return $http({url:API.plant_finder.url,method:"POST",data:universal_variable}).then(function(response){return"object"==typeof response.data&&response.data.length?response.data[0].form:$q.reject(response.data)},function(error){return $log.error("Plant Finder API error: ",JSON.stringify(error.data,null,4)),$q.reject(error.data)})}}function PreorderDatesService($rootScope,$log,basket,ajaxStatus){function pad(num){var norm=Math.abs(Math.floor(num));return(10>norm?"0":"")+norm}function formatDate(timestamp){var dateObj=new Date(timestamp);return dateObj.getUTCFullYear()+"/"+pad(dateObj.getUTCMonth()+1,2)+"/"+pad(dateObj.getUTCDate(),2)}function getDateFromDateObj(dateObj){return getUTCDateFromStr(dateObj.getFullYear()+"-"+pad(dateObj.getMonth()+1,2)+"-"+pad(dateObj.getDate(),2))}function getUTCDateFromDateObj(dateObj){return getUTCDateFromStr(dateObj.getUTCFullYear()+"-"+pad(dateObj.getUTCMonth()+1,2)+"-"+pad(dateObj.getUTCDate(),2))}function getUTCDateFromStr(strDate){return Date.parse(strDate+"T00:00:00Z")}var preorderDatesAPI={},PREORDER_START_DATE=0,PREORDER_END_DATE=1,currentLineItem=null,selectedPreoderDate=null;return preorderDatesAPI.reset=function(){currentLineItem=null,selectedPreoderDate=null},preorderDatesAPI.changePreorderBucketDate=function(line_item,monthsToShow){var today,currentPreoderDate,preOrderDateSetOnCurrentLineItem,beforeShowDaySelectedDate,jqDPickerSelectedDate,jqDPicker,i,x,minMaxDateRange=[],dateIntervals=[],dateRanges=line_item.product.preorder_bucket_inventories;for(currentLineItem=line_item,today=getUTCDateFromDateObj(new Date),preOrderDateSetOnCurrentLineItem="undefined"!=typeof currentLineItem.preorder_date,currentPreoderDate=preOrderDateSetOnCurrentLineItem?currentLineItem.preorder_date instanceof Date?currentLineItem.preorder_date:getUTCDateFromStr(currentLineItem.preorder_date):null,i=0;i<dateRanges.length;i++)minMaxDateRange.push(dateRanges[i].start_date),minMaxDateRange.push(dateRanges[i].end_date),dateIntervals[i]=[],dateIntervals[i][PREORDER_START_DATE]=getUTCDateFromStr(dateRanges[i].start_date),dateIntervals[i][PREORDER_END_DATE]=getUTCDateFromStr(dateRanges[i].end_date);minMaxDateRange.sort(),jqDPicker=$("#preorderDateDpicker").datepicker("destroy").datepicker({inline:!0,defaultDate:currentPreoderDate,numberOfMonths:monthsToShow,minDate:getUTCDateFromStr(minMaxDateRange[PREORDER_START_DATE]),maxDate:getUTCDateFromStr(minMaxDateRange[minMaxDateRange.length-1]),beforeShowDay:function(date){if(beforeShowDaySelectedDate=null===selectedPreoderDate?currentPreoderDate:selectedPreoderDate,date=getDateFromDateObj(date),today>date)return[!1,""];if(null!==beforeShowDaySelectedDate)for(x=0;x<dateIntervals.length;x++)if(date>=dateIntervals[x][PREORDER_START_DATE]&&date<=dateIntervals[x][PREORDER_END_DATE]&&beforeShowDaySelectedDate===dateIntervals[x][PREORDER_START_DATE])return[!0,"ui-state-in-range"];for(x=0;x<dateIntervals.length;x++)if(date>=dateIntervals[x][PREORDER_START_DATE]&&date<=dateIntervals[x][PREORDER_END_DATE])return[!0,""];return[!1,""]},onSelect:function(dateText,dateValue){for(jqDPickerSelectedDate=getUTCDateFromStr(dateValue.selectedYear+"-"+pad(dateValue.selectedMonth+1,2)+"-"+pad(dateValue.selectedDay,2)),x=0;x<dateIntervals.length;x++)if(jqDPickerSelectedDate>=dateIntervals[x][PREORDER_START_DATE]&&jqDPickerSelectedDate<=dateIntervals[x][PREORDER_END_DATE]){selectedPreoderDate=dateIntervals[x][PREORDER_START_DATE];break}$rootScope.$emit("preorderDateChanged",formatDate(selectedPreoderDate))}}),jqDPicker.find(".ui-state-active").removeClass("ui-state-active"),document.getElementById("preoder-dates-box-overlay").classList.remove("is-hidden"),preOrderDateSetOnCurrentLineItem?$rootScope.$emit("openPreorderDatesBox",formatDate(currentPreoderDate)):$rootScope.$emit("openPreorderDatesBox");

},preorderDatesAPI.isInventoryQuantityAvailable=function(){var rangeStartDate,rangeEndDate,i,dateRanges=currentLineItem.product.preorder_bucket_inventories,rowQuantity=currentLineItem.quantity,validationObject={isValid:!1,dateRange:"",stockQuantity:0,rowQuantity:0};for(i=0;i<dateRanges.length;i++)if(rangeStartDate=getUTCDateFromStr(dateRanges[i].start_date),rangeEndDate=getUTCDateFromStr(dateRanges[i].end_date),rangeStartDate===selectedPreoderDate){validationObject.dateRange=formatDate(rangeStartDate)+" - "+formatDate(rangeEndDate),validationObject.stockQuantity=dateRanges[i].stock;break}return validationObject.rowQuantity=rowQuantity,validationObject.isValid=rowQuantity<=validationObject.stockQuantity,validationObject},preorderDatesAPI.updatePreoderDateValue=function(){var gmtDate=getUTCDateFromDateObj(new Date(selectedPreoderDate));currentLineItem.preorder_date=gmtDate,$rootScope.$emit("preorderDateStatusChanged",ajaxStatus.pending),basket.updateLineItem(currentLineItem).then(function(){$rootScope.$emit("preorderDateStatusChanged",ajaxStatus.success),$rootScope.$emit("closePreorderDatesBox")},function(){$rootScope.$emit("preorderDateStatusChanged",ajaxStatus.error)})},preorderDatesAPI}function ProductDetailService($state,$log,basket,wishlistService,overlay,ajaxStatus,tagManagerService){var service=this;service.setupController=function(vm){vm.product||$log.error("productDetailService.setupController expects vm.product to already be defined",vm),vm.quantity=1,"undefined"!=typeof vm.product.variants&&1===vm.product.variants.length&&(vm.selectedVariant=vm.product.variants[0]),vm.determinBasketButtonState=function(){if("undefined"==typeof vm.frontEndInfo&&(vm.frontEndInfo={}),vm.frontEndInfo.buyButtonType=0,"undefined"==typeof vm.product.variants)return void(vm.frontEndInfo.buyButtonType=1);if(!vm.selectedVariant&&vm.product.variants.length)return void(vm.frontEndInfo.buyButtonType=1);if(vm.submittedWithoutVariant=!1,vm.selectedVariant&&vm.selectedVariant.stock>0)return void(vm.frontEndInfo.buyButtonType=1);vm.currentDate=Date.parse(new Date);for(var months={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11},seasons=[],availSeasons=["one","two"],startDate=new Date,endDate=new Date,i=0;i<availSeasons.length;i++){var start="pf_availabilityseason"+availSeasons[i]+"_fromdate",stop="pf_availabilityseason"+availSeasons[i]+"_todate";if("undefined"!=typeof vm.product[start]&&"undefined"!=typeof vm.product[stop]){var s=vm.product[start].split("-");if(3==s.length)startDate.setFullYear(parseInt(s[2]),months[s[1].toLowerCase()],parseInt(s[0]));else{if(s=vm.product[start].split("/"),3!=s.length)return void(vm.frontEndInfo.buyButtonType=0);startDate.setFullYear(parseInt(s[2]),parseInt(s[1]),parseInt(s[0]))}if(s=vm.product[stop].split("-"),3==s.length)endDate.setFullYear(parseInt(s[2]),months[s[1].toLowerCase()],parseInt(s[0]));else{if(s=vm.product[stop].split("/"),3!=s.length)return void(vm.frontEndInfo.buyButtonType=0);endDate.setFullYear(parseInt(s[2]),parseInt(s[1]),parseInt(s[0]))}seasons.push({start:startDate.getTime(),end:endDate.getTime()})}}seasons.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(var k=0;k<seasons.length;k++){if(vm.currentDate>seasons[k].start&&vm.currentDate<seasons[k].end){vm.frontEndInfo.buyButtonType=0;break}vm.frontEndInfo.buyButtonType=2}},vm.addToBasket=function(){return vm.status=ajaxStatus.pending,vm.selectedVariant?(vm.submittedWithoutVariant=!1,void basket.addLineItem({product:vm.selectedVariant,quantity:vm.quantity}).then(function(){vm.status=ajaxStatus.success,tagManagerService.generateCartEvent(vm,"addToCart"),overlay.hide()},function(){vm.status=ajaxStatus.error})):(vm.status=ajaxStatus.error,vm.submittedWithoutVariant=!0,void $log.error("Adding to basket failed, no variant selected. Variants availabale: ",vm.product.variants))},vm.addToWishlist=function(event){event&&event.preventDefault(),wishlistService.addToWishlist(vm.product.id,(vm.selectedVariant||{}).id).then(function(){$state.go("clippings"),overlay.hide()})},vm.determinBasketButtonState()}}function ProductService($http,$q,$log,API,universal_variable){function defaultSuccessResponse(response){return"object"!=typeof response.data?$q.reject(response.data):response.data}function defaultErrorResponse(error){return $log.error("Product API error:",JSON.stringify(error,null,4)),$q.reject(error.data)}function getProduct(id){return $http({url:API.products.url+"/"+id,method:"GET",dataType:"json",data:""}).then(defaultSuccessResponse,defaultErrorResponse)}var cache={},service={};return service.urlPartFor=function(name,id){var formattedName="";return name&&(name=name.toLowerCase(),name=name.replace(/&.{0,}?;/g,""),name=name.replace(/\W+/g,"-"),name=name.replace(/\-$/g,""),name=name+"-"+id,formattedName=name),formattedName},service.imagePathFor=function(id){return API.amplience.url+"/i/"+API.amplience.client_id+"/01_"+id+".jpg?$product_list$"},service.getProduct=function(id){return cache[id]||(cache[id]=getProduct(id)),cache[id]},service.getProductArray=function(ids){return $http({url:API.products.url,params:{ids:ids.join(",")},method:"GET"}).then(defaultSuccessResponse,function(error){return $log.error("Product API error:",JSON.stringify(error,null,4)),[]})},service.getRelatedProducts=function(id,limit,type,useService,basket_id){var params={related_to:id,relationship_type:type||"also_bought",useService:useService&&useService===!0};return limit&&(params.limit=limit),basket_id&&(params.basket_id=basket_id),$http({url:API.related_products.url,params:params,method:"POST",dataType:"json",data:universal_variable}).then(defaultSuccessResponse,defaultErrorResponse)},service}function QuickLookService(overlay){var service={},product={};return service.show=function(event,newProduct){return event&&event.preventDefault(),product=newProduct,"ensemble"===product.type?void overlay.show("quick-look--ensemble",!0):void overlay.show("quick-look",!0)},service.hide=function(){overlay.hide()},service.getProduct=function(){return product},service}function RecentlyViewedService(browserStorage,productService){var service={},products=browserStorage.getItem("recentlyViewed")||[],sliderTO=!1;return products.remove=function(productToRemove){var self=this;return self.some(function(product,i){return product.id!==productToRemove.id?!1:(self.splice(i,1),!0)}),clearTimeout(sliderTO),sliderTO=setTimeout(function(){var slider=angular.element("#rv-products");slider.length&&(slider=slider.scope(),slider.destroySlider(),slider.applySlider())},100),self},service.getItems=function(){return products},service.addItem=function(product){clearTimeout(sliderTO),product.url="/shop/"+productService.urlPartFor(product.name,product.id)+"/",products.remove(product).unshift(product),sliderTO=setTimeout(function(){var slider=angular.element("#rv-products");slider.length&&(slider=slider.scope(),slider.destroySlider(),slider.applySlider())},100),browserStorage.setItem("recentlyViewed",products)},service}function ScrollToAnchorService($location,$anchorScroll){function scrollToHash(hash){hash=hash.substring(hash.indexOf("#")+1),$location.hash(hash),$anchorScroll()}var service=this;service.scrollTo=function(hash){var oldHash=$location.hash();scrollToHash(hash),$location.hash(oldHash)},service.updateAnchorAndScrollTo=scrollToHash}function SearchService($http,$q,$log,API,universal_variable,_){function defaultSuccessResponse(response){return"object"!=typeof response.data?($log.error("Search API type mismatch:",JSON.stringify(response,null,4)),{results:[]}):response.data}function defaultErrorResponse(error){return $log.error("Search API error:",JSON.stringify(error,null,4)),{results:[]}}var searchService=this;searchService.prepareRefinements=function(searchParams){return _(searchParams).pick(function(values,key){return-1===["page","query"].indexOf(key)}).map(function(values,key){return{key:key,values:values.split("|")}}).value()},searchService.defaultSort=function(filters){if(!filters)return[];var categoryId="";for(i=0;i<filters.length;i++){var filter=filters[i];if("categories.id"===filter.key){categoryId=filter.values[0];break}}var optionSort={};optionSort["sort_"+categoryId]="asc";var optionName={name:"asc"};return[optionSort,optionName]},searchService.getResults=function(local_universal_variable){return $log.info("getting search results...",local_universal_variable.search),local_universal_variable.listing={},universal_variable.listing={},$http({url:API.search.url+"?type=product&type=ensemble",method:"POST",data:local_universal_variable}).then(function(response){return"object"!=typeof response.data?defaultErrorResponse(response):(universal_variable.listing.items=response.data.results,response.data)},defaultErrorResponse)},searchService.getArticles=function(local_universal_variable){return $log.info("getting article results...",local_universal_variable.search),$http({url:API.search.url+"?type=article",method:"POST",data:local_universal_variable}).then(defaultSuccessResponse,defaultErrorResponse)},searchService.getTopSellers=function(category,count){var uv=angular.copy(universal_variable);return uv.search={offset:0,limit:count||4,query:{keywords:"",onlyActive:!0,filters:[{key:"categories.id",values:[category]}]},sort:[{popularity_3_m:"desc"}]},$http({url:API.search.url+"?type=product&type=ensemble",method:"POST",data:uv}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data.results},defaultErrorResponse)}}function SessionService($rootScope,browserStorage,universal_variable){var session_token,user_id,session={};return session.getInfo=function(){return{token:session_token||(session_token=browserStorage.getItem("session_token")),id:user_id||(user_id=browserStorage.getItem("user_id"))}},session.storeInfo=function(sessionInfo){session_token=sessionInfo.token,user_id=sessionInfo.user.id,sessionInfo.user&&(universal_variable.user=sessionInfo.user),browserStorage.setItem("session_token",session_token),browserStorage.setItem("user_id",user_id)},session.destroy=function(){session_token=user_id=null,browserStorage.clear(),browserStorage.temporary.clear(),universal_variable.user={},$rootScope.$broadcast("user-status","logout")},session.exists=function(){var info=session.getInfo();return!!info.token&&!!info.id},session}function SocialLoginService($window,$http,$q,$log,API,authentication,universal_variable){function syncUserData(user){universal_variable.user.id=user.UID,universal_variable.user.name=user.firstName+" "+user.lastName,universal_variable.user.first_name=user.firstName,universal_variable.user.last_name=user.lastName,universal_variable.user.email=user.email,universal_variable.user.photo=user.thumbnailURL,Object.keys(user.identities).forEach(function(key){universal_variable.user[key+"_id"]=user.identities[key].nickname})}var providers,socialLogin={};return socialLogin.getProviders=function(){var deferred=$q.defer();return providers&&providers.length?deferred.resolve(providers):$http({url:API.social_providers.url,method:"GET",dataType:"json"}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):void deferred.resolve(response.data)},function(error){$log.error("Social Login API error:",JSON.stringify(error,null,4)),deferred.reject(error.data)}),deferred.promise},socialLogin.setup=function(callback,enabledProviders){var deferred=$q.defer();return"gigya"in $window?gigya.socialize.showLoginUI({containerID:"social-login",cid:"",width:150,height:40,buttonSize:35,showTermsLink:!1,hideGigyaLink:!0,enabledProviders:enabledProviders,onLogin:function(data){$log.log(data),syncUserData(data.user),authentication.signIn({UID:data.UID,UIDSignature:data.UIDSignature,signatureTimestamp:data.signatureTimestamp,isSiteUID:data.isSiteUID||!1}).then(function(responseData){deferred.resolve(responseData)},function(errorData){deferred.reject(errorData)})}}):deferred.reject({message:"Gigya service at not available at the moment",description:"gigya object was not found in the global namespace"}),deferred.promise},socialLogin}function StoreLocatorService($log,$http,$q,API,geolocation,geocodeService){function defaultErrorResponse(error){return $log.error("Store Locator API error:",JSON.stringify(error,null,4)),$q.reject(error.data)}function formatStore(store){var formatted={id:store.id,store_details:"/center/"+store.store_name.toLowerCase().replace(/\W/g,"-")+"/",name:store.store_name,address:{name:store.store_name,line_1:store.line_1,line_2:store.line_2,city:store.city,county:store.state,postcode:store.zip_code,phone:store.phone},phone:store.phone,location:{latitude:parseFloat(store.location.lat),longitude:parseFloat(store.location.lon)},url:"/stores/"+store.store_name.toLowerCase().replace(/\W/g,"-")+"-"+store.id+"/",collect_in_store:store.collect_in_store};return store._metadata&&(formatted.distance=parseFloat(store._metadata.distance.value).toFixed(1)),formatted}var service=this;service.getStores=function(location,pickupInStoreAvailable){$log.info("Getting stores for "+location.latitude+", "+location.longitude+"...");var reqObj={url:API.store_locator.url,params:{lat:location.latitude,lon:location.longitude},method:"GET"};return"undefined"!=typeof pickupInStoreAvailable&&(reqObj.params.pickupInStoreAvailable=pickupInStoreAvailable),$http(reqObj).then(function(response){var stores;return"object"!=typeof response.data?$q.reject(response.data):(stores=response.data.map(formatStore),{stores:stores,location:location})},defaultErrorResponse)},service.getStore=function(id){return $http({url:API.store_locator.url+"/"+id,method:"GET"}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):formatStore(response.data)},defaultErrorResponse)},service.getStoreEvents=function(id){return $http({url:API.store_events.url+"/"+id+"/store_events",method:"GET"}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},defaultErrorResponse)},service.getStoreDetails=function(id){return $http({url:API.store_events.url+"/"+id+"/store_details",method:"GET"}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},defaultErrorResponse)},service.getStoresNearby=function(pickupInStoreAvailable){return geolocation.getLocation().then(function(position){return service.getStores(position.coords,pickupInStoreAvailable)})},service.getStoresNear=function(address,pickupInStoreAvailable){return geocodeService.lookUpAddress(address).then(function(positionData){return service.getStores(positionData,pickupInStoreAvailable)})}}function TagManagerService($window,_,user,$log,browserStorage){var service=this;service.generatePageView=function(path){var gtmUser=null;user.isSignedIn()?user.getUserDetails().then(function(details){gtmUser={loggedin:!0,email:details.email,userid:details.id,userclubid:details.loyalty_card_number,userexistingcustomer:browserStorage.getItem("user_recognition")},$window.dataLayer.push({event:"virtualPageView",virtualUrl:path,user:gtmUser})},function(reason){$log.info(reason),$window.dataLayer.push({event:"virtualPageView",virtualUrl:path})}):$window.dataLayer.push({event:"virtualPageView",virtualUrl:path})},service.generateNewsLetterSubscription=function(action){"subscribe"===action&&$window.dataLayer.push({event:"newsLetter"})},service.generateImpressionEvent=function(vm){var gtmProducts=[];_.each(vm.productResults.results,function(result,index){gtmProducts.push({name:result.name,id:result.id,price:"product"===result.type?result.variants.length>0?result.variants[0].price:0:result.min_price,brand:result.brand,category:result.subcategory,variant:result.product_colour,position:index+1,list:"Search Results"})}),$window.dataLayer.push({event:"productImpression",ecommerce:{impressions:gtmProducts}})},service.generateProductClick=function(product){var productBrand="";product.brand&&(productBrand=product.brand),$window.dataLayer.push({event:"productClick",ecommerce:{click:{actionField:{list:"Search Results"},products:[{name:product.name,id:product.id,brand:productBrand,price:product.variants.length>0?product.variants[0].price:0,variant:product.product_colour,category:product.subcategory}]}}})},service.generateProductDetail=function(product){var productBrand="";product.brand&&(productBrand=product.brand);var productVariant="";product.product_colour&&(productVariant=product.product_colour),$window.dataLayer.push({event:"productDetail",ecommerce:{detail:{actionField:{list:"Search Results"},products:[{name:product.name,id:product.id,price:product.variants.length>0?product.variants[0].price:0,brand:productBrand,category:product.subcategory,variant:productVariant}]}}})},service.generateRegistrationEvent=function(){$log.info("generating Registration Event:"),user.getUserDetails().then(function(details){gtmUser={loggedin:!0,email:details.email,userid:details.id,userclubid:details.loyalty_card_number,userexistingcustomer:browserStorage.getItem("user_recognition")},$window.dataLayer.push({event:"newRegistration",user:{userLoggedIn:!1}})},function(reason){$log.info(reason),$window.dataLayer.push({event:"newRegistration",user:path})})},service.generateCartEvent=function(vm,gtmEventType){var productBrand="";vm.product.brand&&(productBrand=vm.product.brand),"addToCart"===gtmEventType?$window.dataLayer.push({event:gtmEventType,ecommerce:{add:{products:[{name:vm.product.name,id:vm.product.id,price:vm.selectedVariant.price,brand:productBrand,category:vm.product.subcategory,variant:vm.product.product_colour,quantity:vm.quantity}]}}}):"removeFromCart"===gtmEventType&&$window.dataLayer.push({event:gtmEventType,ecommerce:{remove:{products:[{name:vm.product.name,id:vm.product.id,price:vm.selectedVariant.price,brand:productBrand,category:vm.product.subcategory,variant:vm.selectedVariant.sku_code,quantity:vm.quantity}]}}})},service.generateCheckoutEvent=function(gtmBasket,step){var gtmLineItems=[];_.each(gtmBasket.line_items,function(lineItem){var productBrand="";lineItem.product.brand&&(productBrand=lineItem.product.brand),gtmLineItems.push({name:lineItem.product.name,id:lineItem.product.code,price:lineItem.product.unit_price,brand:productBrand,category:lineItem.product.category,variant:lineItem.product.sku_code,quantity:lineItem.quantity})}),$window.dataLayer.push("billing"===step?{event:"checkout",ecommerce:{checkout:{actionField:{step:1,option:"Billing Address"},products:gtmLineItems}}}:"delivery"===step?{event:"checkout",ecommerce:{checkout:{actionField:{step:2,option:"Delivery Details"},products:gtmLineItems}}}:"payment"===step?{event:"checkout",ecommerce:{checkout:{actionField:{step:3,option:"Payment Details"},products:gtmLineItems}}}:{event:"checkout",ecommerce:{checkout:{actionField:{},products:gtmLineItems}}})}}function UniversalVariableService(browserStorage){var universal_variable={version:"1.2.0",page:{},user:{language:"en-gb",id:browserStorage.getItem("user_id")},basket:{currency:"GBP",subtotal:0,tax:0,total:0,line_items:[],total_product_count:0},events:[],session:{}};return universal_variable}function UniversalVariableRunner($rootScope,$location,universal_variable){$rootScope.$on("$stateChangeSuccess",function(event,toState){universal_variable.page.type=toState.page_type,universal_variable.page.url=$location.path(),-1===["category","search"].indexOf(toState.page_type)&&delete universal_variable.listing})}function UserRecognitionService($rootScope,browserStorage,universal_variable){function firstTime(){browserStorage.setItem("user_recognition",!0),browserStorage.temporary.setItem("first_session",!0),universal_variable.user.is_recognised=!1}var user_is_recognised=!!browserStorage.getItem("user_recognition"),first_session=!!browserStorage.temporary.getItem("first_session");user_is_recognised&&!first_session?universal_variable.user.is_recognised=!0:firstTime(),$rootScope.$on("user-status",function(event,action){"logout"===action?firstTime():"login"===action&&(universal_variable.user.is_recognised=!0)})}function UserService($rootScope,$http,$q,$log,API,messages,session,universal_variable){function defaultSuccessResponse(response){return"object"!=typeof response.data?$q.reject(response.data):response.data}function defaultErrorResponse(error){return $log.error("Users API error:",JSON.stringify(error,null,4)),$q.reject(error.data)}function getUserDetails(){return userCache?userCache:userCache=$http({url:service.getBaseUrl(),method:"GET",dataType:"json",data:{}}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):(angular.extend(universal_variable.user,response.data),response.data)},defaultErrorResponse)}var userCache,service=this;service.getBaseUrl=function(){return API.users.url+"/"+session.getInfo().id},service.isSignedIn=session.exists,service.checkIfLoyaltyMember=function(){var deferred=$q.defer();return service.isSignedIn()?getUserDetails().then(function(details){(details.loyalty_card_number||"").length?deferred.resolve():deferred.reject()}):deferred.reject(),deferred.promise},service.requireEmail=function(){var deferred=$q.defer();return service.isSignedIn()?getUserDetails().then(function(details){return details.email?deferred.resolve(details.email):deferred.reject()}):deferred.reject(),deferred.promise},service.getUserDetails=function(){var deferred=$q.defer();return service.isSignedIn()?getUserDetails().then(function(data){deferred.resolve(data)},function(error){deferred.reject(error)}):deferred.reject({}),deferred.promise},service.register=function(details){return $http({url:API.users.url,method:"POST",data:details}).then(defaultSuccessResponse,function(error){switch(error.status){case 401:messages.push({type:"alert",content:"Incorrect password"});break;case 409:messages.push({content:"The email address <strong>"+details.email+"</strong> is already registered to an account. <a href='/sign-in/forgotten-password/'>Forgot your password?</a>"});break;default:$log.error("Users API error:",JSON.stringify(error,null,4))}return $q.reject(error.data)})},service.validateUser=function(details){return $http({url:API.users.url+"/email",method:"POST",data:details}).then(defaultSuccessResponse,function(error){switch(error.status){case 409:messages.push({content:"The email address <strong>"+details.email+"</strong> is already registered to an account. <a href='/sign-in/forgotten-password/'>Forgot your password?</a>"});break;default:$log.error("Users API error:",JSON.stringify(error,null,4))}return $q.reject(error.data)})},service.getPreferredStore=function(){return getUserDetails().then(function(data){return data.store_id},function(error){return $q.reject(error)})},service.setPreferredStore=function(store_id){return $http({url:service.getBaseUrl(),method:"PATCH",data:{store_id:store_id}}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):(universal_variable.user.store_id=store_id,userCache=null,response.data)},defaultErrorResponse)},service.updateEmail=function(from,to){return $http({url:service.getBaseUrl(),method:"PATCH",data:{old_email:from,email:to}}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):(universal_variable.user.email=to,userCache=null,response.data)},defaultErrorResponse)},service.updatePassword=function(from,to){return $http({url:service.getBaseUrl(),method:"PATCH",data:{old_password:from,password:to}}).then(defaultSuccessResponse,defaultErrorResponse)},$rootScope.$on("user-status",function(){userCache=null})}function WishlistService($rootScope,$state,$location,$http,$q,$log,user,messages){function defaultErrorResponse(error){return $log.error("Wishlist API error:",JSON.stringify(error,null,4)),$q.reject(error.data)}function addToWishlist(data){return $http({url:user.getBaseUrl()+"/wishlist",method:"POST",data:data}).then(function(response){return 201!==response.status?$q.reject(response.data):response.data},function(error){return 409===error.status?service.updateWishlist(data.product_id,data.variant_id):defaultErrorResponse(error)})}var service={};return service.getWishlist=function(){return $http({url:user.getBaseUrl()+"/wishlist",method:"GET"}).then(function(response){return"object"!=typeof response.data?$q.reject(response.data):response.data},function(error){return $log.error("Wishlist API error:",JSON.stringify(error,null,4)),[]})},service.addListToWishList=function(productList){if(user.isSignedIn()){for(var promises=[],i=0;i<productList.length;i++){var v=!1;productList[i].productID!=productList[i].variantID&&(v=productList[i].variantID),promises.push(service.addToWishlist(productList[i].productID,v))}return $q.all(promises).then(function(){return!0},function(){return messages.push({type:"alert",content:"Failed to save all products for later, please try again maybe ... later."}),!1})}var deferred=$q.defer();$rootScope.$on("user-status",function(){deferred.resolve(addListToWishList(productList))}),$state.go("sign-in",{return_url:$state.get("clippings").url})},service.addToWishlist=function(product_id,variant_id){var deferred,data={product_id:product_id};return variant_id&&(data.variant_id=variant_id),user.isSignedIn()?addToWishlist(data):(deferred=$q.defer(),$rootScope.$on("user-status",function(){deferred.resolve(addToWishlist(data))}),$state.go("sign-in",{return_url:$state.get("clippings").url}),deferred.promise)},service.updateWishlist=function(product_id,variant_id){return $http({url:user.getBaseUrl()+"/wishlist/"+product_id,method:"PUT",data:{product_id:product_id,variant_id:variant_id}}).then(function(response){return 201!==response.status?$q.reject(response.data):response.data},defaultErrorResponse)},service.removeFromWishlist=function(product_id){return $http({url:user.getBaseUrl()+"/wishlist/"+product_id,method:"DELETE"}).then(function(response){return 204!==response.status?$q.reject(response.data):response.data},defaultErrorResponse)},service}ConfigureAnchorScroll.$inject=["$rootScope","$injector","$timeout"],ConfigureAnchorScrollRun.$inject=["configureAnchorScroll"],httpAuthenticationService.$inject=["session"],AuthenticationInterceptor.$inject=["$httpProvider"],GoogleMapsConfig.$inject=["uiGmapGoogleMapApiProvider"],AjaxWithCookies.$inject=["$httpProvider"],PatchInterceptor.$inject=["$httpProvider"],BetterAsyncAjax.$inject=["$httpProvider"],CementPreviewModeService.$inject=["browserStorage"],CementPreviewModeInterceptor.$inject=["$httpProvider"],PreviewModeRunner.$inject=["$rootScope","browserStorage"],RequestTimingService.$inject=["$log"],RequestTimingInterceptor.$inject=["$httpProvider"],CmsContentController.$inject=["$scope","$location","cms","cmsPathExist"],RoutesConfig.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$uiViewScrollProvider"],ScreenSize.$inject=["$rootScope"],SEOService.$inject=["$injector","$timeout"],SEOInterceptor.$inject=["$httpProvider"],AccountPreferencesController.$inject=["user","messages","overlay"],AccountSummaryController.$inject=["userDetails","orderHistory","userWishlist","preferredStore","UserService","authentication","$location","loyalty"],UserService.$inject=["$rootScope","$http","$q","$log","API","messages","session","universal_variable"],AddressBookController.$inject=["addressBook","addressLookup","addresses","universal_variable","titles","ajaxStatus","overlay"],BasketController.$inject=["$scope","$rootScope","$timeout","$state","$log","universal_variable","basket","browserStorage","productService","user","wishlistService","ajaxStatus","tagManagerService","scrollToAnchorService","loyaltyService"],BillingController.$inject=["$rootScope","$scope","$state","$log","$q","checkout","addressBook","billingAddress","user","loyaltyService","authentication","universal_variable","passwordPattern","ajaxStatus","order","isLoyaltyMember","tagManagerService"],BirthdayController.$inject=["$scope"],BreadcrumbController.$inject=["$scope","$rootScope","$window","$location","browserStorage","breadcrumbsService","universal_variable","_"],CheckoutSignInController.$inject=["$state","authentication","universal_variable"],CheckoutController.$inject=["$scope","$state","checkout","user","order","universal_variable","$location","overlay","productService","calendar"],ClippingsController.$inject=["$q","wishlist","lineItems","wishlistService","productService","basket","messages","ajaxStatus","_"],EnsembleDetailController.$inject=["ensembleData","basket","wishlistService","recentlyViewed","ajaxStatus","messages"],ErrorController.$inject=["$state"],FooterController.$inject=["$rootScope","$location","menuService","cms"],ForgottenPasswordController.$inject=["passwordService","messages"],HeadController.$inject=["$rootScope","$location","metaDataService","siteName","browserStorage","tagManagerService"],HeaderController.$inject=["$scope","$rootScope","$window","$location","$sce","cms"],HighlightContentBlocksController.$inject=["$rootScope"],LandingPageController.$inject=["topSellers","categoryData","wishlistService"],LearnMoreController.$inject=["$location","cms"],MembershipController.$inject=["$state","$rootScope","user","billingAddress","loyaltyService","isLoyaltyMember","messages","storeAccount","totalPoints","titles"],MessageController.$inject=["$scope","$timeout","messages"],NavigationController.$inject=["$scope","$rootScope","menuService","$location","$sce","cms"],NewsletterController.$inject=["$rootScope","newsletter","user","universal_variable","browserStorage"],OrderConfirmationController.$inject=["$scope","checkout","user","authentication","messages","passwordPattern","order","loyalty","rewards","$window","_"],OrderDetailsController.$inject=["$state","orderData","user","userDetails"],OrderHistoryController.$inject=["orderHistory","salesHistory","userDetails"],PaymentController.$inject=["$scope","$rootScope","$sce","$state","$log","$timeout","checkout","messages","order","paymentMethods","scrollToAnchorService","universal_variable","tagManagerService"],ProductListController.$inject=["$rootScope","$scope","user","wishlistService","searchService","orderOptions","universal_variable","$location"],PlantFinderController.$inject=["$scope","$injector","$location","API","plantFinderData","universal_variable","baseSearchParams","_"],PreorderDatesController.$inject=["$scope","$rootScope","$log","$document","preorderDates"],PDPController.$inject=["productDetailService","productData","relatedProducts","recentlyViewed","wishlist","user","$scope","$location","tagManagerService"],QuickLookController.$inject=["quickLook","productDetailService"],RecentController.$inject=["$rootScope","recentlyViewed","user","wishlistService"],ResetPasswordController.$inject=["$state","$location","passwordService","passwordPattern","messages"],SearchResultsController.$inject=["$scope","$injector","$state","universal_variable","productResults","tagManagerService"],SearchBoxController.$inject=["$rootScope","$document","$state","$scope","$http","API"],ShippingController.$inject=["$scope","$state","$timeout","checkout","addressBook","geolocation","storeLocator","order","deliveryMethods","messages","collectionCode","ajaxStatus","scrollToAnchorService","calendar","universal_variable","tagManagerService"],SignInController.$inject=["$stateParams","$location","authentication","user","scrollToAnchorService","passwordPattern","titles","loyaltyService","tagManagerService","ajaxStatus","messages"],SiteManagerService.$inject=["$rootScope","$http","$q","$log","$sce","API","messages"],StoreDetailController.$inject=["$scope","$sce","$location","API","storeData","storeEvents","storeDetails","user","messages","_"],StoreLocatorController.$inject=["$location","$scope","storeLocator","geolocation","geocodeService","user","messages","_"],SubcategoryController.$inject=["$scope","$rootScope","$injector","universal_variable","categoryName","productResults","tagManagerService"],TabsController.$inject=["$rootScope","$location","keyHandler"],TermsConditionsController.$inject=["$location","cms"],UserController.$inject=["$rootScope","$state","$location","universal_variable","user","authentication"],VouchersController.$inject=["userInfo","rewards","loyaltyService","messages"],
AccountProfileHeader.$inject=["$location"],AccountSideNav.$inject=["user"],AddressFormDirective.$inject=["user","addressBook","titles","addressLookup","ajaxStatus"],AmplienceCarouselDirective.$inject=["$rootScope","API","amp"],backButtonCheckDirective.$inject=["overlay","$location"],CMSContentDirective.$inject=["$rootScope","$location","$q","$compile","cms","personalisedContent"],ConfirmDirective.$inject=["overlay"],EditStoreAddressFormDirective.$inject=["user","addressBook","titles","addressLookup","ajaxStatus"],FeaturedProductDirective.$inject=["$rootScope","productAPI"],GigyaConnectionsDirective.$inject=["$window","$log","socialLogin"],GigyaReviewsDirective.$inject=["$window","$state","$log","$location","socialLogin"],GigyaShareBarDirective.$inject=["$window","$location","$rootScope"],GigyaSocialFeedDirective.$inject=["$window"],GigyaSocialLoginDirective.$inject=["$window","socialLogin"],OpenOverlayDirective.$inject=["overlay"],OrderSummaryDirective.$inject=["productService"],PaginationDirectiveController.$inject=["$scope","$location","_"],ProductThumbDirective.$inject=["$rootScope","productService","user","wishlistService","quickLook","basket","ajaxStatus","_","tagManagerService"],PulseOnUpdateDirective.$inject=["$timeout","$log"],RefinementsDirective.$inject=["$location","$state"],ScrollToAnchorDirective.$inject=["scrollToAnchorService"],ScrollToFirstErrorDirective.$inject=["$timeout","scrollToAnchorService"],ShowPreorderDatesBoxDirective.$inject=["$rootScope"],ShowSearchBoxDirective.$inject=["$rootScope"],AddressBookService.$inject=["$http","$q","$log","user","messages"],AddressLookupService.$inject=["$http","$q","$log","API","keyHandler"],AmplienceService.$inject=["$window"],ArticlesService.$inject=["$http","$q","$log","API","universal_variable","baseSearchParams"],AuthenticationService.$inject=["$window","$rootScope","$http","$q","$location","$state","$log","API","session","basket","checkout","browserStorage"],AuthenticationChecker.$inject=["$rootScope","authentication"],BasketService.$inject=["$rootScope","$http","$q","$log","browserStorage","API","messages","universal_variable","JSONSelect","tagManagerService"],BreadcrumbsService.$inject=["$q","categoriesService","productService","articles"],BrowserStorageService.$inject=["$timeout","$log","messages"],CalendarService.$inject=["$rootScope","$log","basket","ajaxStatus"],CategoriesService.$inject=["$http","$q","$log","API"],CheckoutService.$inject=["$rootScope","$http","$q","$interval","$log","browserStorage","API","universal_variable","basket"],CmsService.$inject=["$rootScope","$http","$q","$window","$log","API","$location"],EnsembleService.$inject=["$http","$q","$log","API"],GeocodeService.$inject=["$q","$log","uiGmapGoogleMapApi","messages"],GeolocationService.$inject=["$q","$window","universal_variable"],JSONSelectService.$inject=["$window"],LateralService.$inject=["$http","$q","$log","user"],lodash.$inject=["$window"],LoyaltyService.$inject=["$http","$q","$log","user","API","universal_variable","messages"],MenuService.$inject=["$http","$q","$log","API","universal_variable"],MetaDataService.$inject=["$q","categoriesService","productService","ensembleService","articles","cms","siteName","_"],newsletterService.$inject=["$http","$q","$log","API","universal_variable","messages","tagManagerService"],OrderService.$inject=["$http","$q","$log","API"],PageVisitTracker.$inject=["$rootScope","browserStorage","universal_variable"],PasswordService.$inject=["$http","$q","$log","API"],PersonalisedContentService.$inject=["$rootScope","$http","$q","$log","API","universal_variable"],PlantFinderService.$inject=["$http","$q","$log","API","universal_variable"],PreorderDatesService.$inject=["$rootScope","$log","basket","ajaxStatus"],ProductDetailService.$inject=["$state","$log","basket","wishlistService","overlay","ajaxStatus","tagManagerService"],ProductService.$inject=["$http","$q","$log","API","universal_variable"],QuickLookService.$inject=["overlay"],RecentlyViewedService.$inject=["browserStorage","productService"],ScrollToAnchorService.$inject=["$location","$anchorScroll"],SearchService.$inject=["$http","$q","$log","API","universal_variable","_"],SessionService.$inject=["$rootScope","browserStorage","universal_variable"],SocialLoginService.$inject=["$window","$http","$q","$log","API","authentication","universal_variable"],StoreLocatorService.$inject=["$log","$http","$q","API","geolocation","geocodeService"],TagManagerService.$inject=["$window","_","user","$log","browserStorage"],UniversalVariableService.$inject=["browserStorage"],UniversalVariableRunner.$inject=["$rootScope","$location","universal_variable"],UserRecognitionService.$inject=["$rootScope","browserStorage","universal_variable"],WishlistService.$inject=["$rootScope","$state","$location","$http","$q","$log","user","messages"],angular.module("tgcg",["ngSanitize","ui.router","tgcgApp","mm.foundation.tooltip","uiGmapgoogle-maps"]),angular.module("tgcgApp",["ngSanitize","ui.router","ng-match","config","mm.foundation.tooltip","uiGmapgoogle-maps","angucomplete-alt","ui.date"]),angular.module("tgcgApp").run(["$rootScope",function($rootScope){$rootScope.view="grid",$rootScope.$on("$stateChangeStart",function(e,stateParams){$(".slider.single-item").unslick(),$rootScope.showNav=!1,$rootScope.isCheckout="checkout"===stateParams.page_type,$rootScope.noRecentlyViewed=stateParams.noRecentlyViewed})}]),angular.module("tgcgApp").factory("configureAnchorScroll",ConfigureAnchorScroll).run(ConfigureAnchorScrollRun),angular.module("tgcgApp").factory("httpAuthentication",httpAuthenticationService).config(AuthenticationInterceptor),angular.module("tgcgApp").config(GoogleMapsConfig),angular.module("tgcgApp").config(AjaxWithCookies),angular.module("tgcgApp").factory("httpPatch",httpPatchService).config(PatchInterceptor),angular.module("tgcgApp").config(BetterAsyncAjax),angular.module("tgcgApp").factory("cementPreviewMode",CementPreviewModeService).config(CementPreviewModeInterceptor).run(PreviewModeRunner),angular.module("tgcgApp").factory("requestTiming",RequestTimingService).config(RequestTimingInterceptor),angular.module("tgcgApp").config(RoutesConfig),angular.module("tgcgApp").run(ScreenSize),angular.module("tgcgApp").factory("SEOService",SEOService).config(SEOInterceptor),angular.module("tgcgApp").constant("ajaxStatus",{pending:"updating",success:"updated",error:"failed"}),angular.module("tgcgApp").constant("baseSearchParams",{offset:0,limit:20,query:{},refinements:[]}),angular.module("tgcgApp").constant("collectionCode","CFS"),angular.module("tgcgApp").constant("orderOptions",[{name:"A to Z",value:{name:"asc"}},{name:"Z to A",value:{name:"desc"}},{name:"Recommended",value:{rating:"desc"}},{name:"Price: lowest first",value:{min_price:"asc"}},{name:"Price: highest first",value:{max_price:"desc"}}]),angular.module("tgcgApp").constant("passwordPattern","^(?=.*\\d)(?=.*[\\D])(?!.*\\s).{7,}$"),angular.module("tgcgApp").constant("siteName","Wyevale Garden Centres"),angular.module("tgcgApp").constant("titles",["Mr","Mrs","Ms","Miss","Dr"]),angular.module("tgcgApp").controller("AccountPreferencesController",AccountPreferencesController),AccountSummaryController.resolve={userDetails:["user",function(user){return user.getUserDetails()["catch"](function(){return{}})}],orderHistory:["orderService",function(orderService){return orderService.getOrderHistory()["catch"](function(){return[]})}],userWishlist:["wishlistService","productService","_",function(wishlistService,productService,_){return wishlistService.getWishlist().then(function(wishlist){return wishlist.length?productService.getProductArray(_.pluck(wishlist,"product_id").slice(0,3)):[]})}],preferredStore:["$log","userDetails","storeLocator",function($log,userDetails,storeLocator){return userDetails.store_id?storeLocator.getStore(userDetails.store_id)["catch"](function(){return $log.warn("Unable to fetch store with id: "+userDetails.store_id),{}}):{}}],loyalty:["loyaltyService","user",function(loyaltyService,user){return loyaltyService.getLoyaltyCardForMemmber(user)["catch"](function(){return{}})}]},angular.module("tgcgApp").controller("AccountSummaryController",AccountSummaryController),angular.module("tgcgApp").service("UserService",UserService),AddressBookController.resolve={addresses:["addressBook",function(addressBook){return addressBook.getAddresses()}]},angular.module("tgcgApp").controller("AddressBookController",AddressBookController),angular.module("tgcgApp").controller("BasketController",BasketController),BillingController.resolve={order:["checkout",function(checkout){return checkout.getOrder()}],isLoyaltyMember:["user",function(user){return user.checkIfLoyaltyMember().then(function(){return!0},function(){return!1})}],billingAddress:["addressBook","_",function(addressBook,_){return addressBook.getAddresses().then(function(addresses){return _.find(addresses,{default_billing:!0})},function(){return{}})}]},angular.module("tgcgApp").controller("BillingController",BillingController),angular.module("tgcgApp").controller("BirthdayController",BirthdayController),angular.module("tgcgApp").controller("BreadcrumbController",BreadcrumbController),angular.module("tgcgApp").controller("CheckoutSignInController",CheckoutSignInController),CheckoutController.resolve={order:["checkout",function(checkout){return checkout.hasBegun()?checkout.getOrder():checkout.begin()}]},angular.module("tgcgApp").controller("CheckoutController",CheckoutController),ClippingsController.resolve={wishlist:["wishlistService",function(wishlistService){return wishlistService.getWishlist()}],lineItems:["wishlist","productService","_",function(wishlist,productService,_){return productService.getProductArray(_.pluck(wishlist,"product_id")).then(function(products){return products.map(function(product,i){return product.product?product:{product:product,meta:{quantity:1,buyButtonType:!0,prodPos:i,bRemoveFromProduct:!0,mustSelectVariant:!1}}})})}]},angular.module("tgcgApp").controller("ClippingsController",ClippingsController),CmsContentController.resolve={cmsPathExist:function($q,$location,cms){var deferred=$q.defer();return cms.pageExists($location.path()).then(function(cmsPage){deferred.resolve(cmsPage.exists)},function(){deferred.resolve(!1)}),deferred.promise}},angular.module("tgcgApp").controller("CmsContentController",CmsContentController),EnsembleDetailController.resolve={ensembleData:["$stateParams","$location","ensembleService",function($stateParams,$location,ensembleService){return ensembleService.getEnsemble($stateParams.id).then(function(ensemble){return ensemble.products=ensemble.products.map(function(product){return product.product?product:{product:product,meta:{quantity:1,buyButtonType:!0}}}),ensemble},function(error){404===error.statusCode&&window.location.replace("/404?url="+encodeURIComponent($location.url()))})}]},angular.module("tgcgApp").controller("EnsembleDetailController",EnsembleDetailController),angular.module("tgcgApp").controller("ErrorController",ErrorController),angular.module("tgcgApp").controller("FooterController",FooterController),angular.module("tgcgApp").controller("ForgottenPasswordController",ForgottenPasswordController),angular.module("tgcgApp").controller("HeadController",HeadController),angular.module("tgcgApp").controller("HeaderController",HeaderController),angular.module("tgcgApp").controller("HighlightContentBlocksController",HighlightContentBlocksController),$(function(){$("body").on("click",".slider-nav li",function(){var $this=$(this),$index=$this.index();$(".slider.single-item").slickGoTo($index),$this.addClass("active").siblings(".active").removeClass("active")})}),LandingPageController.resolve={categoryData:["$location","categoriesService",function($location,categoriesService){var page_url=$location.url();return categoriesService.getCategory(page_url)["catch"](function(error){404===error.statusCode&&window.location.replace("/404?url="+encodeURIComponent(page_url))})}],topSellers:["$stateParams","searchService",function($stateParams,searchService){return searchService.getTopSellers($stateParams.categories.replace(/\//g,"_"))}]},angular.module("tgcgApp").controller("LandingPageController",LandingPageController),angular.module("tgcgApp").controller("LearnMoreController",LearnMoreController),MembershipController.resolve={billingAddress:["addressBook","_",function(addressBook,_){return addressBook.getAddresses().then(function(addresses){return _.find(addresses,{default_billing:!0})},function(){return{}})}],isLoyaltyMember:["user",function(user){return user.checkIfLoyaltyMember().then(function(){return!0},function(){return!1})}],storeAccount:["user","loyaltyService",function(user,loyaltyService){return loyaltyService.getStoreAccountInfo(user).then(function(storeAccount){return storeAccount},function(){return{}})}],totalPoints:["user","loyaltyService",function(user,loyaltyService){return loyaltyService.getLoyaltyCardForMemmber(user).then(function(totalPoints){return totalPoints},function(){return{}})}]},angular.module("tgcgApp").controller("MembershipController",MembershipController),angular.module("tgcgApp").controller("MessageController",MessageController),angular.module("tgcgApp").controller("NavigationController",NavigationController),angular.module("tgcgApp").controller("NewsletterController",NewsletterController),OrderConfirmationController.resolve={order:["$state","checkout",function($state,checkout){return checkout.getOrder()["catch"](function(){$state.go("session-expired",{replace:!0})})}],loyalty:["user","loyaltyService",function(user,loyaltyService){return loyaltyService.getLoyaltyCardForMemmber(user).then(function(totalPoints){return totalPoints},function(){return{}})}],rewards:["user","loyaltyService",function(user,loyaltyService){return loyaltyService.getRewards(user).then(function(rewards){return rewards},function(){return{}})}]},angular.module("tgcgApp").controller("OrderConfirmationController",OrderConfirmationController),OrderDetailsController.resolve={orderData:["$stateParams","orderService","lateralService",function($stateParams,orderService,lateralService){return"order"===$stateParams.type?orderService.getOrder($stateParams.id):lateralService.getSale($stateParams.id)}],userDetails:["user",function(user){return user.getUserDetails()["catch"](function(){return{}})}]},angular.module("tgcgApp").controller("OrderDetailsController",OrderDetailsController),OrderHistoryController.resolve={orderHistory:["orderService",function(orderService){return orderService.getOrderHistory()["catch"](function(error){return 404===error.status?[]:void 0})}],salesHistory:["user","lateralService",function(user,lateralService){return user.checkIfLoyaltyMember().then(function(){return lateralService.getSalesHistory()},function(){return[]})}],userDetails:["user",function(user){return user.getUserDetails()["catch"](function(){return{}})}]},angular.module("tgcgApp").controller("OrderHistoryController",OrderHistoryController),angular.module("tgcgApp").controller("OverlayController",["$scope","$document","overlay",function($scope,$document,overlay){function escapeKey(e){27===e.keyCode&&$scope.$apply(function(){$scope.hide()})}function backButton(e){e.preventDefault(),$scope.$apply(function(){$scope.hide()})}$scope.data=overlay.getScope(),$scope.hide=overlay.hide,$scope.stopProp=function(e){e.stopPropagation()},$scope.$root.$on("$locationChangeStart",function(){$scope.hide()}),$scope.$watch("data.isHidden",function(){$scope.data.isHidden?$document.off("keyup",escapeKey).off("backbutton",backButton):$document.on("keyup",escapeKey).on("backbutton",backButton)})}]),PaymentController.resolve={paymentMethods:["checkout",function(checkout){return checkout.getPaymentMethods()}],order:["checkout",function(checkout){return checkout.getOrder()}]},angular.module("tgcgApp").controller("PaymentController",PaymentController),angular.module("tgcgApp").run(["$rootScope","$location","universal_variable",function($rootScope,$location,universal_variable){var test_settings=$location.search().test_settings;test_settings&&(test_settings=JSON.parse(test_settings),$rootScope.$watch(function(){return universal_variable},function(){universal_variable=angular.extend(universal_variable,test_settings)},!0))}]),PlantFinderController.resolve={plantFinderData:["plantFinder",function(plantFinder){return plantFinder.getQuestions()}]},angular.module("tgcgApp").controller("PlantFinderController",PlantFinderController),angular.module("tgcgApp").controller("PreorderDatesController",PreorderDatesController),PDPController.resolve={productData:["$stateParams","$location","productService",function($stateParams,$location,productService){return productService.getProduct($stateParams.id)["catch"](function(error){404===error.statusCode&&window.location.replace("/404?url="+encodeURIComponent($location.url()))})}],relatedProducts:["$stateParams","productService",function($stateParams,productService){return productService.getRelatedProducts($stateParams.id,6,"Automated Merchandising Cross-Sells")["catch"](function(){return[]})}],wishlist:["wishlistService",function(wishlistService){return wishlistService.getWishlist()}]},angular.module("tgcgApp").controller("PDPController",PDPController),angular.module("tgcgApp").controller("ProductListController",ProductListController),angular.module("tgcgApp").controller("QuickLookController",QuickLookController),angular.module("tgcgApp").controller("RecentController",RecentController),angular.module("tgcgApp").controller("ResetPasswordController",ResetPasswordController),SearchResultsController.resolve={searchResultsUniversalVariable:["$stateParams","$location","baseSearchParams","searchService","universal_variable",function($stateParams,$location,baseSearchParams,searchService,universal_variable){return universal_variable.search=baseSearchParams,universal_variable.search.query={keywords:$stateParams.query,onlyActive:!0},universal_variable}],productResults:["$stateParams","$location","baseSearchParams","searchService","searchResultsUniversalVariable",function($stateParams,$location,baseSearchParams,searchService,searchResultsUniversalVariable){var searchParams=$location.search(),page=$stateParams.page;return page?(page=parseInt(page,10),isNaN(page)||(searchResultsUniversalVariable.search.offset=searchResultsUniversalVariable.search.limit*(page-1))):searchParams.page||searchResultsUniversalVariable.search&&(searchResultsUniversalVariable.search.offset=0),$location.path().match("search")&&(searchResultsUniversalVariable.search.refinements=searchService.prepareRefinements(searchParams)),searchService.getResults(searchResultsUniversalVariable)}]},angular.module("tgcgApp").controller("SearchResultsController",SearchResultsController),angular.module("tgcgApp").controller("SearchBoxController",SearchBoxController),ShippingController.resolve={order:["checkout",function(checkout){return checkout.getOrder()}],deliveryMethods:["checkout",function(checkout){return checkout.getDeliveryMethods()}]},angular.module("tgcgApp").controller("ShippingController",ShippingController),SignInController.resolve={signedIn:["user","$stateParams","$location",function(user,$stateParams,$location){return user.isSignedIn()?$stateParams.return_url?void $location.url($stateParams.return_url):void $location.url("/"):void 0}]},angular.module("tgcgApp").controller("SignInController",SignInController),angular.module("tgcgApp").factory("siteManager",SiteManagerService),setTransactionalSite.$inject=["$rootScope","siteManager"],angular.module("tgcgApp").run(setTransactionalSite),angular.module("tgcgApp").controller("StaticContentController",["$scope","$state","$sce","API",function($scope,$state,$sce,API){$scope.articleUrl=$sce.trustAsResourceUrl(API.wordpress.url+"/"+$state.params.url)}]),StoreDetailController.resolve={storeData:["$stateParams","storeLocator",function($stateParams,storeLocator){return storeLocator.getStore($stateParams.id)}],maps:["uiGmapGoogleMapApi",function(uiGmapGoogleMapApi){return uiGmapGoogleMapApi.then(function(maps){return maps})}],storeEvents:["$stateParams","storeLocator",function($stateParams,storeLocator){return storeLocator.getStoreEvents($stateParams.id)}],storeDetails:["$stateParams","storeLocator",function($stateParams,storeLocator){return storeLocator.getStoreDetails($stateParams.id)}]},angular.module("tgcgApp").controller("StoreDetailController",StoreDetailController),StoreLocatorController.resolve={maps:["uiGmapGoogleMapApi",function(uiGmapGoogleMapApi){return uiGmapGoogleMapApi.then(function(maps){return maps})}]},angular.module("tgcgApp").controller("StoreLocatorController",StoreLocatorController),SubcategoryController.resolve={categoryName:["$location","categoriesService",function($location,categoriesService){return categoriesService.getNameFor($location.path())["catch"](function(error){404===error.statusCode&&window.location.replace("/404?url="+encodeURIComponent($location.url()))})}],productResults:["$stateParams","$location","baseSearchParams","searchService","universal_variable",function($stateParams,$location,baseSearchParams,searchService,universal_variable){var searchParams=$location.search(),page=searchParams.page;return universal_variable.search=angular.copy(baseSearchParams),$stateParams.categories&&(universal_variable.search.query={onlyActive:!0},universal_variable.search.query.filters=[{key:"categories.id",values:[$stateParams.categories.replace(/\//g,"_")]}]),universal_variable.search.refinements=searchService.prepareRefinements(searchParams),universal_variable.search.sort=searchService.defaultSort(universal_variable.search.query.filters),page&&(page=parseInt(page,10),isNaN(page)||(universal_variable.search.offset=universal_variable.search.limit*(page-1))),searchService.getResults(universal_variable)}]},angular.module("tgcgApp").controller("SubcategoryController",SubcategoryController),angular.module("tgcgApp").controller("TabsController",TabsController),angular.module("tgcgApp").controller("TermsConditionsController",TermsConditionsController),angular.module("tgcgApp").controller("UserController",UserController),VouchersController.resolve={rewards:["user","loyaltyService",function(user,loyaltyService){return user.checkIfLoyaltyMember().then(function(){return loyaltyService.getRewards(user)},function(){return[]})}],userInfo:["user",function(user){return user.getUserDetails()}]},angular.module("tgcgApp").controller("VouchersController",VouchersController),angular.module("tgcgApp").directive("accountProfileHeader",AccountProfileHeader),angular.module("tgcgApp").directive("accountSideNav",AccountSideNav),angular.module("tgcgApp").directive("addressForm",AddressFormDirective),angular.module("tgcgApp").directive("addressSummary",[function(){return{restrict:"EA",templateUrl:"/assets/partials/address-summary.html",scope:{address:"=",inline:"="},replace:!0}}]),angular.module("tgcgApp").directive("amplienceCarousel",AmplienceCarouselDirective),angular.module("tgcgApp").directive("backButtonCheck",backButtonCheckDirective),angular.module("tgcgApp").directive("cmsContent",CMSContentDirective),angular.module("tgcgApp").directive("collapseToggle",CollapseToggleDirective).directive("collapseToggleClick",CollapseToggleClickDirective).directive("collapseToggleContent",CollapseToggleContentDirective),angular.module("tgcgApp").directive("confirmLayer",ConfirmDirective),angular.module("tgcgApp").directive("editStoreAddressForm",EditStoreAddressFormDirective),angular.module("tgcgApp").directive("featuredProduct",FeaturedProductDirective),angular.module("tgcgApp").directive("focusNextOnMaxlength",function(){return{restrict:"A",link:function($scope,element){element.on("input",function(){if(element.val().length==element.attr("maxlength")){var $nextElement=element.next();$nextElement.length&&$nextElement[0].focus()}})}}}),angular.module("tgcgApp").directive("gigyaConnections",GigyaConnectionsDirective),angular.module("tgcgApp").directive("gigyaReviews",GigyaReviewsDirective),angular.module("tgcgApp").directive("gigyaShareBar",GigyaShareBarDirective),angular.module("tgcgApp").directive("gigyaSocialFeed",GigyaSocialFeedDirective),angular.module("tgcgApp").directive("gigyaSocialLogin",GigyaSocialLoginDirective),angular.module("tgcgApp").directive("autoResize",AutoResizeDirective),angular.module("tgcgApp").directive("openOverlay",OpenOverlayDirective),angular.module("tgcgApp").directive("orderSummary",OrderSummaryDirective),angular.module("tgcgApp").controller("PaginationDirectiveController",PaginationDirectiveController).directive("pagination",PaginationDirective),angular.module("tgcgApp").directive("preview",PreviewDirective),angular.module("tgcgApp").directive("price",PriceDirective),angular.module("tgcgApp").directive("productList",ProductListDirective),angular.module("tgcgApp").directive("productSlider",ProductSliderDirective),angular.module("tgcgApp").directive("productThumb",ProductThumbDirective),angular.module("tgcgApp").directive("pulseOnUpdate",PulseOnUpdateDirective),angular.module("tgcgApp").directive("refine",RefinementsDirective),angular.module("tgcgApp").directive("scrollToAnchor",ScrollToAnchorDirective),angular.module("tgcgApp").directive("scrollToFirstError",ScrollToFirstErrorDirective),angular.module("tgcgApp").directive("showPreorderDatesBox",ShowPreorderDatesBoxDirective),angular.module("tgcgApp").directive("showSearchBox",ShowSearchBoxDirective),angular.module("tgcgApp").directive("tabControl",TabControlDirective).directive("tab",TabDirective),angular.module("tgcgApp").directive("validateQuantity",[function(){return{restrict:"A",scope:{quantity:"=ngModel",min:"=",max:"="},link:function(scope,element){element.on("input",function(){var quantity=parseInt(scope.quantity,10),min=parseInt(scope.min,10),max=parseInt(scope.max,10);if(!isNaN(quantity))return!isNaN(min)&&min>quantity?void(scope.quantity=min):!isNaN(max)&&quantity>max?void(scope.quantity=max):void 0})}}}]),angular.module("tgcgApp").directive("watchRepeat",WatchRepeat),angular.module("tgcgApp").service("addressBook",AddressBookService),angular.module("tgcgApp").service("addressLookup",AddressLookupService),angular.module("tgcgApp").factory("amp",AmplienceService),angular.module("tgcgApp").factory("articles",ArticlesService),angular.module("tgcgApp").service("authentication",AuthenticationService).run(AuthenticationChecker),angular.module("tgcgApp").factory("basket",BasketService),angular.module("tgcgApp").service("breadcrumbsService",BreadcrumbsService),angular.module("tgcgApp").factory("browserStorage",BrowserStorageService),angular.module("tgcgApp").factory("calendar",CalendarService),angular.module("tgcgApp").factory("categoriesService",CategoriesService),angular.module("tgcgApp").factory("checkout",CheckoutService),angular.module("tgcgApp").factory("cms",CmsService),angular.module("tgcgApp").factory("ensembleService",EnsembleService),angular.module("tgcgApp").service("geocodeService",GeocodeService),angular.module("tgcgApp").service("geolocation",GeolocationService),angular.module("tgcgApp").factory("JSONSelect",JSONSelectService),angular.module("tgcgApp").service("keyHandler",KeyHandlerService),angular.module("tgcgApp").service("lateralService",LateralService),angular.module("tgcgApp").factory("_",lodash),angular.module("tgcgApp").service("loyaltyService",LoyaltyService),angular.module("tgcgApp").service("menuService",MenuService),angular.module("tgcgApp").factory("messages",MessagesService),angular.module("tgcgApp").service("metaDataService",MetaDataService),angular.module("tgcgApp").service("newsletter",newsletterService),angular.module("tgcgApp").service("orderService",OrderService),angular.module("tgcgApp").factory("overlay",OverlayService),angular.module("tgcgApp").run(PageVisitTracker),angular.module("tgcgApp").service("passwordService",PasswordService),angular.module("tgcgApp").factory("personalisedContent",PersonalisedContentService),angular.module("tgcgApp").service("plantFinder",PlantFinderService),angular.module("tgcgApp").factory("preorderDates",PreorderDatesService),angular.module("tgcgApp").service("productDetailService",ProductDetailService),angular.module("tgcgApp").factory("productService",ProductService),angular.module("tgcgApp").factory("quickLook",QuickLookService),angular.module("tgcgApp").factory("recentlyViewed",RecentlyViewedService),angular.module("tgcgApp").service("scrollToAnchorService",ScrollToAnchorService),angular.module("tgcgApp").service("searchService",SearchService),angular.module("tgcgApp").factory("session",SessionService),angular.module("tgcgApp").factory("socialLogin",SocialLoginService),angular.module("tgcgApp").service("storeLocator",StoreLocatorService),angular.module("tgcgApp").service("tagManagerService",TagManagerService),angular.module("tgcgApp").factory("universal_variable",UniversalVariableService).run(UniversalVariableRunner),angular.module("tgcgApp").run(UserRecognitionService),angular.module("tgcgApp").service("user",UserService),angular.module("tgcgApp").factory("wishlistService",WishlistService)}();